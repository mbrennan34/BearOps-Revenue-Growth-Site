<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BearOps Accountability Chart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --bg: #020617;
            --bg-alt: #020617;
            --card-bg: rgba(15, 23, 42, 0.92);
            --surface: rgba(15, 23, 42, 0.92);
            --surface-soft: rgba(15, 23, 42, 0.82);
            --border-subtle: rgba(148, 163, 184, 0.45);
            --border-strong: rgba(148, 163, 184, 0.9);
            --accent: #38bdf8;
            --accent-soft: rgba(56, 189, 248, 0.14);
            --accent-strong: #0ea5e9;
            --accent-secondary: #a855f7;
            --accent-secondary-soft: rgba(168, 85, 247, 0.16);
            --text: #e5e7eb;
            --muted: #94a3b8;
            --muted-soft: rgba(148, 163, 184, 0.7);
            --danger: #fb7185;
            --danger-soft: rgba(248, 113, 113, 0.22);
            --warning: #facc15;
            --warning-soft: rgba(250, 204, 21, 0.16);
            --success: #4ade80;
            --success-soft: rgba(74, 222, 128, 0.16);
            --shadow-soft: 0 22px 60px rgba(15, 23, 42, 0.95);
            --shadow-card: 0 18px 40px rgba(15, 23, 42, 0.9);
            --shadow-subtle: 0 1px 0 rgba(15, 23, 42, 0.85);
        }

        body.light {
            --bg: #eef2ff;
            --bg-alt: #e5e7eb;
            --card-bg: #ffffff;
            --surface: #ffffff;
            --surface-soft: #f9fafb;
            --border-subtle: rgba(148, 163, 184, 0.4);
            --border-strong: rgba(30, 64, 175, 0.7);
            --accent: #0ea5e9;
            --accent-soft: rgba(14, 165, 233, 0.12);
            --accent-strong: #0284c7;
            --accent-secondary: #7c3aed;
            --accent-secondary-soft: rgba(124, 58, 237, 0.12);
            --text: #020617;
            --muted: #4b5563;
            --muted-soft: rgba(75, 85, 99, 0.75);
            --danger: #b91c1c;
            --danger-soft: rgba(248, 113, 113, 0.18);
            --warning: #ca8a04;
            --warning-soft: rgba(234, 179, 8, 0.16);
            --success: #15803d;
            --success-soft: rgba(34, 197, 94, 0.14);
            --shadow-soft: 0 26px 70px rgba(15, 23, 42, 0.35);
            --shadow-card: 0 18px 40px rgba(15, 23, 42, 0.18);
            --shadow-subtle: 0 1px 0 rgba(148, 163, 184, 0.5);
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background:
                radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.18), transparent 55%),
                radial-gradient(circle at 100% 0%, rgba(129, 140, 248, 0.25), transparent 50%),
                radial-gradient(circle at 0% 100%, rgba(96, 165, 250, 0.2), transparent 55%),
                radial-gradient(circle at 100% 100%, rgba(56, 189, 248, 0.16), transparent 55%),
                var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 24px;
        }

        .page {
            max-width: 1320px;
            margin: 0 auto;
        }

        .header {
            background:
                radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.35), transparent 50%),
                radial-gradient(circle at 100% 0%, rgba(168, 85, 247, 0.38), transparent 55%),
                radial-gradient(circle at 0% 100%, rgba(56, 189, 248, 0.25), transparent 55%),
                linear-gradient(135deg, #020617 0%, #0b1220 20%, #111827 60%, #1f2937 100%);
            border-radius: 26px;
            padding: 20px 24px;
            box-shadow: var(--shadow-soft);
            margin-bottom: 18px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(circle at 15% 0%, rgba(56, 189, 248, 0.35), transparent 55%),
                radial-gradient(circle at 100% 20%, rgba(168, 85, 247, 0.25), transparent 60%);
            opacity: 0.7;
            pointer-events: none;
        }

        .header-inner {
            position: relative;
            z-index: 1;
            display: grid;
            grid-template-columns: minmax(0, 2.2fr) minmax(0, 2fr);
            gap: 24px;
            align-items: center;
        }

        @media (max-width: 900px) {
            .header-inner {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .title-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: rgba(226, 232, 240, 0.9);
        }

        .eyebrow-pill {
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.75);
            background: rgba(15, 23, 42, 0.8);
            font-size: 0.72rem;
        }

        .title-row {
            display: flex;
            flex-wrap: wrap;
            align-items: baseline;
            gap: 8px;
        }

        h1 {
            margin: 0;
            font-size: 1.9rem;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            color: #e5e7eb;
        }

        .company-label {
            font-size: 0.95rem;
            color: rgba(226, 232, 240, 0.9);
        }

        .subtitle {
            margin-top: 4px;
            font-size: 0.9rem;
            color: rgba(226, 232, 240, 0.85);
            max-width: 560px;
        }

        .controls-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .company-input {
            min-width: 180px;
            flex: 1;
        }

        .company-input input {
            width: 100%;
            padding: 7px 10px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            background: rgba(15, 23, 42, 0.7);
            color: #e5e7eb;
            font-size: 0.85rem;
        }

        body.light .company-input input {
            background: rgba(249, 250, 251, 0.9);
            color: #020617;
        }

        .company-input input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.65);
            background: rgba(15, 23, 42, 0.9);
        }

        body.light .company-input input:focus {
            background: #ffffff;
        }

        .chips-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            padding: 4px 9px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            background: rgba(15, 23, 42, 0.85);
            color: rgba(226, 232, 240, 0.9);
        }

        body.light .chip {
            background: rgba(249, 250, 251, 0.9);
        }

        .chip strong {
            font-weight: 600;
        }

        .header-right {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }

        @media (max-width: 900px) {
            .header-right {
                align-items: flex-start;
            }
        }

        .mode-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: flex-end;
        }

        @media (max-width: 900px) {
            .mode-row {
                justify-content: flex-start;
            }
        }

        .toggle-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 10px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            background: rgba(15, 23, 42, 0.85);
            color: rgba(226, 232, 240, 0.9);
            font-size: 0.76rem;
            cursor: pointer;
            user-select: none;
        }

        body.light .toggle-pill {
            background: rgba(249, 250, 251, 0.95);
        }

        .toggle-pill input {
            display: none;
        }

        .toggle-thumb {
            width: 32px;
            height: 16px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.85);
            position: relative;
        }

        .toggle-circle {
            position: absolute;
            top: 1px;
            left: 1px;
            width: 12px;
            height: 12px;
            border-radius: 999px;
            background: #e5e7eb;
            transition: transform 0.18s ease;
        }

        body.light .toggle-circle {
            transform: translateX(14px);
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: flex-end;
        }

        @media (max-width: 900px) {
            .toolbar {
                justify-content: flex-start;
            }
        }

        button {
            font-family: inherit;
        }

        .button {
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            background: rgba(15, 23, 42, 0.9);
            color: #e5e7eb;
            padding: 6px 11px;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            box-shadow: var(--shadow-subtle);
            transition: transform 0.06s ease, box-shadow 0.06s ease, border-color 0.12s ease, background 0.12s ease;
        }

        .button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .button.primary {
            border-color: rgba(59, 130, 246, 0.9);
            background: radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.35), transparent 55%), linear-gradient(135deg, #2563eb, #4f46e5);
            color: #eff6ff;
        }

        .button.outline {
            background: transparent;
        }

        .button.danger {
            border-color: rgba(248, 113, 113, 0.9);
            background: rgba(127, 29, 29, 0.96);
        }

        body.light .button {
            background: #ffffff;
            color: #020617;
        }

        body.light .button.primary {
            background: linear-gradient(135deg, #2563eb, #4f46e5);
            color: #eff6ff;
        }

        body.light .button.danger {
            background: #fee2e2;
            color: #7f1d1d;
        }

        .button .icon {
            font-size: 1rem;
        }

        .main {
            display: grid;
            grid-template-columns: minmax(0, 2.1fr) minmax(0, 3fr);
            gap: 16px;
            align-items: flex-start;
        }

        @media (max-width: 1024px) {
            .main {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .panel {
            background: var(--card-bg);
            border-radius: 20px;
            border: 1px solid var(--border-subtle);
            padding: 14px 16px;
            box-shadow: var(--shadow-card);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            gap: 8px;
        }

        .panel-title {
            font-size: 0.9rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--muted);
        }

        .panel-subtitle {
            font-size: 0.78rem;
            color: var(--muted-soft);
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            background: rgba(15, 23, 42, 0.9);
            color: var(--muted-soft);
        }

        body.light .pill {
            background: rgba(249, 250, 251, 0.95);
        }

        .form-grid {
            display: grid;
            grid-template-columns: minmax(0, 1fr);
            gap: 10px;
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .field-label {
            font-size: 0.78rem;
            color: var(--muted);
        }

        .field-label .hint {
            font-size: 0.74rem;
            color: var(--muted-soft);
        }

        input[type="text"], textarea, select {
            font-family: inherit;
            font-size: 0.84rem;
            border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.8);
            background: rgba(15, 23, 42, 0.9);
            color: var(--text);
            padding: 6px 8px;
        }

        textarea {
            min-height: 46px;
            resize: vertical;
        }

        select {
            padding-right: 24px;
        }

        body.light input[type="text"],
        body.light textarea,
        body.light select {
            background: rgba(249, 250, 251, 0.96);
            color: #020617;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.6);
        }

        .row-inline {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .row-inline .field {
            flex: 1;
            min-width: 140px;
        }

        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(148, 163, 184, 0.55), transparent);
            margin: 10px 0;
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--muted-soft);
        }

        .checkbox-row input[type="checkbox"] {
            width: 14px;
            height: 14px;
            border-radius: 4px;
            border: 1px solid rgba(148, 163, 184, 0.8);
            background: rgba(15, 23, 42, 0.9);
        }

        body.light .checkbox-row input[type="checkbox"] {
            background: #ffffff;
        }

        .small-text {
            font-size: 0.75rem;
            color: var(--muted-soft);
        }

        .section-title-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 4px;
        }

        .section-title {
            font-size: 0.78rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--muted);
        }

        .section-subtitle {
            font-size: 0.76rem;
            color: var(--muted-soft);
        }

        .mini-button {
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            background: rgba(15, 23, 42, 0.92);
            color: var(--muted-soft);
            padding: 3px 8px;
            font-size: 0.74rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .mini-button .icon {
            font-size: 0.9rem;
        }

        body.light .mini-button {
            background: #f9fafb;
        }

        .mini-button.primary {
            border-color: rgba(56, 189, 248, 0.9);
            color: var(--accent-strong);
            background: var(--accent-soft);
        }

        .mini-button.danger {
            border-color: rgba(248, 113, 113, 0.9);
            color: var(--danger);
            background: var(--danger-soft);
        }

        .functions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 12px;
        }

        .function-card {
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border-subtle);
            padding: 10px 10px 10px;
            box-shadow: 0 12px 30px rgba(15, 23, 42, 0.85);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        body.light .function-card {
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.1);
        }

        .function-card.collapsed {
            background: var(--surface-soft);
        }

        .function-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
        }

        .function-header-left {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .function-name {
            font-size: 0.92rem;
            font-weight: 600;
            color: var(--text);
        }

        .seat-count {
            font-size: 0.76rem;
            color: var(--muted-soft);
        }

        .function-header-right {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: flex-end;
        }

        .function-focus-icon {
            border-radius: 999px;
            border: 1px solid rgba(96, 165, 250, 0.9);
            background: rgba(15, 23, 42, 0.96);
            color: rgba(239, 246, 255, 0.95);
            padding: 3px 7px;
            font-size: 0.76rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        body.light .function-focus-icon {
            background: #eff6ff;
            color: #1d4ed8;
        }

        .function-focus-icon .icon {
            font-size: 0.9rem;
        }

        .seats-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 4px;
        }

        .seat-card {
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(30, 64, 175, 0.9);
            padding: 8px 9px;
        }

        body.light .seat-card {
            background: #f9fafb;
            border-color: rgba(59, 130, 246, 0.25);
        }

        .seat-card.collapsed-details {
            border-style: dashed;
        }

        .seat-top {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 6px;
            cursor: pointer;
        }

        .seat-role {
            font-size: 0.88rem;
            font-weight: 600;
        }

        .seat-owner {
            font-size: 0.8rem;
            color: var(--muted-soft);
        }

        .seat-owner.empty {
            font-style: italic;
            opacity: 0.8;
        }

        .seat-meta {
            margin-top: 3px;
            font-size: 0.76rem;
            color: var(--muted-soft);
        }

        .seat-detail-block {
            margin-top: 5px;
            font-size: 0.78rem;
        }

        .seat-detail-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--muted);
            margin-bottom: 2px;
        }

        .seat-detail-body {
            font-size: 0.78rem;
            color: var(--muted-soft);
        }

        .empty-state {
            font-size: 0.8rem;
            color: var(--muted-soft);
            border-radius: 12px;
            border: 1px dashed rgba(148, 163, 184, 0.6);
            padding: 8px;
            background: rgba(15, 23, 42, 0.6);
        }

        body.light .empty-state {
            background: rgba(249, 250, 251, 0.9);
        }

        .summary-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
            align-items: center;
        }

        .summary-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.78rem;
            padding: 4px 9px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            background: rgba(15, 23, 42, 0.9);
            color: var(--muted-soft);
        }

        .summary-chip strong {
            font-weight: 600;
            color: var(--text);
        }

        body.light .summary-chip {
            background: #f9fafb;
        }

        .focus-bar {
            display: none;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            padding: 8px 10px;
            border-radius: 999px;
            background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.25), transparent 55%), rgba(15, 23, 42, 0.92);
            border: 1px solid rgba(56, 189, 248, 0.7);
            margin-bottom: 8px;
        }

        body.light .focus-bar {
            background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.18), transparent 55%), #eff6ff;
        }

        .focus-label {
            display: inline-flex;
            align-items: baseline;
            gap: 6px;
            font-size: 0.8rem;
        }

        .focus-label .label {
            text-transform: uppercase;
            letter-spacing: 0.12em;
            font-size: 0.7rem;
            color: var(--muted);
        }

        .focus-label .value {
            font-weight: 600;
        }

        .pill-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
        }

        .pill-summary {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            background: rgba(15, 23, 42, 0.9);
            color: var(--muted-soft);
        }

        body.light .pill-summary {
            background: #f9fafb;
        }

        .next-steps {
            margin-top: 18px;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 18px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            padding: 12px 14px;
            box-shadow: 0 14px 35px rgba(15, 23, 42, 0.9);
        }

        body.light .next-steps {
            background: #f9fafb;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.12);
        }

        .next-steps-title {
            font-size: 0.82rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--muted);
            margin-bottom: 6px;
        }

        .next-steps-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 6px;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--muted-soft);
        }

        .checklist-item input[type="checkbox"] {
            margin-top: 2px;
        }

        .checklist-item strong {
            font-weight: 600;
            color: var(--text);
        }

        @media (max-width: 640px) {
            body {
                padding: 16px;
            }

}
.lead-link-gradient {
    display: inline-block;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 14px 28px;
    border-radius: 50px;
    text-decoration: none;
    font-weight: 700;
    font-size: 16px;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.lead-link-gradient:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);

        }

    </style>
</head>
<body>
<!-- Overlaid logo (doesn't change layout) -->
        <img src="../assets/images/BearOps_Logo_Default.png">


<div class="container">
<div style="text-align: center; margin-top: 20px;">
    <a href="../index.html" class="lead-link-gradient">Home</a>
    <a href="people-analyzer.html" class="lead-link-gradient">People Analyzer</a>
</div>

    <header class="header">
        <div class="header-inner">
            <div class="title-group">
                <div class="eyebrow">
                    <span class="eyebrow-pill">Accountability Chart</span>
                    <span>Right People ‚Ä¢ Right Seats ‚Ä¢ Clear Lines</span>
                </div>
                <div class="title-row">
                    <h1>Accountability Chart</h1>
                    <span class="company-label" id="companyLabel"></span>
                </div>
                <div class="subtitle">
                    Map every function, seat, and accountability in one place. Use this as the ‚Äúsource of truth‚Äù for org design discussions and leadership meetings.
                </div>
                <div class="controls-row">
                    <div class="company-input">
                        <input type="text" id="companyName" placeholder="Add company name‚Ä¶ (e.g. BearOps, Series A GTM)">
                    </div>
                    <div class="chips-row">
                        <div class="chip">
                            <span class="icon">üß†</span><strong>Vision</strong><span>Who owns what as you scale</span>
                        </div>
                        <div class="chip">
                            <span class="icon">üìä</span><strong>Seat Scorecards</strong><span>Metrics, decisions, and interfaces</span>
                        </div>
                        <div class="chip">
                            <span class="icon">üß©</span><strong>People Analyzer</strong><span>Sync seats into values &amp; GWC grid</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="mode-row">
                    <label class="toggle-pill">
                        <div class="toggle-thumb">
                            <div class="toggle-circle"></div>
                        </div>
                        <span id="themeLabel">üåô Dark</span>
                    </label>
                    <label class="toggle-pill">
                        <input type="checkbox" id="togglePeople">
                        <span>Show people focus</span>
                    </label>
                </div>
                <div class="toolbar">
                    <button class="button outline" id="btnCollapseAll" type="button">
                        <span class="icon">‚¨ÜÔ∏è</span><span>Collapse all</span>
                    </button>
                    <button class="button outline" id="btnExpandAll" type="button">
                        <span class="icon">‚¨áÔ∏è</span><span>Expand all</span>
                    </button>
                    <button class="button danger" id="btnReset" type="button">
                        <span class="icon">üßπ</span><span>Reset chart</span>
                    </button>
                </div>
                <div class="small-text">
                    Tip: Start with ~5‚Äì7 core functions (Leadership, Product, Sales, CS) before adding sub-functions.
                </div>
            </div>
        </div>
    </header>

    <main class="main">
        <section class="panel">
            <div class="panel-header">
                <div>
                    <div class="panel-title">Function &amp; Seat Builder</div>
                    <div class="panel-subtitle">Define major functions, then add seats with clear accountability.</div>
                </div>
                <div class="pill">
                    <span class="icon"></span><span>Inputs into People Analyzer</span>
                </div>
            </div>

            <div class="form-grid">
                <div class="field">
                    <div class="field-label">New function <span class="hint">e.g. Leadership, Sales, Product, CS</span></div>
                    <div class="row-inline">
                        <input type="text" id="functionName" placeholder="Function name‚Ä¶">
                        <button class="button primary" id="btnAddFunction" type="button">
                            <span class="icon">‚ûï</span><span>Add function</span>
                        </button>
                    </div>
                    <div class="small-text">
                        Keep this high-level at first. You can add regional or squad-based functions later (e.g. ‚ÄúEMEA Sales‚Äù, ‚ÄúOnboarding CS‚Äù).
                    </div>
                </div>

                <div class="divider"></div>

                <div class="section-title-row">
                    <div class="section-title">Add seat to function</div>
                    <div class="section-subtitle">Use role + owner + clear scope so the seat is unambiguous.</div>
                </div>

                <div class="field">
                    <div class="field-label">Seat function</div>
                    <select id="seatFunctionSelect">
                        <option value="">Choose function‚Ä¶</option>
                    </select>
                </div>

                <div class="row-inline">
                    <div class="field">
                        <div class="field-label">Seat / Role title</div>
                        <input type="text" id="seatRole" placeholder="e.g. Head of Sales, CS Lead, RevOps Manager">
                    </div>
                    <div class="field">
                        <div class="field-label">Seat owner (optional)</div>
                        <input type="text" id="seatOwner" placeholder="e.g. Alice Murphy">
                    </div>
                </div>

                <div class="field">
                    <div class="field-label">Purpose of this seat <span class="hint">1‚Äì2 sentences</span></div>
                    <textarea id="seatPurpose" placeholder="Why does this seat exist? What result are they accountable for?"></textarea>
                </div>

                <div class="field">
                    <div class="field-label">Scope &amp; responsibilities <span class="hint">bullet style lines</span></div>
                    <textarea id="seatResponsibilities" placeholder="Owns pipeline creation for MM segment
Leads weekly forecast calls and commits
Partners with Marketing on campaign focus"></textarea>
                </div>

                <div class="field">
                    <div class="field-label">Communication norms <span class="hint">how this seat interacts</span></div>
                    <textarea id="seatComms" placeholder="Weekly 1:1 with VP Sales
Bi-weekly sync with Marketing
Joins QBRs for top 10 customers"></textarea>
                </div>

                <div class="field">
                    <div class="field-label">Metrics of success <span class="hint">3‚Äì5 max</span></div>
                    <textarea id="seatMetrics" placeholder="Net new ARR closed
Pipeline coverage (3x)
Win rate &amp; sales cycle length"></textarea>
                </div>

                <div class="field">
                    <div class="field-label">Key decisions &amp; interfaces <span class="hint">where they have real autonomy</span></div>
                    <textarea id="seatDecisions" placeholder="Can approve discounts to 15%
Owns territory carve-up with RevOps
Prioritises which deals enter exec review"></textarea>
                </div>

                <div class="field">
                    <div class="field-label">Interfaces &amp; handoffs</div>
                    <textarea id="seatInterfaces" placeholder="Hands off closed-won customers to CS
Must align with Product on roadmap impacting top 10 deals"></textarea>
                </div>

                <div class="checkbox-row">
                    <input type="checkbox" id="seatCollapsed" checked>
                    <label for="seatCollapsed">Start this seat collapsed (only show title &amp; owner by default)</label>
                </div>

                <div class="row-inline">
                    <button class="button primary" id="btnAddSeat" type="button">
                        <span class="icon">‚ûï</span><span>Add seat to function</span>
                    </button>
                    <button class="button outline" id="btnClearSeatForm" type="button">
                        <span class="icon">üßΩ</span><span>Clear seat form</span>
                    </button>
                </div>

                <div class="small-text">
                    Once your chart looks right, jump into the People Analyzer to test ‚ÄúRight Person / Right Seat‚Äù using the same seats.
                </div>
            </div>
        </section>

        <section class="panel">
            <div class="panel-header">
                <div>
                    <div class="panel-title">Accountability Map</div>
                    <div class="panel-subtitle">Each card is a function. Inside are the seats and what they own.</div>
                </div>
              
            </div>

            <div class="summary-row">
                <div class="summary-chip">
                    <span class="icon">üèóÔ∏è</span>
                    <span><strong id="summaryFunctions">0</strong> functions</span>
                </div>
                <div class="summary-chip">
                    <span class="icon">ü™ë</span>
                    <span><strong id="summarySeats">0</strong> seats</span>
                </div>
                <div class="summary-chip">
                    <span class="icon">‚ùì</span>
                    <span><strong id="summaryEmpty">0</strong> open seats (no owner)</span>
                </div>
            </div>

            <div class="focus-bar" id="focusBar">
                <div class="focus-label">
                    <span class="label">Focused function</span>
                    <span class="value" id="focusFunctionName"></span>
                </div>
                <button class="mini-button" id="btnClearFocus" type="button">Clear focus</button>
            </div>

            <div class="pill-list" id="chartSummary"></div>

            <div class="functions-grid" id="functionsGrid"></div>

            <div id="emptyState" class="empty-state" style="margin-top:12px;">
                Start by adding your first function on the left. Example: Leadership, Sales, Marketing.
            </div>
        </section>
    </main>
    <!-- NEXT STEPS CHECKLIST -->
    <section class="next-steps">
        <div class="next-steps-title">Suggested next steps</div>
        <ul class="next-steps-list">
            <li class="checklist-item">
                <input type="checkbox">
                <span><strong>Walk the chart with leadership.</strong> Validate that every critical function has an owner and there are no overlapping seats.</span>
            </li>
            <li class="checklist-item">
                <input type="checkbox">
                <span><strong>Highlight open seats.</strong> Tag seats without owners and label them clearly ‚Äì these become your hiring priorities.</span>
            </li>
            <li class="checklist-item">
                <input type="checkbox">
                <span><strong>Run ‚ÄúRight People / Right Seats‚Äù.</strong> Use the People Analyzer to test values fit and GWC (Gets it, Wants it, Capacity) and review the fit summary bar.</span>
            </li>
            <li class="checklist-item">
                <input type="checkbox">
                <span><strong>Turn open or mis-fit seats into job scorecards.</strong> Reuse purpose, responsibilities, and metrics to create external job ads and internal scorecards.</span>
            </li>
            <li class="checklist-item">
                <input type="checkbox">
                <span><strong>Revisit quarterly.</strong> Use this chart as an input into your V/TO and quarterly planning, adjusting seats as the org evolves.</span>
            </li>
        </ul>
    </section>
</div>

<script>
    const STORAGE_KEY = 'bearopsAccountabilityChart_v4';

    const state = {
        companyName: '',
        focusedFunctionId: null,
        functions: [] // {id, name, collapsed, seats:[{id, role, owner, purpose, responsibilities[], comms[], metrics[], decisions[], interfaces[], collapsed}]}
    };

    const companyNameInput = document.getElementById('companyName');
    const companyLabel = document.getElementById('companyLabel');
    const functionsGrid = document.getElementById('functionsGrid');
    const seatFunctionSelect = document.getElementById('seatFunctionSelect');
    const emptyState = document.getElementById('emptyState');
    const chartSummary = document.getElementById('chartSummary');

    const functionNameInput = document.getElementById('functionName');
    const seatRoleInput = document.getElementById('seatRole');
    const seatOwnerInput = document.getElementById('seatOwner');
    const seatPurposeInput = document.getElementById('seatPurpose');
    const seatResponsibilitiesInput = document.getElementById('seatResponsibilities');
    const seatCommsInput = document.getElementById('seatComms');
    const seatMetricsInput = document.getElementById('seatMetrics');
    const seatDecisionsInput = document.getElementById('seatDecisions');
    const seatInterfacesInput = document.getElementById('seatInterfaces');
    const seatCollapsedCheckbox = document.getElementById('seatCollapsed');

    const btnAddFunction = document.getElementById('btnAddFunction');
    const btnAddSeat = document.getElementById('btnAddSeat');
    const btnClearSeatForm = document.getElementById('btnClearSeatForm');
    const btnReset = document.getElementById('btnReset');
    const btnCollapseAll = document.getElementById('btnCollapseAll');
    const btnExpandAll = document.getElementById('btnExpandAll');

    const summaryFunctions = document.getElementById('summaryFunctions');
    const summarySeats = document.getElementById('summarySeats');
    const summaryEmpty = document.getElementById('summaryEmpty');

    const focusBar = document.getElementById('focusBar');
    const focusFunctionNameEl = document.getElementById('focusFunctionName');
    const btnClearFocus = document.getElementById('btnClearFocus');
    const togglePeople = document.getElementById('togglePeople');

    const themeLabel = document.getElementById('themeLabel');
    const themeToggleWrapper = document.querySelector('.toggle-pill');

    function generateId() {
        return 'fn_' + Math.random().toString(36).substr(2, 9);
    }

    function safeParseArray(value) {
        if (!value) return [];
        if (Array.isArray(value)) return value;
        if (typeof value !== 'string') return [];
        return value
            .split('\n')
            .map(r => r.trim())
            .filter(Boolean);
    }

    function saveState() {
        try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        } catch (e) {
            console.error('Failed to save chart', e);
        }
    }

    function loadState() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return;
            const parsed = JSON.parse(raw);
            if (parsed && typeof parsed === 'object') {
                state.companyName = parsed.companyName || '';
                state.focusedFunctionId = parsed.focusedFunctionId || null;
                state.functions = Array.isArray(parsed.functions) ? parsed.functions : [];

                state.functions.forEach(fn => {
                    if (typeof fn.collapsed !== 'boolean') fn.collapsed = false;
                    fn.seats = Array.isArray(fn.seats) ? fn.seats : [];
                    fn.seats.forEach(seat => {
                        if (typeof seat.collapsed !== 'boolean') seat.collapsed = true;
                    });
                });
            }
        } catch (e) {
            console.error('Failed to parse saved chart', e);
        }
    }

    function updateCompanyLabel() {
        if (state.companyName && state.companyName.trim() !== '') {
            companyLabel.textContent = state.companyName.trim() + ' ‚Ä¢ Accountability Chart';
        } else {
            companyLabel.textContent = '';
        }
    }

    function renderFunctionSelect() {
        seatFunctionSelect.innerHTML = '<option value="">Choose function‚Ä¶</option>';
        state.functions.forEach(fn => {
            const opt = document.createElement('option');
            opt.value = fn.id;
            opt.textContent = fn.name;
            seatFunctionSelect.appendChild(opt);
        });
    }

    function renderSummary() {
        const totalFunctions = state.functions.length;
        let totalSeats = 0;
        let emptySeats = 0;

        state.functions.forEach(fn => {
            fn.seats = Array.isArray(fn.seats) ? fn.seats : [];
            totalSeats += fn.seats.length;
            fn.seats.forEach(seat => {
                if (!seat.owner || !seat.owner.trim()) {
                    emptySeats++;
                }
            });
        });

        summaryFunctions.textContent = totalFunctions;
        summarySeats.textContent = totalSeats;
        summaryEmpty.textContent = emptySeats;

        chartSummary.innerHTML = '';

        if (totalFunctions === 0) return;

        const leaderFn = state.functions.find(fn => /lead|exec|founder|board/i.test(fn.name)) || null;
        if (leaderFn) {
            const pill = document.createElement('div');
            pill.className = 'pill-summary';
            pill.textContent = 'Leadership function: ' + leaderFn.name;
            chartSummary.appendChild(pill);
        }

        const openSeatPill = document.createElement('div');
        openSeatPill.className = 'pill-summary';
        openSeatPill.textContent = emptySeats === 0
            ? 'All seats have owners assigned.'
            : emptySeats + ' seat' + (emptySeats === 1 ? '' : 's') + ' with no owner (hiring / promotion opportunities).';
        chartSummary.appendChild(openSeatPill);

        const multiSeatFns = state.functions.filter(fn => fn.seats.length >= 4);
        if (multiSeatFns.length > 0) {
            const names = multiSeatFns.map(f => f.name).join(', ');
            const pill = document.createElement('div');
            pill.className = 'pill-summary';
            pill.textContent = 'Broad functions: ' + names + ' ‚Äì consider splitting into clearer sub-functions.';
            chartSummary.appendChild(pill);
        }
    }

    function createDetailBlock(title, contentOrList) {
        if (!contentOrList) return null;
        const isArray = Array.isArray(contentOrList);
        const lines = isArray ? contentOrList : safeParseArray(contentOrList);
        if (!lines.length && typeof contentOrList === 'string' && !contentOrList.trim()) {
            return null;
        }

        const block = document.createElement('div');
        block.className = 'seat-detail-block';

        const titleEl = document.createElement('div');
        titleEl.className = 'seat-detail-title';
        titleEl.textContent = title;

        const bodyEl = document.createElement('div');
        bodyEl.className = 'seat-detail-body';

        if (lines.length) {
            const ul = document.createElement('ul');
            ul.style.paddingLeft = '16px';
            ul.style.margin = '0';
            lines.forEach(line => {
                const li = document.createElement('li');
                li.textContent = line;
                ul.appendChild(li);
            });
            bodyEl.appendChild(ul);
        } else {
            bodyEl.textContent = typeof contentOrList === 'string' ? contentOrList : '';
        }

        block.appendChild(titleEl);
        block.appendChild(bodyEl);
        return block;
    }

    function renderChart() {
        functionsGrid.innerHTML = '';

        if (state.functions.length === 0) {
            emptyState.style.display = 'block';
        } else {
            emptyState.style.display = 'none';
        }

        // Focus pill bar
        if (state.focusedFunctionId) {
            const focusedFn = state.functions.find(f => f.id === state.focusedFunctionId);
            if (focusedFn) {
                focusBar.style.display = 'flex';
                focusFunctionNameEl.textContent = focusedFn.name;
            } else {
                focusBar.style.display = 'none';
                focusFunctionNameEl.textContent = '';
                state.focusedFunctionId = null;
            }
        } else {
            focusBar.style.display = 'none';
            focusFunctionNameEl.textContent = '';
        }

        state.functions.forEach(fn => {
            if (typeof fn.collapsed !== 'boolean') fn.collapsed = false;

            const card = document.createElement('div');
            card.className = 'function-card';
            if (fn.collapsed) card.classList.add('collapsed');

            const header = document.createElement('div');
            header.className = 'function-header';

            const headerLeft = document.createElement('div');
            headerLeft.className = 'function-header-left';

            const nameEl = document.createElement('div');
            nameEl.className = 'function-name';
            nameEl.textContent = fn.name;

            const seatCount = document.createElement('div');
            seatCount.className = 'seat-count';
            seatCount.textContent = fn.seats.length + ' seat' + (fn.seats.length === 1 ? '' : 's');

            headerLeft.appendChild(nameEl);
            headerLeft.appendChild(seatCount);

            const headerRight = document.createElement('div');
            headerRight.className = 'function-header-right';

            // Focus icon if this is the focused function
            if (state.focusedFunctionId && state.focusedFunctionId === fn.id) {
                const focusIcon = document.createElement('button');
                focusIcon.className = 'function-focus-icon';
                focusIcon.type = 'button';
                focusIcon.title = 'Click to clear focus and show all functions';
                focusIcon.addEventListener('click', clearFocus);

                const iconSpan = document.createElement('span');
                iconSpan.className = 'icon';
                iconSpan.textContent = 'üéØ';

                const textSpan = document.createElement('span');
                textSpan.textContent = 'Focused';

                focusIcon.appendChild(iconSpan);
                focusIcon.appendChild(textSpan);

                headerRight.appendChild(focusIcon);
            }

            // Per-function seat detail collapse/expand
            const collapseSeatsBtn = document.createElement('button');
            collapseSeatsBtn.className = 'mini-button';
            collapseSeatsBtn.textContent = 'Collapse seats';
            collapseSeatsBtn.addEventListener('click', () => collapseAllSeatsInFunction(fn.id));

            const expandSeatsBtn = document.createElement('button');
            expandSeatsBtn.className = 'mini-button';
            expandSeatsBtn.textContent = 'Expand seats';
            expandSeatsBtn.addEventListener('click', () => expandAllSeatsInFunction(fn.id));

            headerRight.appendChild(collapseSeatsBtn);
            headerRight.appendChild(expandSeatsBtn);

            const deleteFnBtn = document.createElement('button');
            deleteFnBtn.className = 'mini-button danger';
            deleteFnBtn.textContent = 'Delete';
            deleteFnBtn.title = 'Delete this function and all its seats';
            deleteFnBtn.addEventListener('click', () => deleteFunction(fn.id));
            headerRight.appendChild(deleteFnBtn);

            const toggleBtn = document.createElement('button');
            toggleBtn.className = 'mini-button';
            toggleBtn.textContent = fn.collapsed ? 'Show seats' : 'Hide seats';
            toggleBtn.addEventListener('click', () => toggleFunctionCollapse(fn.id));

            headerRight.appendChild(toggleBtn);

            header.appendChild(headerLeft);
            header.appendChild(headerRight);

            const seatsList = document.createElement('div');
            seatsList.className = 'seats-list';

            if (fn.seats.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'empty-state';
                empty.textContent = 'No seats yet. Add roles for this function on the left.';
                seatsList.appendChild(empty);
            } else if (!fn.collapsed) {
                fn.seats.forEach(seat => {
                    if (typeof seat.collapsed !== 'boolean') seat.collapsed = true;

                    const seatCard = document.createElement('div');
                    seatCard.className = 'seat-card';
                    if (seat.collapsed) seatCard.classList.add('collapsed-details');

                    const seatTop = document.createElement('div');
                    seatTop.className = 'seat-top';

                    const seatRole = document.createElement('div');
                    seatRole.className = 'seat-role';
                    seatRole.textContent = seat.role;

                    const seatOwner = document.createElement('div');
                    seatOwner.className = 'seat-owner';

                    if (!togglePeople.checked) {
                        if (!seat.owner || !seat.owner.trim()) {
                            seatOwner.textContent = 'Open seat';
                            seatOwner.classList.add('empty');
                        } else {
                            seatOwner.textContent = 'Owned by ' + seat.owner;
                        }
                    } else {
                        if (!seat.owner || !seat.owner.trim()) {
                            seatOwner.textContent = 'No owner yet';
                            seatOwner.classList.add('empty');
                        } else {
                            seatOwner.textContent = seat.owner;
                        }
                    }

                    seatTop.appendChild(seatRole);
                    seatTop.appendChild(seatOwner);

                    // click header to toggle this seat only
                    seatTop.addEventListener('click', () => toggleSeatCollapse(fn.id, seat.id));

                    seatCard.appendChild(seatTop);

                    if (!seat.collapsed) {
                        const meta = document.createElement('div');
                        meta.className = 'seat-meta';
                        meta.textContent = (seat.responsibilities?.length || 0) + ' key responsibilities';
                        seatCard.appendChild(meta);

                        const purposeBlock = createDetailBlock('Purpose', seat.purpose);
                        if (purposeBlock) seatCard.appendChild(purposeBlock);

                        if ((seat.responsibilities || []).length)
                            seatCard.appendChild(createDetailBlock('Scope & Responsibilities', seat.responsibilities));

                        const commsBlock = createDetailBlock('Communication Norms', seat.comms || []);
                        if (commsBlock) seatCard.appendChild(commsBlock);

                        const metricsBlock = createDetailBlock('Metrics of Success', seat.metrics || []);
                        if (metricsBlock) seatCard.appendChild(metricsBlock);

                        const decisionsBlock = createDetailBlock('Key Decisions', seat.decisions || []);
                        if (decisionsBlock) seatCard.appendChild(decisionsBlock);

                        const interfacesBlock = createDetailBlock('Interfaces & Handoffs', seat.interfaces || []);
                        if (interfacesBlock) seatCard.appendChild(interfacesBlock);
                    } else {
                        if ((seat.responsibilities || []).length > 0) {
                            const collapsedNote = document.createElement('div');
                          
                         
                            seatCard.appendChild(collapsedNote);
                        }
                    }

                    seatsList.appendChild(seatCard);
                });
            } else if (fn.seats.length > 0) {
                const collapsedNote = document.createElement('div');
                collapsedNote.className = 'empty-state';
                collapsedNote.textContent = 'Seats hidden ‚Äì click "Show seats" to expand.';
                seatsList.appendChild(collapsedNote);
            }

            card.appendChild(header);
            card.appendChild(seatsList);
            functionsGrid.appendChild(card);
        });

        renderSummary();
    }

    function addFunction() {
        const name = functionNameInput.value.trim();
        if (!name) {
            alert('Please enter a function name.');
            return;
        }
        const existing = state.functions.find(fn => fn.name.toLowerCase() === name.toLowerCase());
        if (existing) {
            alert('That function already exists.');
            return;
        }
        state.functions.push({ id: generateId(), name, collapsed: false, seats: [] });
        functionNameInput.value = '';
        saveState();
        renderFunctionSelect();
        renderChart();
    }

    function deleteFunction(functionId) {
        const idx = state.functions.findIndex(fn => fn.id === functionId);
        if (idx === -1) return;
        const fn = state.functions[idx];
        const confirmed = confirm('Delete function "' + fn.name + '" and all its seats? This cannot be undone.');
        if (!confirmed) return;
        if (state.focusedFunctionId === functionId) {
            state.focusedFunctionId = null;
        }
        state.functions.splice(idx, 1);
        saveState();
        renderFunctionSelect();
        renderChart();
    }

    function clearFunctionForm() {
        functionNameInput.value = '';
    }

    function parseLines(value) {
        return value
            .split('\n')
            .map(r => r.trim())
            .filter(Boolean);
    }

    function addSeat() {
        const functionId = seatFunctionSelect.value;
        if (!functionId) {
            alert('Please choose a function before adding a seat.');
            return;
        }
        const fn = state.functions.find(f => f.id === functionId);
        if (!fn) {
            alert('Selected function not found.');
            return;
        }

        const role = seatRoleInput.value.trim();
        if (!role) {
            alert('Please add a seat / role title.');
            return;
        }

        const owner = seatOwnerInput.value.trim();
        const purpose = seatPurposeInput.value.trim();
        const responsibilities = parseLines(seatResponsibilitiesInput.value || '');
        const comms = parseLines(seatCommsInput.value || '');
        const metrics = parseLines(seatMetricsInput.value || '');
        const decisions = parseLines(seatDecisionsInput.value || '');
        const interfaces = parseLines(seatInterfacesInput.value || '');
        const collapsed = !!seatCollapsedCheckbox.checked;

        fn.seats.push({
            id: generateId(),
            role,
            owner,
            purpose,
            responsibilities,
            comms,
            metrics,
            decisions,
            interfaces,
            collapsed
        });

        clearSeatForm(false);
        saveState();
        renderChart();
    }

    function clearSeatForm(resetFunction = false) {
        if (resetFunction) seatFunctionSelect.value = '';
        seatRoleInput.value = '';
        seatOwnerInput.value = '';
        seatPurposeInput.value = '';
        seatResponsibilitiesInput.value = '';
        seatCommsInput.value = '';
        seatMetricsInput.value = '';
        seatDecisionsInput.value = '';
        seatInterfacesInput.value = '';
        seatCollapsedCheckbox.checked = true;
    }

    function resetChart() {
        const confirmReset = confirm('This will clear all functions and seats from the chart. You cannot undo this. Continue?');
        if (!confirmReset) return;
        state.companyName = '';
        state.functions = [];
        state.focusedFunctionId = null;
        companyNameInput.value = '';
        saveState();
        updateCompanyLabel();
        renderFunctionSelect();
        renderChart();
    }

    function collapseAllFunctions() {
        state.functions.forEach(fn => {
            fn.collapsed = true;
        });
        saveState();
        renderChart();
    }

    function expandAllFunctions() {
        state.functions.forEach(fn => {
            fn.collapsed = false;
        });
        saveState();
        renderChart();
    }

    function toggleFunctionCollapse(functionId) {
        const fn = state.functions.find(f => f.id === functionId);
        if (!fn) return;
        fn.collapsed = !fn.collapsed;
        saveState();
        renderChart();
    }

    function toggleSeatCollapse(functionId, seatId) {
        const fn = state.functions.find(f => f.id === functionId);
        if (!fn) return;
        const seat = fn.seats.find(s => s.id === seatId);
        if (!seat) return;
        seat.collapsed = !seat.collapsed;
        saveState();
        renderChart();
    }

    function collapseAllSeatsInFunction(functionId) {
        const fn = state.functions.find(f => f.id === functionId);
        if (!fn) return;
        fn.seats.forEach(seat => { seat.collapsed = true; });
        saveState();
        renderChart();
    }

    function expandAllSeatsInFunction(functionId) {
        const fn = state.functions.find(f => f.id === functionId);
        if (!fn) return;
        fn.seats.forEach(seat => { seat.collapsed = false; });
        saveState();
        renderChart();
    }

    function clearFocus() {
        state.focusedFunctionId = null;
        state.functions.forEach(fn =>
            fn.collapsed = false
        );
        saveState();
        renderChart();
    }

    function initTheme() {
        const stored = localStorage.getItem('bearopsTheme') || 'dark';
        if (stored === 'light') {
            document.body.classList.add('light');
            themeLabel.textContent = '‚òÄÔ∏è Light';
        } else {
            document.body.classList.remove('light');
            themeLabel.textContent = 'üåô Dark';
        }
    }

    function toggleTheme() {
        if (document.body.classList.contains('light')) {
            document.body.classList.remove('light');
            themeLabel.textContent = 'üåô Dark';
            localStorage.setItem('bearopsTheme', 'dark');
        } else {
            document.body.classList.add('light');
            themeLabel.textContent = '‚òÄÔ∏è Light';
            localStorage.setItem('bearopsTheme', 'light');
        }
    }

    companyNameInput.addEventListener('input', () => {
        state.companyName = companyNameInput.value;
        updateCompanyLabel();
        saveState();
    });

    btnAddFunction.addEventListener('click', addFunction);
    btnAddSeat.addEventListener('click', addSeat);
    btnClearSeatForm.addEventListener('click', () => clearSeatForm(true));
    btnReset.addEventListener('click', resetChart);
    togglePeople.addEventListener('change', renderChart);
    themeToggleWrapper.addEventListener('click', toggleTheme);
    btnCollapseAll.addEventListener('click', collapseAllFunctions);
    btnExpandAll.addEventListener('click', expandAllFunctions);
    btnClearFocus.addEventListener('click', clearFocus);

    // Init
    loadState();
    companyNameInput.value = state.companyName || '';
    updateCompanyLabel();
    renderFunctionSelect();
    renderChart();
    initTheme();
</script>

</body>
</html>
