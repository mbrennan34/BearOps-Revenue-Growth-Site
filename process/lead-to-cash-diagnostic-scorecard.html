<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lead-to-Cash Diagnostic & Scorecard | BearOps</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
            background:linear-gradient(135deg,#0a1628 0%,#0f1f3a 50%,#1a2942 100%);
            color:#e2e8f0;
            padding:24px;
            min-height:100vh;
        }
        .container{max-width:1400px;margin:0 auto;}

        .header{
            background:rgba(15,23,42,.85);
            border:1px solid rgba(148,163,184,.3);
            border-radius:12px;
            padding:32px;
            margin-bottom:32px;
            backdrop-filter:blur(10px);
        }
        .header h1{
            font-size:2rem;
            font-weight:700;
            margin-bottom:12px;
            color:#fff;
        }
        .header p{color:#94a3b8;line-height:1.6;font-size:1rem;}
        .progress-bar{
            height:8px;
            background:rgba(15,23,42,.8);
            border-radius:4px;
            margin-top:24px;
            overflow:hidden;
        }
        .progress-fill{
            height:100%;
            width:0%;
            background:linear-gradient(90deg,#22c55e,#4ade80);
            transition:width .25s ease;
        }

        .phase-tabs{
            display:flex;
            gap:8px;
            margin:24px 0 24px;
            overflow-x:auto;
            padding-bottom:8px;
        }
        .phase-tab{
            padding:10px 18px;
            background:rgba(15,23,42,.6);
            border:2px solid rgba(148,163,184,.35);
            border-radius:999px;
            font-size:.8rem;
            cursor:pointer;
            white-space:nowrap;
            font-weight:600;
            color:#cbd5e1;
            transition:.18s all ease;
        }
        .phase-tab:hover{
            border-color:rgba(148,163,184,.65);
            background:rgba(15,23,42,.9);
        }
        .phase-tab.active{
            background:rgba(34,197,94,.2);
            border-color:#22c55e;
            color:#bbf7d0;
        }
        .phase-tab.completed{
            opacity:.9;
            border-color:rgba(34,197,94,.5);
        }

        #questionCards{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
            gap:16px;
            margin-bottom:32px;
        }
        .question-card{
            background:rgba(15,23,42,.9);
            border-radius:12px;
            border:1px solid rgba(148,163,184,.25);
            padding:18px 18px 14px;
            display:flex;
            flex-direction:column;
            gap:10px;
        }
        .question-text{font-size:.95rem;font-weight:500;color:#e2e8f0;}
        .question-subtext{font-size:.8rem;color:#94a3b8;}

        .rating-options{
            display:flex;
            gap:8px;
            margin-top:4px;
        }
        .rating-option{
            flex:1;
            background:rgba(15,23,42,.8);
            border-radius:8px;
            border:1px solid rgba(148,163,184,.35);
            padding:8px;
            font-size:.75rem;
            cursor:pointer;
            text-align:left;
            transition:.18s all ease;
        }
        .rating-option:hover{
            border-color:rgba(148,163,184,.75);
            background:rgba(15,23,42,.95);
        }
        .rating-option.selected{
            background:rgba(34,197,94,.18);
            border-color:#22c55e;
        }
        .rating-label{
            font-weight:600;
            margin-bottom:4px;
            color:#e2e8f0;
        }
        .rating-desc{color:#9ca3af;font-size:.7rem;}

        .results-section{
            display:none;
            margin-top:16px;
        }
        .results-section.active{display:block;}

        .score-summary{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(210px,1fr));
            gap:16px;
            margin-bottom:24px;
        }
        .score-card{
            background:rgba(15,23,42,.9);
            border-radius:12px;
            border:1px solid rgba(148,163,184,.25);
            padding:18px 18px 14px;
        }
        .score-card.overall{
            border-color:rgba(34,197,94,.8);
            box-shadow:0 0 18px rgba(34,197,94,.3);
        }
        .score-label{font-size:.9rem;color:#94a3b8;margin-bottom:4px;}
        .score-value{font-size:1.6rem;font-weight:700;margin-bottom:2px;color:#e5e7eb;}
        .score-rating{font-size:.8rem;color:#a5b4fc;}
        .score-pill{
            display:inline-flex;
            align-items:center;
            gap:6px;
            margin-top:6px;
            padding:2px 8px;
            border-radius:999px;
            font-size:.7rem;
            border:1px solid rgba(148,163,184,.4);
            color:#cbd5e1;
        }

        .exec-summary{
            background:rgba(15,23,42,.92);
            border-radius:12px;
            border:1px solid rgba(148,163,184,.35);
            padding:20px 20px 18px;
            margin-bottom:24px;
        }
        .exec-summary h3{
            font-size:1.1rem;
            margin-bottom:8px;
        }
        .exec-summary p{
            font-size:.9rem;
            color:#cbd5e1;
            margin-bottom:6px;
        }
        .exec-tags{
            margin-top:6px;
            display:flex;
            flex-wrap:wrap;
            gap:8px;
        }
        .tag{
            font-size:.75rem;
            padding:4px 10px;
            border-radius:999px;
            background:rgba(15,23,42,.9);
            border:1px solid rgba(148,163,184,.4);
        }

        .chart-container{
            background:rgba(15,23,42,.9);
            border-radius:12px;
            border:1px solid rgba(148,163,184,.25);
            padding:24px;
            margin-bottom:24px;
        }
        .chart-container h3{
            font-size:1.1rem;
            margin-bottom:16px;
        }

        .recommendations{
            background:rgba(15,23,42,.92);
            border-radius:12px;
            border:1px solid rgba(148,163,184,.3);
            padding:24px;
            margin-bottom:24px;
        }
        .recommendations-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:8px;
        }
        .recommendations h3{font-size:1.1rem;}
        .recommendations-intro{
            font-size:.9rem;
            color:#94a3b8;
            margin-bottom:10px;
        }
        .recommendation-item{
            background:rgba(15,23,42,1);
            border-radius:10px;
            border-left:4px solid #fbbf24;
            padding:16px 16px 12px;
            margin-bottom:14px;
        }
        .recommendation-item.high-priority{border-left-color:#ef4444;}
        .recommendation-item.medium-priority{border-left-color:#fbbf24;}
        .recommendation-item.low-priority{border-left-color:#22c55e;}
        .recommendation-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:6px;
            gap:8px;
        }
        .recommendation-title{
            font-size:.98rem;
            font-weight:600;
        }
        .priority-badge{
            padding:3px 10px;
            border-radius:999px;
            font-size:.7rem;
            text-transform:uppercase;
            font-weight:600;
        }
        .priority-high{background:rgba(239,68,68,.18);color:#fecaca;}
        .priority-medium{background:rgba(251,191,36,.18);color:#fef3c7;}
        .priority-low{background:rgba(34,197,94,.18);color:#bbf7d0;}

        .recommendation-description{font-size:.86rem;color:#cbd5e1;margin-bottom:6px;}
        .rec-actions{margin:4px 0 6px 16px;font-size:.84rem;color:#cbd5e1;}
        .rec-actions li{margin-bottom:3px;}
        .recommendation-impact{
            font-size:.8rem;
            color:#94a3b8;
            margin-top:2px;
        }
        .rec-owner-chip{
            display:inline-flex;
            align-items:center;
            gap:6px;
            font-size:.78rem;
            margin-top:4px;
            padding:3px 9px;
            border-radius:999px;
            border:1px solid rgba(148,163,184,.5);
            background:rgba(15,23,42,.9);
        }

        .toggle-link{
            cursor:pointer;
            font-size:.78rem;
            color:#a5b4fc;
            text-decoration:underline;
        }

        .cta-panel{
            background:rgba(15,23,42,.95);
            border-radius:12px;
            border:1px dashed rgba(148,163,184,.5);
            padding:18px 18px 14px;
            margin-bottom:24px;
        }
        .cta-panel h3{font-size:1rem;margin-bottom:6px;}
        .cta-panel p{
            font-size:.85rem;
            color:#cbd5e1;
            margin-bottom:6px;
        }

        .action-buttons{
            display:flex;
            flex-wrap:wrap;
            gap:12px;
            margin-top:8px;
        }
        .btn{
            border:none;
            border-radius:999px;
            padding:10px 16px;
            font-size:.85rem;
            cursor:pointer;
            display:inline-flex;
            align-items:center;
            gap:6px;
        }
        .btn-primary{
            background:linear-gradient(135deg,#22c55e,#4ade80);
            color:#022c22;
            font-weight:600;
        }
        .btn-secondary{
            background:rgba(15,23,42,.9);
            color:#e5e7eb;
            border:1px solid rgba(148,163,184,.4);
        }

        @media(max-width:768px){
            .rating-options{flex-direction:column;}
            .score-summary{grid-template-columns:1fr;}
            .recommendation-header{flex-direction:column;align-items:flex-start;}
        }

/* === Revert question layout to previous, single-column style === */
#questionCards {
    display: block !important;      /* no grid */
}

.question-card {
    width: 100% !important;         /* span the container */
    max-width: 100% !important;
    margin-bottom: 24px !important; /* breathing room between questions */
}

.rating-options {
    display: flex !important;
    gap: 8px !important;
    flex-wrap: wrap !important;     /* wrap nicely on smaller screens */
}

.rating-option {
    flex: 1 1 0 !important;
    min-width: 140px !important;    /* stops cards getting too skinny */
}

    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ðŸŽ¯ Lead-to-Cash Diagnostic & Scorecard</h1>
        <p>
            Assess your lead-to-cash maturity across all five phases. Answer 25 questions and weâ€™ll calculate your score,
            benchmark you against a typical Series A/B GTM engine, surface your top bottlenecks and outline a 90-day
            Now / Next / Later plan.
        </p>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>

    <div id="assessmentSection">
        <div class="phase-tabs" id="phaseTabs"></div>
        <div id="questionCards"></div>
    </div>

    <div id="resultsSection" class="results-section">
        <div class="score-summary">
            <div class="score-card overall">
                <div class="score-label">Overall L2C Maturity Score</div>
                <div class="score-value" id="overallScore">0.0</div>
                <div class="score-rating" id="overallRating">Not assessed</div>
                <div class="score-pill" id="overallPill">â€“</div>
            </div>
            <div class="score-card">
                <div class="score-label">Lead-to-Qualify</div>
                <div class="score-value" id="phase1Score">0.0</div>
                <div class="score-rating" id="phase1Label">â€“</div>
            </div>
            <div class="score-card">
                <div class="score-label">Qualify-to-Order</div>
                <div class="score-value" id="phase2Score">0.0</div>
                <div class="score-rating" id="phase2Label">â€“</div>
            </div>
            <div class="score-card">
                <div class="score-label">Order-to-Cash</div>
                <div class="score-value" id="phase3Score">0.0</div>
                <div class="score-rating" id="phase3Label">â€“</div>
            </div>
            <div class="score-card">
                <div class="score-label">Cash-to-Care</div>
                <div class="score-value" id="phase4Score">0.0</div>
                <div class="score-rating" id="phase4Label">â€“</div>
            </div>
            <div class="score-card">
                <div class="score-label">Retain-to-Grow</div>
                <div class="score-value" id="phase5Score">0.0</div>
                <div class="score-rating" id="phase5Label">â€“</div>
            </div>
        </div>

        <div class="exec-summary" id="execSummary"></div>

        <div class="chart-container">
            <h3>ðŸ“Š L2C Maturity Radar</h3>
            <canvas id="radarChart" style="max-height:360px;"></canvas>
        </div>

        <div class="chart-container">
            <h3>ðŸ“ˆ Phase-by-Phase Comparison</h3>
            <canvas id="barChart" style="max-height:260px;"></canvas>
        </div>

        <div class="recommendations">
            <div class="recommendations-header">
                <h3>ðŸ’¡ Priority Recommendations</h3>
                <span class="toggle-link" id="toggleRecView">Show all recommendations</span>
            </div>
            <p class="recommendations-intro" id="recommendationsIntro"></p>
            <div id="recommendationsList"></div>
        </div>

        <div class="cta-panel">
            <h3>ðŸ§© Turn this into a 90-Day L2C Upgrade Plan</h3>
            <p>
                Use this scorecard as a working doc with your leadership team. Focus on one or two bottlenecks at a time,
                make the KPIs visible and revisit the radar monthly.
            </p>
            <p>
                If youâ€™d like, this can become the backbone of a 4â€“6 week BearOps sprint: mapping your current L2C,
                defining the future state and sequencing changes into realistic Rocks.
            </p>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="alert('In a live deployment this would deep-link to a Calendly / booking page.')">
                    ðŸš€ Book a working session
                </button>
                <button class="btn btn-secondary" onclick="exportResults()">
                    ðŸ“„ Export JSON Results
                </button>
                <button class="btn btn-secondary" onclick="restartAssessment()">
                    ðŸ”„ Retake Assessment
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // =========================
    // Data Model
    // =========================
    const phases = [
        {
            id:'phase1',
            name:'Lead-to-Qualify',
            description:'Marketing & Demand',
            questions:[
                {
                    text:'How effectively does your marketing generate qualified leads?',
                    ratings:[
                        {score:1,label:'Poor',description:'Little repeatable demand, sporadic campaigns'},
                        {score:2,label:'Basic',description:'Some channels work but inconsistent'},
                        {score:3,label:'Developing',description:'Repeatable channels, basic attribution'},
                        {score:4,label:'Advanced',description:'Multi-channel engine with clear CAC'},
                        {score:5,label:'Optimized',description:'Always-on engine, CAC by segment is known'}
                    ]
                },
                {
                    text:'How well-defined is your ICP and MQL/SQL criteria?',
                    ratings:[
                        {score:1,label:'Poor',description:'No common view of ICP'},
                        {score:2,label:'Basic',description:'ICP written, not used in decisions'},
                        {score:3,label:'Developing',description:'ICP & MQ definitions used by some teams'},
                        {score:4,label:'Advanced',description:'ICP + MQ used in targeting & scoring'},
                        {score:5,label:'Optimized',description:'ICP refined quarterly based on data'}
                    ]
                },
                {
                    text:'How integrated are your marketing and sales systems?',
                    ratings:[
                        {score:1,label:'Poor',description:'Spreadsheets, manual handoffs'},
                        {score:2,label:'Basic',description:'Form â†’ email â†’ manual CRM update'},
                        {score:3,label:'Developing',description:'Marketing automation to CRM sync'},
                        {score:4,label:'Advanced',description:'Tight sync with campaign influence'},
                        {score:5,label:'Optimized',description:'Full funnel visibility with multi-touch attribution'}
                    ]
                },
                {
                    text:'How quickly are inbound leads followed up?',
                    ratings:[
                        {score:1,label:'Poor',description:'Often days or weeks'},
                        {score:2,label:'Basic',description:'Within 24â€“48 hours'},
                        {score:3,label:'Developing',description:'Same day for most leads'},
                        {score:4,label:'Advanced',description:'Within 2â€“4 hours'},
                        {score:5,label:'Optimized',description:'Minutes, routed by intent and ICP fit'}
                    ]
                },
                {
                    text:'How clearly do you track funnel conversion (MQL â†’ SQL â†’ Opportunity)?',
                    ratings:[
                        {score:1,label:'Poor',description:'Not tracked'},
                        {score:2,label:'Basic',description:'Tracked manually, lagging'},
                        {score:3,label:'Developing',description:'Basic CRM funnel reports'},
                        {score:4,label:'Advanced',description:'Cohort-level conversion by segment'},
                        {score:5,label:'Optimized',description:'Always-on monitoring and experiments'}
                    ]
                }
            ]
        },
        {
            id:'phase2',
            name:'Qualify-to-Order',
            description:'Sales Execution',
            questions:[
                {
                    text:'How clearly defined is your sales process and stage exit criteria?',
                    ratings:[
                        {score:1,label:'Poor',description:'Every rep sells differently'},
                        {score:2,label:'Basic',description:'Stages exist but loosely used'},
                        {score:3,label:'Developing',description:'Stages + exit criteria mostly followed'},
                        {score:4,label:'Advanced',description:'Stages embedded into CRM hygiene'},
                        {score:5,label:'Optimized',description:'Continuously tuned based on win/loss and cycle time'}
                    ]
                },
                {
                    text:'How robust is your discovery and qualification discipline?',
                    ratings:[
                        {score:1,label:'Poor',description:'Little structured discovery'},
                        {score:2,label:'Basic',description:'Some frameworks used inconsistently'},
                        {score:3,label:'Developing',description:'MEDDICC/BANT used for bigger deals'},
                        {score:4,label:'Advanced',description:'Framework embedded in CRM + coaching'},
                        {score:5,label:'Optimized',description:'Data-backed discovery quality reviews'}
                    ]
                },
                {
                    text:'How effective is your approval workflow for non-standard deals?',
                    ratings:[
                        {score:1,label:'Poor',description:'Ad-hoc email approvals'},
                        {score:2,label:'Basic',description:'Informal thresholds by manager'},
                        {score:3,label:'Developing',description:'Workflow with clear bands'},
                        {score:4,label:'Advanced',description:'Tracked SLAs, delegated authority'},
                        {score:5,label:'Optimized',description:'Fast, data-backed decisions with guardrails'}
                    ]
                },
                {
                    text:'How do you manage pricing & discounting hygiene?',
                    ratings:[
                        {score:1,label:'Poor',description:'Discounts ad-hoc, no guardrails'},
                        {score:2,label:'Basic',description:'Some guidelines but poorly enforced'},
                        {score:3,label:'Developing',description:'Playbook by segment or deal size'},
                        {score:4,label:'Advanced',description:'Deal desk & clear approval bands'},
                        {score:5,label:'Optimized',description:'Price/discount strategy tuned by data'}
                    ]
                },
                {
                    text:'How visible and reliable is your pipeline & forecast?',
                    ratings:[
                        {score:1,label:'Poor',description:'Subjective, last-minute updates'},
                        {score:2,label:'Basic',description:'Spreadsheet-based forecast'},
                        {score:3,label:'Developing',description:'CRM forecast with hygiene rules'},
                        {score:4,label:'Advanced',description:'Stage-based, probability-weighted forecast'},
                        {score:5,label:'Optimized',description:'Predictive forecasting based on history & intent'}
                    ]
                }
            ]
        },
        {
            id:'phase3',
            name:'Order-to-Cash',
            description:'Fulfilment & Billing',
            questions:[
                {
                    text:'How integrated is order capture with fulfilment / provisioning?',
                    ratings:[
                        {score:1,label:'Poor',description:'Manual handoffs, errors common'},
                        {score:2,label:'Basic',description:'Email/tasks triggering fulfilment'},
                        {score:3,label:'Developing',description:'Some system integrations'},
                        {score:4,label:'Advanced',description:'CRM/ERP integration with tracking'},
                        {score:5,label:'Optimized',description:'End-to-end orchestration with alerts'}
                    ]
                },
                {
                    text:'How accurate and timely is your invoicing?',
                    ratings:[
                        {score:1,label:'Poor',description:'Frequent delays & errors'},
                        {score:2,label:'Basic',description:'Templates, 5+ days post delivery'},
                        {score:3,label:'Developing',description:'Semi-automated, 2â€“5 days'},
                        {score:4,label:'Advanced',description:'Automated, 24â€“48 hours'},
                        {score:5,label:'Optimized',description:'Real-time, near-zero errors'}
                    ]
                },
                {
                    text:'What is your Days Sales Outstanding (DSO)?',
                    ratings:[
                        {score:1,label:'Poor',description:'60+ days'},
                        {score:2,label:'Basic',description:'45â€“60 days'},
                        {score:3,label:'Developing',description:'30â€“45 days'},
                        {score:4,label:'Advanced',description:'20â€“30 days'},
                        {score:5,label:'Optimized',description:'< 20 days'}
                    ]
                },
                {
                    text:'How effective is your collections process?',
                    ratings:[
                        {score:1,label:'Poor',description:'Reactive, no cadence'},
                        {score:2,label:'Basic',description:'Manual reminders only'},
                        {score:3,label:'Developing',description:'Structured cadence & escalation'},
                        {score:4,label:'Advanced',description:'Automated reminders & tracking'},
                        {score:5,label:'Optimized',description:'Risk-based, proactive collections'}
                    ]
                },
                {
                    text:'How do you manage revenue recognition & compliance?',
                    ratings:[
                        {score:1,label:'Poor',description:'Manual spreadsheets'},
                        {score:2,label:'Basic',description:'Quarterly review'},
                        {score:3,label:'Developing',description:'System-supported, monthly close'},
                        {score:4,label:'Advanced',description:'Automated rules, ASC 606 aware'},
                        {score:5,label:'Optimized',description:'Real-time, fully auditable'}
                    ]
                }
            ]
        },
        {
            id:'phase4',
            name:'Cash-to-Care',
            description:'Customer Success & Support',
            questions:[
                {
                    text:'How proactive is your post-sale onboarding & engagement?',
                    ratings:[
                        {score:1,label:'Poor',description:'Mostly reactive support'},
                        {score:2,label:'Basic',description:'Occasional onboarding calls'},
                        {score:3,label:'Developing',description:'Structured onboarding for key tiers'},
                        {score:4,label:'Advanced',description:'Defined journeys across all segments'},
                        {score:5,label:'Optimized',description:'Health-based, multi-channel engagement'}
                    ]
                },
                {
                    text:'How quickly do you resolve customer issues?',
                    ratings:[
                        {score:1,label:'Poor',description:'5+ days average'},
                        {score:2,label:'Basic',description:'2â€“5 days'},
                        {score:3,label:'Developing',description:'1â€“2 days'},
                        {score:4,label:'Advanced',description:'Same-day for most tickets'},
                        {score:5,label:'Optimized',description:'Real-time, AI-assisted resolution'}
                    ]
                },
                {
                    text:'How do you measure and act on customer satisfaction?',
                    ratings:[
                        {score:1,label:'Poor',description:'No formal metrics'},
                        {score:2,label:'Basic',description:'Annual survey only'},
                        {score:3,label:'Developing',description:'Regular NPS/CSAT with some actions'},
                        {score:4,label:'Advanced',description:'Closed-loop feedback by segment'},
                        {score:5,label:'Optimized',description:'Real-time sentiment & churn signals'}
                    ]
                },
                {
                    text:'How accessible is customer history to your CS/support team?',
                    ratings:[
                        {score:1,label:'Poor',description:'Scattered across tools'},
                        {score:2,label:'Basic',description:'Some notes in CRM'},
                        {score:3,label:'Developing',description:'Single place for most info'},
                        {score:4,label:'Advanced',description:'360Â° view incl. product usage'},
                        {score:5,label:'Optimized',description:'Unified, real-time workspace'}
                    ]
                },
                {
                    text:'How aligned are CS targets with revenue outcomes?',
                    ratings:[
                        {score:1,label:'Poor',description:'No clear targets'},
                        {score:2,label:'Basic',description:'Support SLAs only'},
                        {score:3,label:'Developing',description:'Renewal targets for some accounts'},
                        {score:4,label:'Advanced',description:'CS tied to retention & expansion'},
                        {score:5,label:'Optimized',description:'Shared NRR and advocacy goals'}
                    ]
                }
            ]
        },
        {
            id:'phase5',
            name:'Retain-to-Grow',
            description:'Renewals & Expansion',
            questions:[
                {
                    text:'How predictable is your renewal process?',
                    ratings:[
                        {score:1,label:'Poor',description:'Renewals often surprise the team'},
                        {score:2,label:'Basic',description:'Tracked in spreadsheets'},
                        {score:3,label:'Developing',description:'Tracked in CRM with owners'},
                        {score:4,label:'Advanced',description:'Renewal playbooks by segment'},
                        {score:5,label:'Optimized',description:'Proactive 90â€“180d renewal motion'}
                    ]
                },
                {
                    text:'How strong is your expansion & cross-sell motion?',
                    ratings:[
                        {score:1,label:'Poor',description:'Ad-hoc upsell only'},
                        {score:2,label:'Basic',description:'Opportunistic, rep-dependent'},
                        {score:3,label:'Developing',description:'Some structured plays and offers'},
                        {score:4,label:'Advanced',description:'Plays by trigger & segment'},
                        {score:5,label:'Optimized',description:'Always-on expansion engine'},
                    ]
                },
                {
                    text:'How well do you understand and track NRR & logo retention?',
                    ratings:[
                        {score:1,label:'Poor',description:'Not consistently recorded'},
                        {score:2,label:'Basic',description:'Reported irregularly'},
                        {score:3,label:'Developing',description:'Tracked quarterly'},
                        {score:4,label:'Advanced',description:'Tracked monthly by segment'},
                        {score:5,label:'Optimized',description:'Board-level, scenario-modelled'}
                    ]
                },
                {
                    text:'How aligned are GTM, product and finance on the growth strategy?',
                    ratings:[
                        {score:1,label:'Poor',description:'Siloed planning'},
                        {score:2,label:'Basic',description:'Annual planning only'},
                        {score:3,label:'Developing',description:'Some joint planning'},
                        {score:4,label:'Advanced',description:'Quarterly aligned planning'},
                        {score:5,label:'Optimized',description:'Tightly aligned growth engine'}
                    ]
                },
                {
                    text:'How intentionally do you develop customer advocates & references?',
                    ratings:[
                        {score:1,label:'Poor',description:'Ad-hoc references'},
                        {score:2,label:'Basic',description:'Occasional case studies'},
                        {score:3,label:'Developing',description:'Some advocate program'},
                        {score:4,label:'Advanced',description:'Structured advocacy motions'},
                        {score:5,label:'Optimized',description:'Scaled advocacy with incentives'}
                    ]
                }
            ]
        }
    ];

    // Dimension mapping per question (simplified)
    const questionDimensions = [
        ['strategy','process','tooling','process','data'],       // phase1
        ['process','process','governance','governance','data'], // phase2
        ['tooling','process','cash','cash','governance'],       // phase3
        ['success','process','data','tooling','success'],       // phase4
        ['success','expansion','data','strategy','expansion']   // phase5
    ];

    let responses = {}; // phaseIndex -> { questionIndex: score }
    let currentPhaseIndex = 0;
    let radarChart, barChart;
    let showAllRecommendations = false;
    let lastRecommendations = [];

    // =========================
    // Helpers
    // =========================
    function getOverallRatingLabel(score){
        if(score >= 4.5) return {label:'ðŸ† World Class',desc:'Elite L2C engine â€“ focus on fine-tuning and scaling what works.'};
        if(score >= 3.5) return {label:'â­ Advanced',desc:'Strong foundations with some targeted bottlenecks to address.'};
        if(score >= 2.5) return {label:'ðŸ“ˆ Developing',desc:'Solid progress â€“ a few structural gaps are holding you back.'};
        if(score >= 1.5) return {label:'ðŸ”§ Basic',desc:'Early in the journey â€“ big wins available from getting fundamentals right.'};
        return {label:'ðŸš§ Foundational',desc:'Significant gaps â€“ start with clarity on process, metrics and ownership.'};
    }

    function getPhaseMaturityLabel(score){
        if(score >= 4.5) return 'ðŸ† World Class';
        if(score >= 3.5) return 'â­ Advanced';
        if(score >= 2.5) return 'ðŸ“ˆ Developing';
        if(score >= 1.5) return 'ðŸ”§ Basic';
        return 'ðŸš§ Foundational';
    }

    function getDimensionLabel(key){
        switch(key){
            case 'strategy': return 'Go-to-Market Strategy & ICP';
            case 'process': return 'Process & Workflow Discipline';
            case 'tooling': return 'Systems, Tooling & Integration';
            case 'data': return 'Data, Reporting & Insight';
            case 'governance': return 'Deal Governance & Approvals';
            case 'cash': return 'Billing, Collections & Cash';
            case 'success': return 'Customer Success & Experience';
            case 'expansion': return 'Renewals, Expansion & NRR';
            default: return 'Process & Ownership';
        }
    }

    function getPrimaryDimensionForPhase(phaseIndex){
        const phaseResponses = responses[phaseIndex] || {};
        const dimBuckets = {};

        phases[phaseIndex].questions.forEach((q,qIdx)=>{
            const dimKey = (questionDimensions[phaseIndex] || [])[qIdx] || 'process';
            const score = phaseResponses[qIdx];
            if(typeof score !== 'number') return;
            if(!dimBuckets[dimKey]) dimBuckets[dimKey] = {sum:0,count:0};
            dimBuckets[dimKey].sum += score;
            dimBuckets[dimKey].count += 1;
        });

        const dims = Object.keys(dimBuckets);
        if(!dims.length) return 'process';

        let weakestDim = dims[0];
        let weakestAvg = dimBuckets[weakestDim].sum / dimBuckets[weakestDim].count;

        dims.forEach(dim=>{
            const avg = dimBuckets[dim].sum / dimBuckets[dim].count;
            if(avg < weakestAvg){
                weakestAvg = avg;
                weakestDim = dim;
            }
        });

        return weakestDim;
    }

    function getPhaseRecBlueprint(phaseIndex,dimKey){
        const dimLabel = getDimensionLabel(dimKey);
        switch(phaseIndex){
            case 0: return {
                dimLabel,
                now:'Clarify your ICP and write down MQL/SQL criteria agreed by Marketing and Sales. Make it visible in your CRM and campaign briefs.',
                next:'Implement lead scoring and speed-to-lead SLAs. Instrument MQLâ†’SQL conversion and channel performance in your dashboards.',
                later:'Layer in intent data and experimentation on messaging/offers to improve conversion at the same or lower CAC.',
                kpi:'MQLâ†’SQL conversion > 25%, speed-to-lead < 4 hours, clear ROI by channel.',
                owner:'VP Marketing + RevOps'
            };
            case 1: return {
                dimLabel,
                now:'Lock down a single sales process and stage exit criteria. Map your quote and approvals workflow end-to-end.',
                next:'Enforce stages in CRM, introduce basic CPQ/quote templates and define approval SLAs and thresholds.',
                later:'Stand up a small deal desk, use win/loss + cycle time analysis to refine stages and guardrails.',
                kpi:'Stage adoption > 90%, quote turnaround < 48 hours, forecast accuracy within Â±10%.',
                owner:'Sales Leadership + RevOps'
            };
            case 2: return {
                dimLabel,
                now:'Document order â†’ invoice â†’ cash. Identify manual handoffs and error hotspots between CRM, billing and finance.',
                next:'Automate standard billing flows, define collections cadence and make DSO and invoice errors visible weekly.',
                later:'Tighten revenue recognition rules and push toward real-time billing events and risk-based collections.',
                kpi:'DSO < 30 days, invoice error rate < 1%, 95% of invoices sent within 24â€“48 hours.',
                owner:'Finance + RevOps/Ops'
            };
            case 3: return {
                dimLabel,
                now:'Define a clear onboarding journey for the first 90 days. Assign owners and stand up a simple health score for key accounts.',
                next:'Introduce regular QBRs for top customers, centralize customer history and track NPS/CSAT with clear follow-through.',
                later:'Move toward predictive churn signals (usage, sentiment, tickets) and proactive outreach playbooks.',
                kpi:'Onboarded on time > 90%, CSAT/NPS trending up, churn concentrated in clearly understood segments.',
                owner:'Customer Success Leadership'
            };
            case 4:
            default: return {
                dimLabel,
                now:'Create a renewal calendar (90â€“120 days out) with explicit owners. Audit expansion and cross-sell plays by segment.',
                next:'Build playbooks for renewal risk, expansion triggers (usage, multi-team adoption) and exec sponsorship.',
                later:'Introduce NRR and logo retention as board-level KPIs; experiment with pricing/packaging guided by data.',
                kpi:'Gross retention > 90%, NRR > 110%, no â€œsurprise churnâ€.',
                owner:'CS + Sales Leadership + Finance'
            };
        }
    }

    // =========================
    // UI Setup
    // =========================
    function initializeAssessment(){
        const tabsContainer = document.getElementById('phaseTabs');
        const cardsContainer = document.getElementById('questionCards');
        tabsContainer.innerHTML = '';
        cardsContainer.innerHTML = '';
        responses = responses || {};

        phases.forEach((phase,idx)=>{
            const tab = document.createElement('div');
            tab.className = 'phase-tab' + (idx === 0 ? ' active':'');
            tab.dataset.index = idx;
            tab.textContent = `${idx+1}. ${phase.name}`;
            tab.addEventListener('click',()=>switchPhase(idx));
            tabsContainer.appendChild(tab);

            phase.questions.forEach((q,qIdx)=>{
                const card = document.createElement('div');
                card.className = 'question-card';
                card.dataset.phaseIndex = idx;
                card.innerHTML = `
                    <div class="question-text">${q.text}</div>
                    <div class="question-subtext">${phase.description}</div>
                    <div class="rating-options"></div>
                `;
                const opts = card.querySelector('.rating-options');
                q.ratings.forEach(rating=>{
                    const opt = document.createElement('button');
                    opt.type = 'button';
                    opt.className = 'rating-option';
                    opt.innerHTML = `
                        <div class="rating-label">${rating.score} â€“ ${rating.label}</div>
                        <div class="rating-desc">${rating.description}</div>
                    `;
                    opt.addEventListener('click',()=>{
                        recordResponse(idx,qIdx,rating.score,card,opt);
                    });
                    opts.appendChild(opt);
                });
                cardsContainer.appendChild(card);
            });
        });

        updateProgress();
    }

    function switchPhase(idx){
        currentPhaseIndex = idx;
        document.querySelectorAll('.phase-tab').forEach(tab=>{
            tab.classList.toggle('active', Number(tab.dataset.index) === idx);
        });
        document.querySelectorAll('.question-card').forEach(card=>{
            const pIdx = Number(card.dataset.phaseIndex);
            card.style.display = (pIdx === idx) ? 'flex' : 'none';
        });
    }

    function recordResponse(phaseIdx,questionIdx,score,card,optEl){
        if(!responses[phaseIdx]) responses[phaseIdx] = {};
        responses[phaseIdx][questionIdx] = score;
        card.querySelectorAll('.rating-option').forEach(b=>b.classList.remove('selected'));
        optEl.classList.add('selected');
        markPhaseCompletedIfDone(phaseIdx);
        updateProgress();
    }

    function markPhaseCompletedIfDone(phaseIdx){
        const answered = responses[phaseIdx] ? Object.keys(responses[phaseIdx]).length : 0;
        if(answered === phases[phaseIdx].questions.length){
            const tab = document.querySelector(`.phase-tab[data-index="${phaseIdx}"]`);
            if(tab) tab.classList.add('completed');
        }
    }

    function updateProgress(){
        const totalQuestions = phases.reduce((sum,p)=>sum+p.questions.length,0);
        let answered = 0;
        Object.values(responses).forEach(phaseResp=>{
            answered += Object.keys(phaseResp).length;
        });
        const pct = totalQuestions ? (answered/totalQuestions)*100 : 0;
        document.getElementById('progressFill').style.width = `${pct}%`;

        if(answered === totalQuestions){
            showResults();
        }
    }

    // =========================
    // Scoring & Charts
    // =========================
    function calculateScores(){
        const phaseScores = phases.map((phase,pIdx)=>{
            const phaseResp = responses[pIdx] || {};
            const vals = Object.values(phaseResp).map(v=>Number(v));
            if(!vals.length) return NaN;
            return vals.reduce((a,b)=>a+b,0)/vals.length;
        });
        const valid = phaseScores.filter(s=>!isNaN(s));
        const overall = valid.length ? valid.reduce((a,b)=>a+b,0)/valid.length : 0;
        return {phaseScores,overallScore:overall};
    }

    function showResults(){
        document.getElementById('assessmentSection').style.display = 'none';
        const resultsSection = document.getElementById('resultsSection');
        resultsSection.classList.add('active');

        const {phaseScores,overallScore} = calculateScores();
        const benchmark = [3.2,3.5,3.8,2.9,3.1];

        phaseScores.forEach((score,idx)=>{
            const valEl = document.getElementById(`phase${idx+1}Score`);
            const labelEl = document.getElementById(`phase${idx+1}Label`);
            if(valEl) valEl.textContent = isNaN(score) ? '0.0' : score.toFixed(1);
            if(labelEl){
                labelEl.textContent = isNaN(score) ? 'Not assessed' : getPhaseMaturityLabel(score);
            }
        });

        const overallLabel = getOverallRatingLabel(overallScore);
        document.getElementById('overallScore').textContent = overallScore.toFixed(1);
        document.getElementById('overallRating').textContent = overallLabel.label;
        document.getElementById('overallPill').textContent = overallLabel.desc;

        renderExecutiveSummary(phaseScores,overallScore,benchmark);
        renderCharts(phaseScores,benchmark);
        renderRecommendations();
    }

    function renderExecutiveSummary(phaseScores,overallScore,benchmark){
        const container = document.getElementById('execSummary');
        const overallLabel = getOverallRatingLabel(overallScore);

        const scored = phaseScores.map((score,idx)=>({
            index:idx,
            name:phases[idx].name,
            score,
            gap:(benchmark[idx] || 3.0) - score
        })).filter(p=>!isNaN(p.score));

        if(!scored.length){
            container.innerHTML = '<p>Complete the assessment to see your executive summary.</p>';
            return;
        }

        const strongest = scored.reduce((a,b)=>b.score > a.score ? b : a);
        const weakest = scored.reduce((a,b)=>b.score < a.score ? b : a);

        const weakestDim = getPrimaryDimensionForPhase(weakest.index);
        const dimLabel = getDimensionLabel(weakestDim);

        container.innerHTML = `
            <h3>Executive Summary</h3>
            <p>Your overall lead-to-cash maturity is <strong>${overallLabel.label}</strong> with a score of <strong>${overallScore.toFixed(1)}/5</strong>.</p>
            <p><strong>Strongest phase:</strong> ${strongest.name} (${strongest.score.toFixed(1)}/5).</p>
            <p><strong>Weakest phase:</strong> ${weakest.name} (${weakest.score.toFixed(1)}/5), primarily due to <strong>${dimLabel}</strong>.</p>
            <p>Focus the next 90 days on 1â€“2 of these bottlenecks rather than attempting to fix everything at once.</p>
            <div class="exec-tags">
                <span class="tag">Top strength: ${strongest.name}</span>
                <span class="tag">Top bottleneck: ${weakest.name}</span>
                <span class="tag">Biggest drag dimension: ${dimLabel}</span>
            </div>
        `;
    }

    function renderCharts(phaseScores,benchmark){
        const labels = phases.map(p=>p.name);
        const radarCtx = document.getElementById('radarChart').getContext('2d');
        const barCtx = document.getElementById('barChart').getContext('2d');

        if(radarChart) radarChart.destroy();
        if(barChart) barChart.destroy();

        radarChart = new Chart(radarCtx,{
            type:'radar',
            data:{
                labels,
                datasets:[
                    {
                        label:'Your score',
                        data:phaseScores,
                        borderColor:'#4ade80',
                        backgroundColor:'rgba(34,197,94,0.15)',
                        pointBackgroundColor:'#22c55e'
                    },
                    {
                        label:'Benchmark',
                        data:benchmark,
                        borderColor:'#60a5fa',
                        backgroundColor:'rgba(59,130,246,0.12)',
                        pointBackgroundColor:'#3b82f6'
                    }
                ]
            },
            options:{
                scales:{r:{beginAtZero:true,max:5,ticks:{stepSize:1,color:'#9ca3af'},grid:{color:'rgba(148,163,184,0.4)'},angleLines:{color:'rgba(148,163,184,0.4)'},pointLabels:{color:'#cbd5e1'}}},
                plugins:{legend:{labels:{color:'#e5e7eb'}}}
            }
        });

        barChart = new Chart(barCtx,{
            type:'bar',
            data:{
                labels,
                datasets:[
                    {
                        label:'Your score',
                        data:phaseScores,
                        backgroundColor:'rgba(34,197,94,0.7)'
                    },
                    {
                        label:'Benchmark',
                        data:benchmark,
                        backgroundColor:'rgba(59,130,246,0.7)'
                    }
                ]
            },
            options:{
                scales:{
                    x:{ticks:{color:'#cbd5e1'},grid:{display:false}},
                    y:{beginAtZero:true,max:5,ticks:{stepSize:1,color:'#9ca3af'},grid:{color:'rgba(148,163,184,0.3)'}}
                },
                plugins:{legend:{labels:{color:'#e5e7eb'}}}
            }
        });
    }

    // =========================
    // Recommendations
    // =========================
    function renderRecommendations(){
        const benchmark = [3.2,3.5,3.8,2.9,3.1];
        const {phaseScores,overallScore} = calculateScores();
        const overallLabel = getOverallRatingLabel(overallScore);
        const container = document.getElementById('recommendationsList');
        const introEl = document.getElementById('recommendationsIntro');

        const scored = phaseScores.map((score,idx)=>({
            phaseIndex:idx,
            phaseName:phases[idx].name,
            score,
            benchmark:benchmark[idx] || 3.0,
            gap:(benchmark[idx] || 3.0) - score
        })).filter(p=>!isNaN(p.score));

        if(!scored.length){
            container.innerHTML = '<p>Complete the assessment to see tailored recommendations.</p>';
            introEl.textContent = '';
            return;
        }

        scored.sort((a,b)=>b.gap - a.gap);
        lastRecommendations = scored; // store for toggle

        const strongest = scored.reduce((a,b)=>b.score > a.score ? b : a);
        const weakest = scored[0];

        introEl.textContent =
            `You are currently ${overallLabel.label}. Your strongest phase is ${strongest.phaseName} ` +
            `(${strongest.score.toFixed(1)}/5). The biggest gaps vs benchmark sit in ` +
            `${weakest.phaseName} and the other bottlenecks listed below.`;

        const items = showAllRecommendations ? scored : scored.slice(0,3);

        const cardsHtml = items.map(phase=>{
            const maturityLabel = getPhaseMaturityLabel(phase.score);
            const dimKey = getPrimaryDimensionForPhase(phase.phaseIndex);
            const blueprint = getPhaseRecBlueprint(phase.phaseIndex,dimKey);
            const priority = (phase.score < 3 || phase.gap > 0.7) ? 'high' : 'medium';
            const impactText = priority === 'high'
                ? 'This is one of the highest-leverage changes you can make in the next 90 days.'
                : 'Meaningful performance lift once the top bottlenecks are addressed.';

            return `
                <div class="recommendation-item ${priority}-priority">
                    <div class="recommendation-header">
                        <div class="recommendation-title">
                            ${phase.phaseName} â€“ ${blueprint.dimLabel} (${maturityLabel})
                        </div>
                        <div class="priority-badge priority-${priority}">
                            ${priority.toUpperCase()} PRIORITY
                        </div>
                    </div>
                    <div class="recommendation-description">
                        <p>
                            Your score in <strong>${phase.phaseName}</strong> is
                            <strong>${phase.score.toFixed(1)}/5</strong> vs a benchmark of
                            <strong>${phase.benchmark.toFixed(1)}/5</strong>.
                            The main drag here is <strong>${blueprint.dimLabel}</strong>.
                        </p>
                        <ul class="rec-actions">
                            <li><strong>Now (0â€“30 days):</strong> ${blueprint.now}</li>
                            <li><strong>Next (30â€“90 days):</strong> ${blueprint.next}</li>
                            <li><strong>Later (90â€“180 days):</strong> ${blueprint.later}</li>
                        </ul>
                        <p class="recommendation-impact">
                            âœ… Success looks like: ${blueprint.kpi}
                        </p>
                        <div class="rec-owner-chip">
                            ðŸ‘¤ Primary owner: ${blueprint.owner}
                        </div>
                        <p class="recommendation-impact">
                            ðŸ’¡ ${impactText}
                        </p>
                    </div>
                </div>
            `;
        }).join('');

        container.innerHTML = cardsHtml;
        document.getElementById('toggleRecView').textContent =
            showAllRecommendations ? 'Show top 3 bottlenecks only' : 'Show all recommendations';
    }

    document.getElementById('toggleRecView').addEventListener('click',()=>{
        showAllRecommendations = !showAllRecommendations;
        renderRecommendations();
    });

    // =========================
    // Export / Restart
    // =========================
    function exportResults(){
        const {phaseScores,overallScore} = calculateScores();
        const data = {
            timestamp:new Date().toISOString(),
            overallScore:overallScore.toFixed(1),
            overallRating:getOverallRatingLabel(overallScore).label,
            phaseScores:phases.map((p,idx)=>({
                phase:p.name,
                score:phaseScores[idx],
                maturity:getPhaseMaturityLabel(phaseScores[idx] || 0)
            })),
            responses
        };
        const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'lead-to-cash-diagnostic-results.json';
        a.click();
    }

    function restartAssessment(){
        if(!confirm('Restart assessment? All responses will be cleared.')) return;
        responses = {};
        currentPhaseIndex = 0;
        document.getElementById('assessmentSection').style.display = 'block';
        document.getElementById('resultsSection').classList.remove('active');
        initializeAssessment();
        switchPhase(0);
    }

    // Init
    document.addEventListener('DOMContentLoaded',()=>{
        initializeAssessment();
        switchPhase(0);
    });
</script>
</body>
</html>
<