<!DOCTYPE html>
<!-- saved from url=(0066)file:///C:/Users/marti/Downloads/team_mapping_enhanced%20(12).html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Team Framework Mapper - Enhanced Coaching Edition</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600;700;900&family=IBM+Plex+Mono:wght@400;600&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #fafbfc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f3f5f7;
      --text-primary: #1a1d23;
      --text-secondary: #4e5662;
      --text-muted: #8a93a2;
      --accent-primary: #2563eb;
      --accent-secondary: #0ea5e9;
      --accent-success: #059669;
      --accent-warning: #f59e0b;
      --accent-danger: #dc2626;
      --border: #e5e7eb;
      --shadow: rgba(0, 0, 0, 0.08);
      --glow: rgba(37, 99, 235, 0.15);
    }

    body {
      font-family: 'Work Sans', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
    }

    .header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 20px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 3px var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      font-size: 24px;
      font-weight: 900;
      color: var(--accent-primary);
    }

    .nav-tabs {
      display: flex;
      gap: 8px;
      background: var(--bg-tertiary);
      padding: 4px;
      border-radius: 8px;
    }

    .nav-tab {
      padding: 10px 20px;
      background: transparent;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Work Sans', sans-serif;
    }

    .nav-tab.active {
      background: var(--accent-primary);
      color: white;
      box-shadow: 0 2px 8px var(--glow);
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 32px;
    }

    .view-container {
      display: none;
    }

    .view-container.active {
      display: block;
    }

    /* Team Grid */
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .team-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .team-card:hover {
      box-shadow: 0 8px 24px var(--shadow);
      transform: translateY(-4px);
    }

    .team-card.needs-attention {
      border-left: 4px solid var(--accent-danger);
    }

    .team-card.on-track {
      border-left: 4px solid var(--accent-success);
    }

    .member-name {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .member-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 16px;
    }

    .tag {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }

    .alert-badge {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--accent-danger);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 700;
    }

    .next-action {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .next-action strong {
      color: var(--accent-primary);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--bg-secondary);
      border-radius: 16px;
      max-width: 1200px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      padding: 24px 32px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: var(--bg-secondary);
      z-index: 10;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 900;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-muted);
      padding: 8px;
      line-height: 1;
    }

    .close-btn:hover {
      color: var(--text-primary);
    }

    .modal-body {
      padding: 32px;
    }

    .modal-section {
      margin-bottom: 32px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .subsection-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Two-Column Layout */
    .two-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
    }

    /* Info Cards */
    .info-card {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .info-card-title {
      font-size: 13px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .info-card-content {
      font-size: 14px;
      color: var(--text-primary);
      line-height: 1.6;
    }

    /* Coaching Guidance */
    .coaching-box {
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(14, 165, 233, 0.1));
      border: 1px solid var(--accent-primary);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .coaching-box-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 12px;
    }

    .coaching-list {
      list-style: none;
      padding: 0;
    }

    .coaching-list li {
      padding: 8px 0;
      padding-left: 24px;
      position: relative;
      font-size: 14px;
      line-height: 1.6;
    }

    .coaching-list li:before {
      content: "‚Üí";
      position: absolute;
      left: 0;
      color: var(--accent-primary);
      font-weight: 700;
    }

    /* Conversation History */
    .conversation-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .conversation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .conversation-date {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
    }

    .conversation-type {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      background: var(--bg-tertiary);
    }

    .conversation-notes {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .action-items {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .action-chip {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }

    .action-chip.completed {
      background: rgba(5, 150, 105, 0.1);
      color: var(--accent-success);
      text-decoration: line-through;
    }

    .action-chip.overdue {
      background: rgba(220, 38, 38, 0.1);
      color: var(--accent-danger);
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Work Sans', sans-serif;
    }

    .btn-primary {
      background: var(--accent-primary);
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--glow);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn-success {
      background: var(--accent-success);
      color: white;
    }

    .btn-success:hover {
      background: #047857;
    }

    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Work Sans', sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow);
    }

    /* Scenario Library */
    .scenario-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }

    .scenario-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .scenario-card:hover {
      border-color: var(--accent-primary);
      box-shadow: 0 4px 12px var(--shadow);
    }

    .scenario-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .scenario-profiles {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .scenario-preview {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* Development Tracker */
    .skill-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-bottom: 1px solid var(--border);
    }

    .skill-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .skill-progress {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .progress-bar {
      width: 120px;
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--accent-primary);
      transition: width 0.3s;
    }

    .progress-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    /* Alerts */
    .alert-box {
      background: rgba(220, 38, 38, 0.1);
      border: 1px solid var(--accent-danger);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .alert-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent-danger);
      margin-bottom: 8px;
    }

    .alert-content {
      font-size: 13px;
      color: var(--text-primary);
      line-height: 1.6;
    }

    /* Tabs within modal */
    .modal-tabs {
      display: flex;
      gap: 8px;
      border-bottom: 2px solid var(--border);
      margin-bottom: 24px;
    }

    .modal-tab {
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: -2px;
    }

    .modal-tab.active {
      color: var(--accent-primary);
      border-bottom-color: var(--accent-primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Smart Reminders */
    .reminder-card {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid var(--accent-warning);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .reminder-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent-warning);
      margin-bottom: 8px;
    }

    .reminder-content {
      font-size: 13px;
      color: var(--text-primary);
    }

    /* Search & Filter */
    .filter-bar {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 250px;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
    }

    .filter-chip {
      padding: 8px 16px;
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: var(--bg-secondary);
      transition: all 0.2s;
    }

    .filter-chip.active {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .empty-text {
      font-size: 16px;
      margin-bottom: 8px;
    }

    .empty-hint {
      font-size: 13px;
    }

    /* Members Edit Grid */
    .members-edit-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .edit-member-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .edit-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border);
    }

    .edit-card-name {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .edit-card-actions {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      background: var(--bg-tertiary);
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .icon-btn:hover {
      background: var(--border);
      transform: scale(1.1);
    }

    .edit-card-body {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .edit-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .edit-field-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
    }

    .edit-field-value {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .edit-field-value select,
    .edit-field-value input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 13px;
      font-family: 'Work Sans', sans-serif;
      background: var(--bg-tertiary);
    }

    .edit-field-value select:focus,
    .edit-field-value input:focus {
      outline: none;
      border-color: var(--accent-primary);
      background: var(--bg-secondary);
    }

    .slider-container {
      flex: 1;
    }

    .slider {
      width: 100%;
    }

    .slider-value {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent-primary);
      min-width: 30px;
      text-align: right;
    }

    .save-profile-btn {
      margin-top: 8px;
      width: 100%;
      padding: 10px;
      background: var(--accent-success);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .save-profile-btn:hover {
      background: #047857;
      transform: translateY(-2px);
    }

    /* Development Dashboard */
    .skill-gap-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .skill-gap-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .skill-gap-name {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .skill-gap-count {
      background: var(--accent-primary);
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
    }

    .skill-gap-members {
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .dev-activity-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      border-left: 3px solid var(--accent-primary);
    }

    .dev-activity-card.overdue {
      border-left-color: var(--accent-danger);
    }

    .dev-activity-card.completed {
      border-left-color: var(--accent-success);
      opacity: 0.7;
    }

    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .activity-member {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .activity-type {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      text-transform: capitalize;
    }

    .activity-desc {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .activity-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: var(--text-muted);
    }

    .stat-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .stat-box {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 900;
      color: var(--accent-primary);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .progress-overview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .progress-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
    }

    .progress-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .progress-card-name {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .progress-card-status {
      font-size: 11px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 12px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }

    .progress-card-status.on-track {
      background: rgba(5, 150, 105, 0.1);
      color: var(--accent-success);
    }

    .progress-card-status.needs-attention {
      background: rgba(220, 38, 38, 0.1);
      color: var(--accent-danger);
    }

    .readiness-dev-section {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .readiness-dev-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .readiness-dev-needs {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.8;
    }

    /* Skill History Timeline */
    .history-timeline {
      position: relative;
      padding-left: 40px;
      margin-top: 20px;
    }

    .history-timeline::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--border);
    }

    .history-entry {
      position: relative;
      padding: 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .history-entry::before {
      content: '';
      position: absolute;
      left: -32px;
      top: 20px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--accent-primary);
      border: 3px solid var(--bg-primary);
      z-index: 1;
    }

    .history-entry.first::before {
      background: var(--accent-success);
    }

    .history-date {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .history-value {
      font-size: 24px;
      font-weight: 900;
      color: var(--accent-primary);
      margin-bottom: 4px;
    }

    .history-change {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .history-change.positive {
      color: var(--accent-success);
    }

    .history-notes {
      font-size: 12px;
      color: var(--text-muted);
      font-style: italic;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid var(--border);
    }

    /* AI Assistant Styles */
    .ai-quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .ai-quick-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .ai-quick-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
    }

    .ai-quick-icon {
      font-size: 32px;
      pointer-events: none;
    }

    .ai-quick-text {
      color: white;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      pointer-events: none;
    }

    .alert-panel,
    .calendar-panel,
    .effectiveness-panel {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .alert-panel-header,
    .calendar-panel-header,
    .effectiveness-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border);
    }

    .alert-panel-header h3,
    .calendar-panel-header h3,
    .effectiveness-panel-header h3 {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
    }

    .predictive-alert {
      background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(239, 68, 68, 0.05));
      border-left: 4px solid var(--accent-danger);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .predictive-alert.warning {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.05));
      border-left-color: var(--accent-warning);
    }

    .predictive-alert.success {
      background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(16, 185, 129, 0.05));
      border-left-color: var(--accent-success);
    }

    .alert-severity {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .alert-severity.critical {
      background: var(--accent-danger);
      color: white;
    }

    .alert-severity.warning {
      background: var(--accent-warning);
      color: white;
    }

    .alert-severity.info {
      background: var(--accent-primary);
      color: white;
    }

    .alert-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .alert-description {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .alert-actions {
      display: flex;
      gap: 8px;
    }

    .alert-action-btn {
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      transition: all 0.2s;
    }

    .alert-action-btn:hover {
      background: var(--bg-tertiary);
      transform: translateY(-1px);
    }

    .calendar-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .calendar-date-badge {
      min-width: 60px;
      text-align: center;
      padding: 12px;
      background: var(--accent-primary);
      color: white;
      border-radius: 8px;
    }

    .calendar-date-day {
      font-size: 24px;
      font-weight: 900;
      line-height: 1;
    }

    .calendar-date-month {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .calendar-item-content {
      flex: 1;
    }

    .calendar-item-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .calendar-item-time {
      font-size: 12px;
      color: var(--text-muted);
    }

    .effectiveness-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .effectiveness-metric {
      background: var(--bg-tertiary);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }

    .effectiveness-value {
      font-size: 36px;
      font-weight: 900;
      color: var(--accent-primary);
      margin-bottom: 8px;
    }

    .effectiveness-value.positive {
      color: var(--accent-success);
    }

    .effectiveness-value.negative {
      color: var(--accent-danger);
    }

    .effectiveness-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .effectiveness-trend {
      font-size: 13px;
      font-weight: 600;
      margin-top: 8px;
    }

    .effectiveness-trend.up {
      color: var(--accent-success);
    }

    .effectiveness-trend.down {
      color: var(--accent-danger);
    }

    /* AI Chat Interface */
    .ai-chat-container {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .ai-chat-header {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border);
    }

    .ai-chat-header h3 {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 4px 0;
    }

    .ai-chat-messages {
      max-height: 500px;
      overflow-y: auto;
      margin-bottom: 20px;
      padding: 20px;
      background: var(--bg-tertiary);
      border-radius: 8px;
    }

    .ai-message {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .ai-message.ai-user {
      flex-direction: row-reverse;
    }

    .ai-message-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--accent-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }

    .ai-user .ai-message-avatar {
      background: var(--accent-success);
    }

    .ai-message-content {
      flex: 1;
      max-width: 80%;
    }

    .ai-message-text {
      background: var(--bg-secondary);
      padding: 16px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.6;
      box-shadow: 0 1px 3px var(--shadow);
    }

    .ai-user .ai-message-text {
      background: var(--accent-primary);
      color: white;
    }

    .ai-message-time {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
      padding: 0 4px;
    }

    .ai-chat-input-container {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .ai-chat-input {
      flex: 1;
      padding: 16px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Work Sans', sans-serif;
      resize: vertical;
      transition: all 0.2s;
    }

    .ai-chat-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow);
    }

    .ai-send-btn {
      padding: 16px 32px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .ai-send-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
    }

    .ai-send-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .ai-suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .ai-suggestion-chip {
      padding: 8px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 16px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Work Sans', sans-serif;
    }

    .ai-suggestion-chip:hover {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
      transform: translateY(-2px);
    }

    .assessment-skill-row {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .assessment-skill-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .assessment-skill-name {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .assessment-old-value {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Edit Modal */
    .edit-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1001;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .edit-modal.active {
      display: flex;
    }

    .edit-modal-content {
      background: var(--bg-secondary);
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 32px;
    }

    .edit-modal-title {
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 24px;
      color: var(--text-primary);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .two-column {
        grid-template-columns: 1fr;
      }

      .team-grid {
        grid-template-columns: 1fr;
      }

      .scenario-grid {
        grid-template-columns: 1fr;
      }

      .members-edit-grid {
        grid-template-columns: 1fr;
      }

      .container {
        padding: 16px;
      }

      .modal-body {
        padding: 16px;
      }
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo">‚ö° TeamCoach Pro</div>
    <div class="nav-tabs">
      <button class="nav-tab" data-view="team-overview">Team Overview</button>
      <button class="nav-tab" data-view="ai-assistant">ü§ñ AI Coach</button>
      <button class="nav-tab" data-view="scenarios">Coaching Library</button>
      <button class="nav-tab" data-view="development">Development</button>
      <button class="nav-tab active" data-view="settings">Settings</button>
      <button class="nav-tab" data-view="reports">üìä Reports</button>
    </div>
  </div>

  <div class="container">
    <!-- TEAM OVERVIEW -->
    <div class="view-container" id="team-overview">
      <div class="filter-bar">
        <input type="text" class="search-box" id="searchBox" placeholder="Search team members...">
        <div class="filter-chip active" data-filter="all">All</div>
        <div class="filter-chip" data-filter="needs-attention">Needs Attention</div>
        <div class="filter-chip" data-filter="upcoming-1on1">Upcoming 1:1</div>
        <div class="filter-chip" data-filter="action-overdue">Action Overdue</div>
      </div>

      <div class="team-grid" id="teamGrid">
          <div class="team-card needs-attention" onclick="openMemberModal(1)">
            <div class="alert-badge">2</div>
            
            <div class="member-name">Sarah Chen</div>
            
            <div class="member-tags">
              <span class="tag">R2</span>
              <span class="tag">Peacock/Dolphin</span>
              <span class="tag">at risk</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> Enterprise deals
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> in 2 days
            </div>
            
            <div style="font-size: 12px; color: var(--accent-danger); margin-top: 8px;">‚ö†Ô∏è Overdue actions</div>
          </div>
        
          <div class="team-card on-track" onclick="openMemberModal(2)">
            
            
            <div class="member-name">Marcus Johnson</div>
            
            <div class="member-tags">
              <span class="tag">R3</span>
              <span class="tag">Panther/Owl</span>
              <span class="tag">on track</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> Closing velocity
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> in 7 days
            </div>
            
            
          </div>
        
          <div class="team-card on-track" onclick="openMemberModal(3)">
            <div class="alert-badge">1</div>
            
            <div class="member-name">Emily Rodriguez</div>
            
            <div class="member-tags">
              <span class="tag">R1</span>
              <span class="tag">Owl/Dolphin</span>
              <span class="tag">on track</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> Discovery fundamentals
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> Tomorrow
            </div>
            
            
          </div>
        
          <div class="team-card on-track" onclick="openMemberModal(4)">
            
            
            <div class="member-name">David Park</div>
            
            <div class="member-tags">
              <span class="tag">R4</span>
              <span class="tag">Dolphin/Peacock</span>
              <span class="tag">exceeding</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> Mentoring others
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> in 14 days
            </div>
            
            
          </div>
        
          <div class="team-card on-track" onclick="openMemberModal(5)">
            <div class="alert-badge">1</div>
            
            <div class="member-name">Jessica Martinez</div>
            
            <div class="member-tags">
              <span class="tag">R2</span>
              <span class="tag">Peacock/Owl</span>
              <span class="tag">on track</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> Building pipeline consistency
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> in 3 days
            </div>
            
            
          </div>
        
          <div class="team-card needs-attention" onclick="openMemberModal(6)">
            <div class="alert-badge">2</div>
            
            <div class="member-name">Kevin O'Brien</div>
            
            <div class="member-tags">
              <span class="tag">R3</span>
              <span class="tag">Panther/Owl</span>
              <span class="tag">at risk</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> Re-engaging with process
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> Tomorrow
            </div>
            
            <div style="font-size: 12px; color: var(--accent-danger); margin-top: 8px;">‚ö†Ô∏è Overdue actions</div>
          </div>
        
          <div class="team-card on-track" onclick="openMemberModal(7)">
            <div class="alert-badge">1</div>
            
            <div class="member-name">Priya Patel</div>
            
            <div class="member-tags">
              <span class="tag">R1</span>
              <span class="tag">Owl/Dolphin</span>
              <span class="tag">on track</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> Sales fundamentals and confidence
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> Tomorrow
            </div>
            
            
          </div>
        
          <div class="team-card on-track" onclick="openMemberModal(8)">
            
            
            <div class="member-name">James Thompson</div>
            
            <div class="member-tags">
              <span class="tag">R4</span>
              <span class="tag">Dolphin/Owl</span>
              <span class="tag">exceeding</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> Strategic accounts and mentoring
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> in 21 days
            </div>
            
            
          </div>
        
          <div class="team-card on-track" onclick="openMemberModal(9)">
            <div class="alert-badge">1</div>
            
            <div class="member-name">Alicia Washington</div>
            
            <div class="member-tags">
              <span class="tag">R3</span>
              <span class="tag">Panther/Peacock</span>
              <span class="tag">exceeding</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> Leadership pipeline development
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> in 5 days
            </div>
            
            
          </div>
        </div>
    </div>

    <!-- AI COACHING ASSISTANT -->
    <div class="view-container" id="ai-assistant">
      <div style="max-width: 1200px; margin: 0 auto;">
        <h2 style="margin-bottom: 12px; font-size: 32px; font-weight: 900;">AI Coaching Assistant</h2>
        <p style="color: var(--text-secondary); margin-bottom: 32px; font-size: 16px;">
          Ask questions, get coaching recommendations, predict risks, and generate 1:1 agendas powered by AI
        </p>

        <!-- Quick Actions -->
        <div class="ai-quick-actions">
          <button class="ai-quick-btn" onclick="aiQuickAction(&#39;who-needs-attention&#39;); return false;">
            <span class="ai-quick-icon">‚ö†Ô∏è</span>
            <span class="ai-quick-text">Who needs attention?</span>
          </button>
          <button class="ai-quick-btn" onclick="aiQuickAction(&#39;predict-risks&#39;); return false;">
            <span class="ai-quick-icon">üîÆ</span>
            <span class="ai-quick-text">Predict performance risks</span>
          </button>
          <button class="ai-quick-btn" onclick="aiQuickAction(&#39;coaching-suggestions&#39;); return false;">
            <span class="ai-quick-icon">üí°</span>
            <span class="ai-quick-text">Get coaching suggestions</span>
          </button>
          <button class="ai-quick-btn" onclick="aiQuickAction(&#39;prep-1on1s&#39;); return false;">
            <span class="ai-quick-icon">üìã</span>
            <span class="ai-quick-text">Prep this week's 1:1s</span>
          </button>
        </div>

        <!-- Predictive Alerts Panel -->
        <div class="alert-panel" id="predictiveAlerts">
          <div class="alert-panel-header">
            <h3>üîî Predictive Alerts &amp; Early Warnings</h3>
            <button class="btn btn-secondary" onclick="refreshPredictiveAlerts()" style="font-size: 12px; padding: 6px 12px;">
              Refresh Analysis
            </button>
          </div>
          <div id="predictiveAlertsContent">
        <div class="predictive-alert critical">
          <div class="alert-severity critical">critical</div>
          <div class="alert-title">Sarah Chen at performance risk</div>
          <div class="alert-description">At risk performance status. Last contact was 5 days ago. Early-stage rep needs immediate coaching intervention.</div>
          <div class="alert-actions">
            
              <button class="alert-action-btn" data-alert-idx="0" data-action-idx="0">Schedule 1:1</button>
            
              <button class="alert-action-btn" data-alert-idx="0" data-action-idx="1">Get AI Coaching Plan</button>
            
          </div>
        </div>
      
        <div class="predictive-alert critical">
          <div class="alert-severity critical">critical</div>
          <div class="alert-title">Kevin O'Brien at performance risk</div>
          <div class="alert-description">At risk performance status. Last contact was 1 days ago. Experienced rep showing concerning pattern.</div>
          <div class="alert-actions">
            
              <button class="alert-action-btn" data-alert-idx="1" data-action-idx="0">Schedule 1:1</button>
            
              <button class="alert-action-btn" data-alert-idx="1" data-action-idx="1">Get AI Coaching Plan</button>
            
          </div>
        </div>
      
        <div class="predictive-alert warning">
          <div class="alert-severity warning">warning</div>
          <div class="alert-title">Sarah Chen has 1 overdue action</div>
          <div class="alert-description">Action items overdue by 1 days. Follow-up needed.</div>
          <div class="alert-actions">
            
              <button class="alert-action-btn" data-alert-idx="2" data-action-idx="0">Review Actions</button>
            
          </div>
        </div>
      
        <div class="predictive-alert warning">
          <div class="alert-severity warning">warning</div>
          <div class="alert-title">Sarah Chen - skill development stalled</div>
          <div class="alert-description">3 skills haven't been updated in 90+ days with significant gaps remaining. Consider reassessing development plan.</div>
          <div class="alert-actions">
            
              <button class="alert-action-btn" data-alert-idx="3" data-action-idx="0">Conduct Assessment</button>
            
          </div>
        </div>
      
        <div class="predictive-alert warning">
          <div class="alert-severity warning">warning</div>
          <div class="alert-title">Jessica Martinez - skill development stalled</div>
          <div class="alert-description">2 skills haven't been updated in 90+ days with significant gaps remaining. Consider reassessing development plan.</div>
          <div class="alert-actions">
            
              <button class="alert-action-btn" data-alert-idx="4" data-action-idx="0">Conduct Assessment</button>
            
          </div>
        </div>
      
        <div class="predictive-alert warning">
          <div class="alert-severity warning">warning</div>
          <div class="alert-title">Kevin O'Brien has 1 overdue action</div>
          <div class="alert-description">Action items overdue by 2 days. Follow-up needed.</div>
          <div class="alert-actions">
            
              <button class="alert-action-btn" data-alert-idx="5" data-action-idx="0">Review Actions</button>
            
          </div>
        </div>
      
        <div class="predictive-alert warning">
          <div class="alert-severity warning">warning</div>
          <div class="alert-title">Priya Patel - skill development stalled</div>
          <div class="alert-description">4 skills haven't been updated in 90+ days with significant gaps remaining. Consider reassessing development plan.</div>
          <div class="alert-actions">
            
              <button class="alert-action-btn" data-alert-idx="6" data-action-idx="0">Conduct Assessment</button>
            
          </div>
        </div>
      
        <div class="predictive-alert warning">
          <div class="alert-severity warning">warning</div>
          <div class="alert-title">Alicia Washington - skill development stalled</div>
          <div class="alert-description">1 skill haven't been updated in 90+ days with significant gaps remaining. Consider reassessing development plan.</div>
          <div class="alert-actions">
            
              <button class="alert-action-btn" data-alert-idx="7" data-action-idx="0">Conduct Assessment</button>
            
          </div>
        </div>
      </div>
        </div>

        <!-- Calendar Sync Status -->
        <div class="calendar-panel">
          <div class="calendar-panel-header">
            <h3>üìÖ Upcoming 1:1s &amp; Calendar Sync</h3>
            <button class="btn btn-secondary" onclick="syncCalendar()" style="font-size: 12px; padding: 6px 12px;">
              üîÑ Sync Calendar
            </button>
          </div>
          <div id="calendarContent">
          <div class="calendar-item">
            <div class="calendar-date-badge">
              <div class="calendar-date-day">15</div>
              <div class="calendar-date-month">Dec</div>
            </div>
            <div class="calendar-item-content">
              <div class="calendar-item-title">1:1 with Emily Rodriguez</div>
              <div class="calendar-item-time">2:16 PM</div>
            </div>
            <button class="btn btn-primary" onclick="prepFor1on1(3)" style="font-size: 12px; padding: 8px 16px;">
              Prep 1:1
            </button>
          </div>
        
          <div class="calendar-item">
            <div class="calendar-date-badge">
              <div class="calendar-date-day">15</div>
              <div class="calendar-date-month">Dec</div>
            </div>
            <div class="calendar-item-content">
              <div class="calendar-item-title">1:1 with Kevin O'Brien</div>
              <div class="calendar-item-time">2:16 PM</div>
            </div>
            <button class="btn btn-primary" onclick="prepFor1on1(6)" style="font-size: 12px; padding: 8px 16px;">
              Prep 1:1
            </button>
          </div>
        
          <div class="calendar-item">
            <div class="calendar-date-badge">
              <div class="calendar-date-day">15</div>
              <div class="calendar-date-month">Dec</div>
            </div>
            <div class="calendar-item-content">
              <div class="calendar-item-title">1:1 with Priya Patel</div>
              <div class="calendar-item-time">2:16 PM</div>
            </div>
            <button class="btn btn-primary" onclick="prepFor1on1(7)" style="font-size: 12px; padding: 8px 16px;">
              Prep 1:1
            </button>
          </div>
        
          <div class="calendar-item">
            <div class="calendar-date-badge">
              <div class="calendar-date-day">16</div>
              <div class="calendar-date-month">Dec</div>
            </div>
            <div class="calendar-item-content">
              <div class="calendar-item-title">1:1 with Sarah Chen</div>
              <div class="calendar-item-time">2:16 PM</div>
            </div>
            <button class="btn btn-primary" onclick="prepFor1on1(1)" style="font-size: 12px; padding: 8px 16px;">
              Prep 1:1
            </button>
          </div>
        
          <div class="calendar-item">
            <div class="calendar-date-badge">
              <div class="calendar-date-day">17</div>
              <div class="calendar-date-month">Dec</div>
            </div>
            <div class="calendar-item-content">
              <div class="calendar-item-title">1:1 with Jessica Martinez</div>
              <div class="calendar-item-time">2:16 PM</div>
            </div>
            <button class="btn btn-primary" onclick="prepFor1on1(5)" style="font-size: 12px; padding: 8px 16px;">
              Prep 1:1
            </button>
          </div>
        
          <div class="calendar-item">
            <div class="calendar-date-badge">
              <div class="calendar-date-day">19</div>
              <div class="calendar-date-month">Dec</div>
            </div>
            <div class="calendar-item-content">
              <div class="calendar-item-title">1:1 with Alicia Washington</div>
              <div class="calendar-item-time">2:16 PM</div>
            </div>
            <button class="btn btn-primary" onclick="prepFor1on1(9)" style="font-size: 12px; padding: 8px 16px;">
              Prep 1:1
            </button>
          </div>
        
          <div class="calendar-item">
            <div class="calendar-date-badge">
              <div class="calendar-date-day">21</div>
              <div class="calendar-date-month">Dec</div>
            </div>
            <div class="calendar-item-content">
              <div class="calendar-item-title">1:1 with Marcus Johnson</div>
              <div class="calendar-item-time">2:16 PM</div>
            </div>
            <button class="btn btn-primary" onclick="prepFor1on1(2)" style="font-size: 12px; padding: 8px 16px;">
              Prep 1:1
            </button>
          </div>
        </div>
        </div>

        <!-- Coaching Effectiveness -->
        <div class="effectiveness-panel">
          <div class="effectiveness-panel-header">
            <h3>üìà Coaching Effectiveness Tracking</h3>
            <button class="btn btn-secondary" onclick="viewCoachingROI()" style="font-size: 12px; padding: 6px 12px;">
              View Full Report
            </button>
          </div>
          <div id="effectivenessContent">
        <div class="effectiveness-grid">
          <div class="effectiveness-metric">
            <div class="effectiveness-value positive">+0%</div>
            <div class="effectiveness-label">Avg Skill Improvement</div>
            <div class="effectiveness-trend up">‚Üë Last 90 days</div>
          </div>
          <div class="effectiveness-metric">
            <div class="effectiveness-value">0</div>
            <div class="effectiveness-label">Total 1:1 Sessions</div>
            <div class="effectiveness-trend">‚Üë 0% vs last period</div>
          </div>
          <div class="effectiveness-metric">
            <div class="effectiveness-value negative">0%</div>
            <div class="effectiveness-label">Action Completion</div>
            <div class="effectiveness-trend down">
              Needs improvement
            </div>
          </div>
          <div class="effectiveness-metric">
            <div class="effectiveness-value ">7</div>
            <div class="effectiveness-label">Performance Improvements</div>
            <div class="effectiveness-trend">People moved to On Track</div>
          </div>
        </div>

        <div style="margin-top: 24px; padding: 16px; background: var(--bg-tertiary); border-radius: 8px;">
          <strong style="font-size: 14px;">Coaching ROI Insights:</strong>
          <ul style="margin: 12px 0 0 20px; font-size: 13px; line-height: 1.8; color: var(--text-secondary);">
            <li>Action completion below 50% - consider fewer, more focused commitments per 1:1</li><li>Increase 1:1 frequency - team averaging less than 1 session per person in tracked period</li>
          </ul>
        </div>
      </div>
        </div>

        <!-- AI Chat Interface -->
        <div class="ai-chat-container">
          <div class="ai-chat-header">
            <h3>üí¨ Ask Your AI Coach</h3>
            <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">
              Ask natural language questions about your team
            </div>
          </div>
          
          <div class="ai-chat-messages" id="aiChatMessages">
            <div class="ai-message ai-assistant">
              <div class="ai-message-avatar">ü§ñ</div>
              <div class="ai-message-content">
                <div class="ai-message-text">
                  Hi! I'm your AI coaching assistant. I can help you with:
                  <ul style="margin: 12px 0 0 20px; line-height: 1.8;">
                    <li>Coaching approach recommendations for specific team members</li>
                    <li>Risk predictions based on performance patterns</li>
                    <li>Auto-generated 1:1 agendas</li>
                    <li>Team insights and pattern analysis</li>
                    <li>Skill development strategies</li>
                  </ul>
                  Try asking: "Who should I prioritize this week?" or "Generate a 1:1 agenda for Emily"
                </div>
              </div>
            </div>
          </div>

          <div class="ai-chat-input-container">
            <textarea class="ai-chat-input" id="aiChatInput" placeholder="Ask anything about your team... (e.g., &#39;What coaching approach should I use with Sarah?&#39;)" rows="2" onkeydown="if(event.key === &#39;Enter&#39; &amp;&amp; !event.shiftKey) { event.preventDefault(); sendAIMessage(); }"></textarea>
            <button class="ai-send-btn" onclick="sendAIMessage()">
              <span id="sendBtnText">Send</span>
              <span id="sendBtnLoader" style="display: none;">‚è≥</span>
            </button>
          </div>

          <div class="ai-suggestions">
            <strong>Try asking:</strong>
            <button class="ai-suggestion-chip" onclick="askAI(this.textContent)">Who needs the most attention this week?</button>
            <button class="ai-suggestion-chip" onclick="askAI(this.textContent)">Generate 1:1 agenda for Emily Rodriguez</button>
            <button class="ai-suggestion-chip" onclick="askAI(this.textContent)">What coaching approach for struggling R2/Peacock?</button>
            <button class="ai-suggestion-chip" onclick="askAI(this.textContent)">Predict Q1 performance risks</button>
            <button class="ai-suggestion-chip" onclick="askAI(this.textContent)">How is my coaching effectiveness?</button>
          </div>
        </div>
      </div>
    </div>

    <!-- REPORTS DASHBOARD -->
    <div class="view-container" id="reports">
      <h2 style="margin-bottom: 24px; font-size: 28px; font-weight: 900;">üìä Team Performance &amp; Coaching Reports</h2>
      
      <!-- Report Filters -->
      <div class="modal-section" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%); border: 1px solid rgba(102, 126, 234, 0.2);">
        <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
          <div>
            <label class="form-label" style="margin-bottom: 4px;">Time Period</label>
            <select class="form-select" id="reportTimePeriod" onchange="renderAllReports()" style="min-width: 150px;">
              <option value="30">Last 30 Days</option>
              <option value="60">Last 60 Days</option>
              <option value="90" selected="">Last 90 Days</option>
              <option value="365">Last Year</option>
              <option value="all">All Time</option>
            </select>
          </div>
          <div>
            <label class="form-label" style="margin-bottom: 4px;">Team Member</label>
            <select class="form-select" id="reportMemberFilter" onchange="renderAllReports()" style="min-width: 150px;">
              <option value="all">All Team Members</option>
            </select>
          </div>
          <div style="margin-left: auto;">
            <button class="btn btn-secondary" onclick="exportReportData()" style="font-size: 13px;">
              üì• Export to CSV
            </button>
          </div>
        </div>
      </div>

      <!-- Report 1: Team Performance Overview -->
      <div class="modal-section">
        <div class="section-title">1Ô∏è‚É£ Team Performance Overview</div>
        <div id="performanceOverviewReport"></div>
      </div>

      <!-- Report 2: Coaching Impact Report -->
      <div class="modal-section">
        <div class="section-title">2Ô∏è‚É£ Coaching Impact Analysis</div>
        <div id="coachingImpactReport"></div>
      </div>

      <!-- Report 3: Development Progress -->
      <div class="modal-section">
        <div class="section-title">3Ô∏è‚É£ Skill Development Progress</div>
        <div id="developmentProgressReport"></div>
      </div>

      <!-- Report 4: Activity & Engagement -->
      <div class="modal-section">
        <div class="section-title">4Ô∏è‚É£ Activity &amp; Engagement Metrics</div>
        <div id="activityEngagementReport"></div>
      </div>

      <!-- Report 5: Individual Deep Dives -->
      <div class="modal-section">
        <div class="section-title">5Ô∏è‚É£ Individual Performance Deep Dive</div>
        <div id="individualDeepDiveReport"></div>
      </div>
    </div>

    <!-- COACHING SCENARIO LIBRARY -->
    <div class="view-container" id="scenarios">
      <h2 style="margin-bottom: 24px; font-size: 28px; font-weight: 900;">Coaching Scenario Library</h2>
      
      <div class="filter-bar">
        <input type="text" class="search-box" id="scenarioSearch" placeholder="Search scenarios...">
        <select class="form-select" style="max-width: 200px;" id="profileFilter">
          <option value="">All Profiles</option>
          <option value="R1">R1 (New/Learning)</option>
          <option value="R2">R2 (Growing)</option>
          <option value="R3">R3 (Capable)</option>
          <option value="R4">R4 (Expert)</option>
          <option value="Owl">Owl (Thinker)</option>
          <option value="Panther">Panther (Driver)</option>
          <option value="Peacock">Peacock (Influencer)</option>
          <option value="Dolphin">Dolphin (Harmonizer)</option>
        </select>
      </div>

      <div class="scenario-grid" id="scenarioGrid">
        <div class="scenario-card" onclick="openScenarioModal(1)">
          <div class="scenario-title">Giving Critical Feedback (SBI Model)</div>
          <div class="scenario-profiles">For: R2, Peacock</div>
          <div class="scenario-preview">Team member missed quota two quarters in a row</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(2)">
          <div class="scenario-title">Giving Critical Feedback (SBI Model)</div>
          <div class="scenario-profiles">For: R2, Owl</div>
          <div class="scenario-preview">Team member missed quota two quarters in a row</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(3)">
          <div class="scenario-title">Giving Critical Feedback (SBI Model)</div>
          <div class="scenario-profiles">For: R2, Panther</div>
          <div class="scenario-preview">Team member missed quota two quarters in a row</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(4)">
          <div class="scenario-title">Giving Critical Feedback (SBI Model)</div>
          <div class="scenario-profiles">For: R2, Dolphin</div>
          <div class="scenario-preview">Team member missed quota two quarters in a row</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(5)">
          <div class="scenario-title">Coaching on Lost Deal (GROW Model)</div>
          <div class="scenario-profiles">For: R1, Owl</div>
          <div class="scenario-preview">First major deal loss, rep is discouraged</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(6)">
          <div class="scenario-title">Coaching on Lost Deal</div>
          <div class="scenario-profiles">For: R3, Panther</div>
          <div class="scenario-preview">Lost major deal to competitor</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(7)">
          <div class="scenario-title">Career Development (GROW Model)</div>
          <div class="scenario-profiles">For: R3, Peacock</div>
          <div class="scenario-preview">Rep wants to move into leadership</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(8)">
          <div class="scenario-title">Handling Personal Issue Affecting Work</div>
          <div class="scenario-profiles">For: R2, Dolphin</div>
          <div class="scenario-preview">Performance drop due to personal circumstances</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(9)">
          <div class="scenario-title">Addressing Skill Gap (SBI + GROW)</div>
          <div class="scenario-profiles">For: R1, Panther</div>
          <div class="scenario-preview">New rep struggling with discovery, rushing to pitch</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(10)">
          <div class="scenario-title">Motivating During Slump (GROW Model)</div>
          <div class="scenario-profiles">For: R3, Peacock</div>
          <div class="scenario-preview">Normally high-energy rep seems deflated</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(11)">
          <div class="scenario-title">Celebrating a Big Win</div>
          <div class="scenario-profiles">For: R3, Peacock</div>
          <div class="scenario-preview">Rep just closed their biggest deal of the year</div>
        </div>
      
        <div class="scenario-card" onclick="openScenarioModal(12)">
          <div class="scenario-title">Skill Gap Discussion</div>
          <div class="scenario-profiles">For: R1, Panther</div>
          <div class="scenario-preview">New rep strong on activity but weak on discovery skills</div>
        </div>
      </div>
    </div>

    <!-- DEVELOPMENT TRACKER -->
    <div class="view-container" id="development">
      <h2 style="margin-bottom: 24px; font-size: 28px; font-weight: 900;">Team Development Dashboard</h2>
      
      <div class="two-column">
        <div>
          <div class="section-title">Skills Gap Analysis</div>
          <div id="skillsGapContent">
            <!-- Populated by JS -->
          </div>

          <div class="section-title" style="margin-top: 32px;">Development by Readiness Level</div>
          <div id="readinessDevContent">
            <!-- Populated by JS -->
          </div>
        </div>
        <div>
          <div class="section-title">Active Development Activities</div>
          <div id="devActivitiesContent">
            <!-- Populated by JS -->
          </div>

          <div class="section-title" style="margin-top: 32px;">Development Stats</div>
          <div id="devStatsContent">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>

      <div style="margin-top: 40px;">
        <div class="section-title">Individual Progress Overview</div>
        <div id="individualProgressContent">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- SETTINGS & TEAM MANAGEMENT -->
    <div class="view-container active" id="settings">
      <h2 style="margin-bottom: 24px; font-size: 28px; font-weight: 900;">Team Management</h2>
      
      <div class="modal-section">
        <div class="section-title">Team Members</div>
        <button class="btn btn-primary" onclick="addTeamMember()">+ Add Team Member</button>
        <button class="btn btn-secondary" onclick="importData()" style="margin-left: 12px;">Import CSV</button>
        <button class="btn btn-secondary" onclick="exportData()">Export Data</button>
      </div>

      <div class="modal-section" style="background: linear-gradient(135deg, rgba(0, 149, 255, 0.05) 0%, rgba(0, 112, 243, 0.02) 100%); border: 1px solid rgba(0, 149, 255, 0.2); border-radius: 12px;">
        <div class="section-title">
          üîó Salesforce Integration
          <span class="sf-connection-status" style="margin-left: 12px; font-size: 12px; font-weight: normal;"><span style="color: #ef4444; font-weight: 600;">‚óè Not Connected</span></span>
        </div>
        
        <div style="margin-bottom: 16px;">
          <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
            Connect your Salesforce org to automatically sync quota, revenue, and activity data into 1:1 sessions.
          </div>
          
          <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px;">
            <button class="btn btn-primary" onclick="connectToSalesforce()">
              üîó Connect Salesforce Account
            </button>
            <button class="btn btn-secondary" onclick="disconnectFromSalesforce()">
              üîå Disconnect
            </button>
            <button class="btn btn-secondary" onclick="autoMapAllSalesforceUsers()">
              üîÑ Auto-Map All Users
            </button>
          </div>

          <div style="padding: 12px; background: var(--bg-secondary); border-radius: 8px; font-size: 12px;">
            <div style="font-weight: 600; margin-bottom: 8px;">üìã Setup Instructions:</div>
            <ol style="margin: 0; padding-left: 20px; line-height: 1.8; color: var(--text-secondary);">
              <li>Create a <a href="https://help.salesforce.com/s/articleView?id=sf.connected_app_create.htm" target="_blank" style="color: #3b82f6; text-decoration: none;">Connected App</a> in Salesforce</li>
              <li>Enable OAuth with scopes: <code style="background: var(--bg-primary); padding: 2px 6px; border-radius: 3px;">api, refresh_token, id</code></li>
              <li>Update <code style="background: var(--bg-primary); padding: 2px 6px; border-radius: 3px;">SF_CONFIG</code> in the code with your Client ID and Secret</li>
              <li>Click "Connect Salesforce Account" above</li>
              <li>Map team members to Salesforce users (auto-map by email or manual)</li>
            </ol>
          </div>

          <div style="margin-top: 12px; padding: 12px; background: rgba(59, 130, 246, 0.05); border-left: 3px solid #3b82f6; border-radius: 4px; font-size: 12px;">
            <strong>üí° Note:</strong> For production use, implement a backend proxy to securely store OAuth tokens. Current implementation stores tokens in browser localStorage.
          </div>
        </div>
      </div>

      <div class="modal-section" style="background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px;">
        <div class="section-title" style="color: #ef4444;">‚ö†Ô∏è Reset Data</div>
        <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
          Clear all saved data and reload the demo team with Sarah Chen's 5 session history.
        </p>
        <button class="btn" onclick="resetToFreshData()" style="background: #ef4444; color: white; border: none;">
          üîÑ Reset to Fresh Demo Data
        </button>
      </div>

      <div class="modal-section">
        <div class="section-title">Edit Team Member Profiles</div>
        <div class="members-edit-grid" id="membersEditGrid">
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">Sarah Chen</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(1)" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(1)" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(1, &#39;readiness&#39;, this.value)">
                  <option value="R1">R1 - New</option>
                  <option value="R2" selected="">R2 - Growing</option>
                  <option value="R3">R3 - Capable</option>
                  <option value="R4">R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  Peacock/Dolphin
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(1, &#39;perfStatus&#39;, this.value)">
                  <option value="exceeding">Exceeding Target</option>
                  <option value="on-track">On Track</option>
                  <option value="at-risk" selected="">At Risk</option>
                  <option value="struggling">Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="Enterprise deals" onchange="quickUpdateMember(1, &#39;focusArea&#39;, this.value)" placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">Mid-Career</span>
              <span class="tag" style="font-size: 11px;">Collaborative</span>
            </div>
          </div>
        </div>
      
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">Marcus Johnson</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(2)" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(2)" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(2, &#39;readiness&#39;, this.value)">
                  <option value="R1">R1 - New</option>
                  <option value="R2">R2 - Growing</option>
                  <option value="R3" selected="">R3 - Capable</option>
                  <option value="R4">R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  Panther/Owl
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(2, &#39;perfStatus&#39;, this.value)">
                  <option value="exceeding">Exceeding Target</option>
                  <option value="on-track" selected="">On Track</option>
                  <option value="at-risk">At Risk</option>
                  <option value="struggling">Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="Closing velocity" onchange="quickUpdateMember(2, &#39;focusArea&#39;, this.value)" placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">Established</span>
              <span class="tag" style="font-size: 11px;">Independent</span>
            </div>
          </div>
        </div>
      
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">Emily Rodriguez</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(3)" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(3)" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(3, &#39;readiness&#39;, this.value)">
                  <option value="R1" selected="">R1 - New</option>
                  <option value="R2">R2 - Growing</option>
                  <option value="R3">R3 - Capable</option>
                  <option value="R4">R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  Owl/Dolphin
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(3, &#39;perfStatus&#39;, this.value)">
                  <option value="exceeding">Exceeding Target</option>
                  <option value="on-track" selected="">On Track</option>
                  <option value="at-risk">At Risk</option>
                  <option value="struggling">Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="Discovery fundamentals" onchange="quickUpdateMember(3, &#39;focusArea&#39;, this.value)" placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">Early Career</span>
              <span class="tag" style="font-size: 11px;">Independent</span>
            </div>
          </div>
        </div>
      
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">David Park</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(4)" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(4)" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(4, &#39;readiness&#39;, this.value)">
                  <option value="R1">R1 - New</option>
                  <option value="R2">R2 - Growing</option>
                  <option value="R3">R3 - Capable</option>
                  <option value="R4" selected="">R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  Dolphin/Peacock
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(4, &#39;perfStatus&#39;, this.value)">
                  <option value="exceeding" selected="">Exceeding Target</option>
                  <option value="on-track">On Track</option>
                  <option value="at-risk">At Risk</option>
                  <option value="struggling">Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="Mentoring others" onchange="quickUpdateMember(4, &#39;focusArea&#39;, this.value)" placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">Late Career</span>
              <span class="tag" style="font-size: 11px;">Collaborative</span>
            </div>
          </div>
        </div>
      
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">Jessica Martinez</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(5)" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(5)" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(5, &#39;readiness&#39;, this.value)">
                  <option value="R1">R1 - New</option>
                  <option value="R2" selected="">R2 - Growing</option>
                  <option value="R3">R3 - Capable</option>
                  <option value="R4">R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  Peacock/Owl
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(5, &#39;perfStatus&#39;, this.value)">
                  <option value="exceeding">Exceeding Target</option>
                  <option value="on-track" selected="">On Track</option>
                  <option value="at-risk">At Risk</option>
                  <option value="struggling">Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="Building pipeline consistency" onchange="quickUpdateMember(5, &#39;focusArea&#39;, this.value)" placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">Early Career</span>
              <span class="tag" style="font-size: 11px;">Collaborative</span>
            </div>
          </div>
        </div>
      
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">Kevin O'Brien</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(6)" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(6)" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(6, &#39;readiness&#39;, this.value)">
                  <option value="R1">R1 - New</option>
                  <option value="R2">R2 - Growing</option>
                  <option value="R3" selected="">R3 - Capable</option>
                  <option value="R4">R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  Panther/Owl
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(6, &#39;perfStatus&#39;, this.value)">
                  <option value="exceeding">Exceeding Target</option>
                  <option value="on-track">On Track</option>
                  <option value="at-risk" selected="">At Risk</option>
                  <option value="struggling">Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="Re-engaging with process" onchange="quickUpdateMember(6, &#39;focusArea&#39;, this.value)" placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">Mid-Career</span>
              <span class="tag" style="font-size: 11px;">Independent</span>
            </div>
          </div>
        </div>
      
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">Priya Patel</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(7)" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(7)" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(7, &#39;readiness&#39;, this.value)">
                  <option value="R1" selected="">R1 - New</option>
                  <option value="R2">R2 - Growing</option>
                  <option value="R3">R3 - Capable</option>
                  <option value="R4">R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  Owl/Dolphin
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(7, &#39;perfStatus&#39;, this.value)">
                  <option value="exceeding">Exceeding Target</option>
                  <option value="on-track" selected="">On Track</option>
                  <option value="at-risk">At Risk</option>
                  <option value="struggling">Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="Sales fundamentals and confidence" onchange="quickUpdateMember(7, &#39;focusArea&#39;, this.value)" placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">Early Career</span>
              <span class="tag" style="font-size: 11px;">Independent</span>
            </div>
          </div>
        </div>
      
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">James Thompson</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(8)" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(8)" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(8, &#39;readiness&#39;, this.value)">
                  <option value="R1">R1 - New</option>
                  <option value="R2">R2 - Growing</option>
                  <option value="R3">R3 - Capable</option>
                  <option value="R4" selected="">R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  Dolphin/Owl
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(8, &#39;perfStatus&#39;, this.value)">
                  <option value="exceeding" selected="">Exceeding Target</option>
                  <option value="on-track">On Track</option>
                  <option value="at-risk">At Risk</option>
                  <option value="struggling">Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="Strategic accounts and mentoring" onchange="quickUpdateMember(8, &#39;focusArea&#39;, this.value)" placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">Late Career</span>
              <span class="tag" style="font-size: 11px;">Hybrid</span>
            </div>
          </div>
        </div>
      
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">Alicia Washington</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(9)" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(9)" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(9, &#39;readiness&#39;, this.value)">
                  <option value="R1">R1 - New</option>
                  <option value="R2">R2 - Growing</option>
                  <option value="R3" selected="">R3 - Capable</option>
                  <option value="R4">R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  Panther/Peacock
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(9, &#39;perfStatus&#39;, this.value)">
                  <option value="exceeding" selected="">Exceeding Target</option>
                  <option value="on-track">On Track</option>
                  <option value="at-risk">At Risk</option>
                  <option value="struggling">Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="Leadership pipeline development" onchange="quickUpdateMember(9, &#39;focusArea&#39;, this.value)" placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">Mid-Career</span>
              <span class="tag" style="font-size: 11px;">Independent</span>
            </div>
          </div>
        </div>
      </div>
      </div>

      <div class="modal-section">
        <div class="section-title">1:1 Reminders</div>
        <div class="form-group">
          <label class="form-label">Default 1:1 Frequency</label>
          <select class="form-select" id="defaultFrequency">
            <option value="weekly">Weekly</option>
            <option value="biweekly">Bi-weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Reminder Lead Time (days before)</label>
          <input type="number" class="form-input" id="reminderLeadTime" value="1">
        </div>
      </div>
    </div>
  </div>

  <!-- MEMBER DETAIL MODAL -->
  <div class="modal" id="memberModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="modalMemberName">Team Member</div>
        <button class="close-btn" onclick="closeMemberModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="modal-tabs">
          <button class="modal-tab active" data-tab="prep">1:1 Prep</button>
          <button class="modal-tab" data-tab="profile">Profile</button>
          <button class="modal-tab" data-tab="history">History</button>
          <button class="modal-tab" data-tab="development">Development</button>
          <button class="modal-tab" data-tab="alerts">Alerts</button>
        </div>

        <!-- 1:1 PREP TAB -->
        <div class="tab-content active" id="tab-prep">
          <!-- Session Selector -->
          <div class="modal-section" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%); border: 1px solid rgba(102, 126, 234, 0.2);">
            <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap;">
              <div style="flex: 1; min-width: 200px;">
                <label class="form-label" style="margin-bottom: 4px;">Session History</label>
                <select class="form-select" id="sessionSelector" onchange="switchPrepSession()" style="font-weight: 500;">
                  <option value="current">Current Session</option>
                </select>
              </div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-primary" onclick="createNewPrepSession()" style="white-space: nowrap;">
                  ‚ûï New Session
                </button>
                <button class="btn btn-secondary" onclick="copyPrepSession()" style="white-space: nowrap;" title="Duplicate current session">
                  üìã Copy
                </button>
              </div>
            </div>
          </div>

          <!-- Salesforce Integration -->
          <div class="modal-section" style="background: linear-gradient(135deg, rgba(0, 149, 255, 0.05) 0%, rgba(0, 112, 243, 0.02) 100%); border: 1px solid rgba(0, 149, 255, 0.2);">
            <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
              <span>
                üîó Salesforce Integration
                <span class="sf-connection-status" style="margin-left: 12px; font-size: 12px; font-weight: normal;"><span style="color: #ef4444; font-weight: 600;">‚óè Not Connected</span></span>
              </span>
            </div>
            
            <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-bottom: 12px;">
              <button class="btn btn-primary" onclick="syncFromSalesforce()" style="font-size: 13px;">
                üîÑ Sync Current Month from Salesforce
              </button>
              
              <button class="btn btn-secondary" onclick="showSalesforceMappingModal()" style="font-size: 13px;">
                üë§ Map to SF User
              </button>
              
              <button class="btn btn-secondary" onclick="connectToSalesforce()" style="font-size: 13px;">
                üîó Connect SF Account
              </button>
              
              <div class="sf-last-sync" style="font-size: 12px; color: var(--text-muted); margin-left: auto;">
                Never synced
              </div>
            </div>
            
            <div id="sfSyncDetails" style="padding: 12px; background: var(--bg-secondary); border-radius: 8px; font-size: 13px; display: none;">
              <!-- Sync details populated after sync -->
            </div>

            <div style="margin-top: 12px; padding: 12px; background: rgba(59, 130, 246, 0.05); border-left: 3px solid #3b82f6; border-radius: 4px; font-size: 12px; color: var(--text-secondary);">
              <strong>üí° Setup Required:</strong> Update SF_CONFIG in the code with your Salesforce Connected App credentials. 
              <a href="https://help.salesforce.com/s/articleView?id=sf.connected_app_create.htm" target="_blank" style="color: #3b82f6; text-decoration: none;">
                Learn how ‚Üí
              </a>
            </div>
          </div>

          <!-- Monthly Goal Tracker -->
          <div class="modal-section">
            <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
              <span>üìä Monthly Goal Progress</span>
              <button class="btn btn-secondary" onclick="toggleMonthlyGoalEdit()" style="font-size: 12px; padding: 4px 12px;">
                ‚öôÔ∏è Edit
              </button>
            </div>
            
            <div id="monthlyGoalEditSection" style="display: none; margin-bottom: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;">
              <div style="display: flex; gap: 12px; align-items: end; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 150px;">
                  <label class="form-label">Target</label>
                  <input type="number" class="form-input" id="monthlyGoalTarget" placeholder="100000" style="font-weight: 600;">
                </div>
                <div style="flex: 1; min-width: 150px;">
                  <label class="form-label">Current Progress</label>
                  <input type="number" class="form-input" id="monthlyGoalCurrent" placeholder="65000" style="font-weight: 600;">
                </div>
                <button class="btn btn-primary" onclick="updateMonthlyGoal()">Update</button>
              </div>
            </div>

            <div id="monthlyGoalDisplay">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Weekly Targets -->
          <div class="modal-section">
            <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
              <span>üéØ Weekly Targets</span>
              <button class="btn btn-secondary" onclick="showAddWeeklyTarget()" style="font-size: 12px; padding: 4px 12px;">
                ‚ûï Add Target
              </button>
            </div>
            
            <div id="addWeeklyTargetSection" style="display: none; margin-bottom: 16px;">
              <div style="display: flex; gap: 8px; align-items: center;">
                <input type="text" class="form-input" id="newWeeklyTarget" placeholder="e.g., Close 3 deals, Complete training module..." style="flex: 1;">
                <button class="btn btn-primary" onclick="addWeeklyTarget()">Add</button>
                <button class="btn btn-secondary" onclick="hideAddWeeklyTarget()">Cancel</button>
              </div>
            </div>

            <div id="weeklyTargetsList">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Action Plan Table -->
          <div class="modal-section">
            <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
              <span>‚úÖ Action Plan</span>
              <button class="btn btn-secondary" onclick="showAddActionPlan()" style="font-size: 12px; padding: 4px 12px;">
                ‚ûï Add Action
              </button>
            </div>

            <div id="addActionPlanSection" style="display: none; margin-bottom: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;">
              <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                <input type="text" class="form-input" id="newActionMilestone" placeholder="Milestone / Action">
                <input type="text" class="form-input" id="newActionOwner" placeholder="Owner">
                <input type="date" class="form-input" id="newActionDue">
                <select class="form-select" id="newActionStatus">
                  <option value="open">Open</option>
                  <option value="in-progress">In Progress</option>
                  <option value="completed">Completed</option>
                  <option value="blocked">Blocked</option>
                </select>
              </div>
              <div style="margin-bottom: 8px;">
                <input type="text" class="form-input" id="newActionEvidence" placeholder="Evidence / Success Criteria">
              </div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-primary" onclick="addActionPlanItem()">Add Action</button>
                <button class="btn btn-secondary" onclick="hideAddActionPlan()">Cancel</button>
              </div>
            </div>

            <div id="actionPlanTable">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Auto-Generated Prep -->
          <div id="prepAlerts"></div>

          <div class="modal-section">
            <div class="section-title">üí° Auto-Generated Agenda</div>
            <div id="autoAgenda"></div>
          </div>

          <div class="modal-section">
            <div class="section-title">üó£Ô∏è Recommended Discussion Topics</div>
            <div id="recommendedTopics"></div>
          </div>

          <div class="modal-section">
            <div class="section-title">‚ùì Questions to Ask (Based on Profile)</div>
            <div id="profileQuestions"></div>
          </div>

          <!-- Session Notes -->
          <div class="modal-section">
            <div class="section-title">üìù Session Notes (Current Session)</div>
            <textarea class="form-textarea" id="currentNotes" placeholder="Take notes during your 1:1..." rows="6"></textarea>
          </div>

          <!-- Notes History -->
          <div class="modal-section">
            <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
              <span>üìö Notes History (All Sessions)</span>
              <button class="btn btn-secondary" onclick="toggleNotesHistory()" style="font-size: 12px; padding: 6px 12px;">
                <span id="notesHistoryToggle">Show All</span>
              </button>
            </div>
            <div id="notesHistoryContent" style="display: none;">
              <!-- Populated by JS -->
            </div>
          </div>

          <div class="btn-group">
            <button class="btn btn-success" onclick="save1on1Session()">üíæ Save Session</button>
            <button class="btn btn-secondary" onclick="generateFollowupEmail()">üìß Generate Follow-up Email</button>
          </div>
        </div>

        <!-- PROFILE TAB -->
        <div class="tab-content" id="tab-profile">
          <div class="two-column">
            <div>
              <div class="modal-section">
                <div class="section-title">Core Profile</div>
                <div id="coreProfileContent"></div>
              </div>

              <div class="modal-section">
                <div class="section-title">Current Context</div>
                <div class="form-group">
                  <label class="form-label">Performance Status</label>
                  <select class="form-select" id="perfStatus">
                    <option value="exceeding">Exceeding Target</option>
                    <option value="on-track">On Track</option>
                    <option value="at-risk">At Risk</option>
                    <option value="struggling">Struggling</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Current Focus Area</label>
                  <input type="text" class="form-input" id="focusArea" placeholder="e.g., Enterprise deals, objection handling...">
                </div>
                <div class="form-group">
                  <label class="form-label">Personal Notes / Sensitivities</label>
                  <textarea class="form-textarea" id="personalNotes" placeholder="Any personal circumstances, preferences, or topics to handle carefully..."></textarea>
                </div>
              </div>
            </div>

            <div>
              <div class="modal-section">
                <div class="section-title">Coaching Guidance</div>
                <div id="coachingGuidanceContent"></div>
              </div>

              <div class="modal-section">
                <div class="section-title">Goals &amp; Aspirations</div>
                <div class="form-group">
                  <label class="form-label">Career Goals</label>
                  <textarea class="form-textarea" id="careerGoals" placeholder="What does this person want to achieve?"></textarea>
                </div>
                <div class="form-group">
                  <label class="form-label">Key Motivators</label>
                  <input type="text" class="form-input" id="motivators" placeholder="What drives them?">
                </div>
                <div class="form-group">
                  <label class="form-label">Demotivators / Stressors</label>
                  <input type="text" class="form-input" id="demotivators" placeholder="What frustrates them?">
                </div>
              </div>
            </div>
          </div>

          <button class="btn btn-primary" onclick="saveProfile()">Save Profile Updates</button>
        </div>

        <!-- HISTORY TAB -->
        <div class="tab-content" id="tab-history">
          <div class="modal-section">
            <div class="section-title">Conversation History</div>
            <div id="conversationHistory"></div>
          </div>

          <div class="modal-section">
            <div class="section-title">Action Items Tracker</div>
            <div id="allActions"></div>
          </div>
        </div>

        <!-- DEVELOPMENT TAB -->
        <div class="tab-content" id="tab-development">
          <div class="modal-section">
            <div class="section-title">Development Plan</div>
            <div id="devPlanContent"></div>
          </div>

          <div class="modal-section">
            <div class="section-title">Skill Progress</div>
            <div id="skillProgressContent"></div>
            
            <button class="btn btn-secondary" onclick="toggleAddSkillForm()" style="margin-top: 16px;">
              + Add Skill to Track
            </button>

            <div id="addSkillForm" style="display: none; margin-top: 16px; padding: 20px; background: var(--bg-tertiary); border-radius: 8px;">
              <div class="form-group">
                <label class="form-label">Skill Name</label>
                <select class="form-select" id="newSkillName" onchange="handleSkillSelection()">
                  <option value="">-- Select from common skills --</option>
                  <optgroup label="Sales Fundamentals">
                    <option value="Discovery Skills">Discovery Skills</option>
                    <option value="Prospecting">Prospecting</option>
                    <option value="Qualification">Qualification</option>
                    <option value="Objection Handling">Objection Handling</option>
                    <option value="Closing Skills">Closing Skills</option>
                    <option value="Negotiation">Negotiation</option>
                  </optgroup>
                  <optgroup label="Advanced Sales">
                    <option value="Enterprise Selling">Enterprise Selling</option>
                    <option value="Strategic Account Planning">Strategic Account Planning</option>
                    <option value="Executive Presence">Executive Presence</option>
                    <option value="Value Selling">Value Selling</option>
                    <option value="Solution Selling">Solution Selling</option>
                    <option value="Consultative Selling">Consultative Selling</option>
                  </optgroup>
                  <optgroup label="Account Management">
                    <option value="Cross-sell/Upsell">Cross-sell/Upsell</option>
                    <option value="Customer Success">Customer Success</option>
                    <option value="Relationship Management">Relationship Management</option>
                    <option value="Account Expansion">Account Expansion</option>
                  </optgroup>
                  <optgroup label="Technical &amp; Product">
                    <option value="Product Knowledge">Product Knowledge</option>
                    <option value="Technical Acumen">Technical Acumen</option>
                    <option value="Demo Skills">Demo Skills</option>
                    <option value="POC Management">POC Management</option>
                  </optgroup>
                  <optgroup label="Leadership &amp; Soft Skills">
                    <option value="Leadership">Leadership</option>
                    <option value="Coaching &amp; Mentoring">Coaching &amp; Mentoring</option>
                    <option value="Communication">Communication</option>
                    <option value="Presentation Skills">Presentation Skills</option>
                    <option value="Time Management">Time Management</option>
                    <option value="Pipeline Management">Pipeline Management</option>
                  </optgroup>
                  <option value="CUSTOM">-- Custom Skill (Type Below) --</option>
                </select>
              </div>

              <div class="form-group" id="customSkillGroup" style="display: none;">
                <label class="form-label">Custom Skill Name</label>
                <input type="text" class="form-input" id="customSkillName" placeholder="Enter custom skill name">
              </div>

              <div class="form-group">
                <label class="form-label">Current Level: <span id="currentLevelValue" style="color: var(--accent-primary); font-weight: 700;">50%</span></label>
                <input type="range" class="slider" id="currentLevel" min="0" max="100" value="50" oninput="document.getElementById(&#39;currentLevelValue&#39;).textContent = this.value + &#39;%&#39;">
                <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                  <span>0% - No experience</span>
                  <span>50% - Competent</span>
                  <span>100% - Expert</span>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Target Level: <span id="targetLevelValue" style="color: var(--accent-primary); font-weight: 700;">75%</span></label>
                <input type="range" class="slider" id="targetLevel" min="0" max="100" value="75" oninput="document.getElementById(&#39;targetLevelValue&#39;).textContent = this.value + &#39;%&#39;">
                <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                  <span>0%</span>
                  <span>50%</span>
                  <span>100%</span>
                </div>
              </div>

              <div class="btn-group">
                <button class="btn btn-primary" onclick="addSkillToTrack()">Add Skill</button>
                <button class="btn btn-secondary" onclick="toggleAddSkillForm()">Cancel</button>
              </div>
            </div>
          </div>

          <div class="modal-section">
            <div class="section-title">Add Development Activity</div>
            <div class="form-group">
              <label class="form-label">Activity Type</label>
              <select class="form-select" id="activityType">
                <option value="training">Training Course</option>
                <option value="shadowing">Shadowing</option>
                <option value="project">Stretch Project</option>
                <option value="mentoring">Mentoring</option>
                <option value="reading">Reading/Research</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Description</label>
              <input type="text" class="form-input" id="activityDesc" placeholder="e.g., Complete Challenger Sale training">
            </div>
            <div class="form-group">
              <label class="form-label">Target Completion</label>
              <input type="date" class="form-input" id="activityTarget">
            </div>
            <button class="btn btn-primary" onclick="addDevActivity()">Add Activity</button>
          </div>
        </div>

        <!-- ALERTS TAB -->
        <div class="tab-content" id="tab-alerts">
          <div class="modal-section">
            <div class="section-title">Active Alerts &amp; Reminders</div>
            <div id="alertsContent"></div>
          </div>

          <div class="modal-section">
            <div class="section-title">Create Custom Alert</div>
            <div class="form-group">
              <label class="form-label">Alert Type</label>
              <select class="form-select" id="alertType">
                <option value="reminder">Reminder</option>
                <option value="performance">Performance Check-in</option>
                <option value="development">Development Milestone</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Alert Message</label>
              <input type="text" class="form-input" id="alertMessage" placeholder="What should I be reminded about?">
            </div>
            <div class="form-group">
              <label class="form-label">Trigger Date</label>
              <input type="date" class="form-input" id="alertDate">
            </div>
            <button class="btn btn-primary" onclick="createAlert()">Create Alert</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SALESFORCE MAPPING MODAL -->
  <div class="modal" id="salesforceMappingModal">
    <div class="modal-overlay" onclick="closeSalesforceMappingModal()"></div>
    <div class="modal-container" style="max-width: 600px;">
      <div class="modal-header">
        <div class="modal-title">Map to Salesforce User</div>
        <button class="modal-close" onclick="closeSalesforceMappingModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div id="salesforceMappingContent">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- EDIT PROFILE MODAL -->
  <div class="edit-modal" id="editProfileModal">
    <div class="edit-modal-content">
      <div class="edit-modal-title" id="editProfileTitle">Edit Profile</div>
      
      <div class="form-group">
        <label class="form-label">Name</label>
        <input type="text" class="form-input" id="editProfileName">
      </div>

      <div class="form-group">
        <label class="form-label">Readiness Level</label>
        <select class="form-select" id="editProfileReadiness">
          <option value="R1">R1 - New to Role/Task</option>
          <option value="R2">R2 - Growing Skills</option>
          <option value="R3">R3 - Capable Performer</option>
          <option value="R4">R4 - Expert Performer</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Competence Level (Skills)</label>
        <div style="display: flex; align-items: center; gap: 12px;">
          <input type="range" class="slider" id="editProfileCompetence" min="1" max="10" value="5" oninput="document.getElementById(&#39;compValue&#39;).textContent = this.value; updateReadinessSuggestion()">
          <span id="compValue" class="slider-value">5</span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Commitment Level (Confidence/Motivation)</label>
        <div style="display: flex; align-items: center; gap: 12px;">
          <input type="range" class="slider" id="editProfileCommitment" min="1" max="10" value="5" oninput="document.getElementById(&#39;commValue&#39;).textContent = this.value; updateReadinessSuggestion()">
          <span id="commValue" class="slider-value">5</span>
        </div>
      </div>

      <div id="readinessSuggestion" class="info-card" style="display: none; margin-bottom: 16px;">
        <div class="info-card-content" style="font-size: 13px;"></div>
      </div>

      <div class="form-group">
        <label class="form-label">Personality Type (Primary)</label>
        <select class="form-select" id="editProfilePersonality">
          <option value="Owl">ü¶â Owl (Analytical Thinker)</option>
          <option value="Panther">üêÜ Panther (Results Driver)</option>
          <option value="Peacock">ü¶ö Peacock (People Influencer)</option>
          <option value="Dolphin">üê¨ Dolphin (Team Harmonizer)</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Personality Type (Secondary) - Optional</label>
        <select class="form-select" id="editProfilePersonalitySecondary">
          <option value="">None - Pure primary type</option>
          <option value="Owl">ü¶â Owl (Analytical Thinker)</option>
          <option value="Panther">üêÜ Panther (Results Driver)</option>
          <option value="Peacock">ü¶ö Peacock (People Influencer)</option>
          <option value="Dolphin">üê¨ Dolphin (Team Harmonizer)</option>
        </select>
        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
          Most people are a blend. Select the secondary trait if applicable.
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Career Stage</label>
        <select class="form-select" id="editProfileCareerStage">
          <option value="Early Career">Early Career (0-3 years)</option>
          <option value="Mid-Career">Mid-Career (3-7 years)</option>
          <option value="Established">Established (7-15 years)</option>
          <option value="Late Career">Late Career (15+ years)</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Work Style</label>
        <select class="form-select" id="editProfileWorkStyle">
          <option value="Independent">Independent</option>
          <option value="Collaborative">Collaborative</option>
          <option value="Hybrid">Hybrid</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Communication Style</label>
        <select class="form-select" id="editProfileCommStyle">
          <option value="Director">Director (Direct, Results-focused)</option>
          <option value="Socializer">Socializer (Enthusiastic, People-focused)</option>
          <option value="Relater">Relater (Supportive, Relationship-focused)</option>
          <option value="Thinker">Thinker (Analytical, Data-focused)</option>
        </select>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary" onclick="saveProfileEdit()">Save Changes</button>
        <button class="btn btn-secondary" onclick="closeEditProfileModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- SKILL ASSESSMENT MODAL -->
  <div class="modal" id="skillAssessmentModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="assessmentModalTitle">Skill Assessment</div>
        <button class="close-btn" onclick="closeSkillAssessment()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="info-card" style="margin-bottom: 24px;">
          <div class="info-card-content">
            <strong>Quarterly Skill Assessment</strong><br>
            Update all skill levels at once. Changes will be timestamped and saved to history for progress tracking.
          </div>
        </div>

        <div id="assessmentSkillsList">
          <!-- Skills populated by JS -->
        </div>

        <div class="form-group" style="margin-top: 24px;">
          <label class="form-label">Assessment Notes (Optional)</label>
          <textarea class="form-textarea" id="assessmentNotes" placeholder="Any observations or context about this assessment..."></textarea>
        </div>

        <div class="btn-group">
          <button class="btn btn-success" onclick="saveSkillAssessment()">Save Assessment</button>
          <button class="btn btn-secondary" onclick="closeSkillAssessment()">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SKILL HISTORY MODAL -->
  <div class="modal" id="skillHistoryModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="historyModalTitle">Skill History</div>
        <button class="close-btn" onclick="closeSkillHistory()">√ó</button>
      </div>
      <div class="modal-body">
        <div id="skillHistoryContent">
          <!-- History populated by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- SCENARIO DETAIL MODAL -->
  <div class="modal" id="scenarioModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="scenarioTitle">Coaching Scenario</div>
        <button class="close-btn" onclick="closeScenarioModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div id="scenarioContent"></div>
      </div>
    </div>
  </div>

  <script>
    // ==========================================
    // SALESFORCE INTEGRATION
    // ==========================================
    
    // Salesforce Configuration
    const SF_CONFIG = {
      clientId: 'YOUR_SALESFORCE_CLIENT_ID', // Replace with your Connected App Client ID
      clientSecret: 'YOUR_SALESFORCE_CLIENT_SECRET', // Replace with your Client Secret
      redirectUri: window.location.origin + window.location.pathname, // Current page URL
      loginUrl: 'https://login.salesforce.com', // Use 'https://test.salesforce.com' for sandbox
      apiVersion: 'v59.0'
    };

    // Salesforce API Class
    class SalesforceAPI {
      constructor() {
        this.accessToken = localStorage.getItem('sf_access_token');
        this.refreshToken = localStorage.getItem('sf_refresh_token');
        this.instanceUrl = localStorage.getItem('sf_instance_url');
      }

      isConnected() {
        return !!this.accessToken && !!this.instanceUrl;
      }

      async query(soql) {
        if (!this.isConnected()) {
          throw new Error('Not connected to Salesforce');
        }

        const url = `${this.instanceUrl}/services/data/${SF_CONFIG.apiVersion}/query?q=${encodeURIComponent(soql)}`;
        
        try {
          const response = await fetch(url, {
            headers: {
              'Authorization': `Bearer ${this.accessToken}`,
              'Content-Type': 'application/json'
            }
          });

          if (response.status === 401) {
            // Token expired, try to refresh
            await this.refreshAccessToken();
            return this.query(soql); // Retry
          }

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error[0]?.message || 'Salesforce API error');
          }

          return await response.json();
        } catch (error) {
          console.error('Salesforce query error:', error);
          throw error;
        }
      }

      async refreshAccessToken() {
        if (!this.refreshToken) {
          throw new Error('No refresh token available');
        }

        const tokenUrl = `${SF_CONFIG.loginUrl}/services/oauth2/token`;
        
        const response = await fetch(tokenUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            grant_type: 'refresh_token',
            refresh_token: this.refreshToken,
            client_id: SF_CONFIG.clientId,
            client_secret: SF_CONFIG.clientSecret
          })
        });

        if (!response.ok) {
          throw new Error('Failed to refresh token');
        }

        const tokens = await response.json();
        this.accessToken = tokens.access_token;
        localStorage.setItem('sf_access_token', tokens.access_token);
        this.instanceUrl = tokens.instance_url;
        localStorage.setItem('sf_instance_url', tokens.instance_url);
      }

      async getMonthlyPerformance(userId, year, month) {
        const startDate = `${year}-${month.toString().padStart(2, '0')}-01`;
        const lastDay = new Date(year, month, 0).getDate();
        const endDate = `${year}-${month.toString().padStart(2, '0')}-${lastDay}`;
        
        // Revenue Closed
        const closedDealsQuery = `
          SELECT SUM(Amount) totalRevenue, COUNT(Id) closedDeals
          FROM Opportunity
          WHERE OwnerId = '${userId}'
          AND IsWon = true
          AND CloseDate >= ${startDate}
          AND CloseDate <= ${endDate}
        `;
        
        // Opportunities Created
        const oppsCreatedQuery = `
          SELECT COUNT(Id) oppsCreated
          FROM Opportunity
          WHERE OwnerId = '${userId}'
          AND CreatedDate >= ${startDate}T00:00:00Z
          AND CreatedDate <= ${endDate}T23:59:59Z
        `;
        
        // Deals in Negotiation (current state)
        const negotiationQuery = `
          SELECT COUNT(Id) dealsInNegotiation
          FROM Opportunity
          WHERE OwnerId = '${userId}'
          AND StageName IN ('Negotiation', 'Proposal/Price Quote')
          AND IsClosed = false
        `;
        
        // Get quota from User object (assumes you have a Monthly_Quota__c custom field)
        const quotaQuery = `
          SELECT Monthly_Quota__c
          FROM User
          WHERE Id = '${userId}'
        `;
        
        try {
          const [closed, created, negotiation, quota] = await Promise.all([
            this.query(closedDealsQuery),
            this.query(oppsCreatedQuery),
            this.query(negotiationQuery),
            this.query(quotaQuery)
          ]);
          
          const targetQuota = quota.records[0]?.Monthly_Quota__c || 250000;
          const revenue = closed.records[0]?.totalRevenue || 0;
          
          return {
            target: targetQuota,
            current: revenue,
            opportunitiesCreated: created.records[0]?.oppsCreated || 0,
            dealsToNegotiate: negotiation.records[0]?.dealsInNegotiation || 0,
            revenueClosed: revenue
          };
        } catch (error) {
          console.error('Error fetching monthly performance:', error);
          throw error;
        }
      }

      async getWeeklyActivity(userId, startDate, endDate) {
        // Meetings booked
        const meetingsQuery = `
          SELECT COUNT(Id) meetings
          FROM Event
          WHERE OwnerId = '${userId}'
          AND StartDateTime >= ${startDate}T00:00:00Z
          AND StartDateTime <= ${endDate}T23:59:59Z
        `;
        
        // New prospects (leads created)
        const prospectsQuery = `
          SELECT COUNT(Id) prospects
          FROM Lead
          WHERE OwnerId = '${userId}'
          AND CreatedDate >= ${startDate}T00:00:00Z
          AND CreatedDate <= ${endDate}T23:59:59Z
          AND IsConverted = false
        `;
        
        // Calls made
        const callsQuery = `
          SELECT COUNT(Id) calls
          FROM Task
          WHERE OwnerId = '${userId}'
          AND Type = 'Call'
          AND Status = 'Completed'
          AND CompletedDateTime >= ${startDate}T00:00:00Z
          AND CompletedDateTime <= ${endDate}T23:59:59Z
        `;
        
        try {
          const [meetings, prospects, calls] = await Promise.all([
            this.query(meetingsQuery),
            this.query(prospectsQuery),
            this.query(callsQuery)
          ]);
          
          return {
            meetingsBooked: meetings.records[0]?.meetings || 0,
            newProspects: prospects.records[0]?.prospects || 0,
            callsCompleted: calls.records[0]?.calls || 0
          };
        } catch (error) {
          console.error('Error fetching weekly activity:', error);
          throw error;
        }
      }

      async getPipelineHealth(userId) {
        const query = `
          SELECT 
            SUM(Amount) totalPipeline,
            COUNT(Id) openOpps,
            AVG(Probability) avgProbability
          FROM Opportunity
          WHERE OwnerId = '${userId}'
          AND IsClosed = false
        `;
        
        try {
          const result = await this.query(query);
          return result.records[0] || { totalPipeline: 0, openOpps: 0, avgProbability: 0 };
        } catch (error) {
          console.error('Error fetching pipeline health:', error);
          throw error;
        }
      }

      async findUserByEmail(email) {
        const query = `SELECT Id, Name, Email FROM User WHERE Email = '${email}' AND IsActive = true LIMIT 1`;
        try {
          const result = await this.query(query);
          return result.records[0] || null;
        } catch (error) {
          console.error('Error finding user by email:', error);
          throw error;
        }
      }

      disconnect() {
        localStorage.removeItem('sf_access_token');
        localStorage.removeItem('sf_refresh_token');
        localStorage.removeItem('sf_instance_url');
        this.accessToken = null;
        this.refreshToken = null;
        this.instanceUrl = null;
      }
    }

    // OAuth Functions
    function connectToSalesforce() {
      const authUrl = `${SF_CONFIG.loginUrl}/services/oauth2/authorize?` +
        `response_type=code&` +
        `client_id=${SF_CONFIG.clientId}&` +
        `redirect_uri=${encodeURIComponent(SF_CONFIG.redirectUri)}&` +
        `scope=api refresh_token`;
      
      // Save state to know we're in OAuth flow
      sessionStorage.setItem('sf_oauth_in_progress', 'true');
      
      window.location.href = authUrl;
    }

    async function handleSalesforceOAuthCallback() {
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');
      
      if (!code || sessionStorage.getItem('sf_oauth_in_progress') !== 'true') {
        return false;
      }
      
      sessionStorage.removeItem('sf_oauth_in_progress');
      
      try {
        showLoadingIndicator('Connecting to Salesforce...');
        
        // Exchange code for token
        const tokenUrl = `${SF_CONFIG.loginUrl}/services/oauth2/token`;
        
        const response = await fetch(tokenUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            grant_type: 'authorization_code',
            code: code,
            client_id: SF_CONFIG.clientId,
            client_secret: SF_CONFIG.clientSecret,
            redirect_uri: SF_CONFIG.redirectUri
          })
        });
        
        if (!response.ok) {
          throw new Error('Failed to exchange code for token');
        }
        
        const tokens = await response.json();
        
        // Store tokens
        localStorage.setItem('sf_access_token', tokens.access_token);
        localStorage.setItem('sf_refresh_token', tokens.refresh_token);
        localStorage.setItem('sf_instance_url', tokens.instance_url);
        
        hideLoadingIndicator();
        
        // Clean URL
        window.history.replaceState({}, document.title, window.location.pathname);
        
        alert('‚úì Successfully connected to Salesforce!');
        updateSalesforceConnectionStatus();
        
        return true;
      } catch (error) {
        console.error('OAuth error:', error);
        hideLoadingIndicator();
        alert('‚ùå Failed to connect to Salesforce. Please try again.');
        return false;
      }
    }

    function disconnectFromSalesforce() {
      if (confirm('Are you sure you want to disconnect from Salesforce?')) {
        const sf = new SalesforceAPI();
        sf.disconnect();
        updateSalesforceConnectionStatus();
        alert('‚úì Disconnected from Salesforce');
      }
    }

    function updateSalesforceConnectionStatus() {
      const sf = new SalesforceAPI();
      const statusElements = document.querySelectorAll('.sf-connection-status');
      
      statusElements.forEach(el => {
        if (sf.isConnected()) {
          el.innerHTML = '<span style="color: #22c55e; font-weight: 600;">‚óè Connected</span>';
        } else {
          el.innerHTML = '<span style="color: #ef4444; font-weight: 600;">‚óè Not Connected</span>';
        }
      });
    }

    // Sync Functions
    async function syncFromSalesforce() {
      if (!currentMember) {
        alert('‚ö†Ô∏è No team member selected');
        return;
      }

      if (!currentMember.salesforceUserId) {
        alert('‚ö†Ô∏è This team member is not mapped to a Salesforce user. Please map them first.');
        showSalesforceMappingModal();
        return;
      }

      const sf = new SalesforceAPI();
      
      if (!sf.isConnected()) {
        alert('‚ö†Ô∏è Not connected to Salesforce. Please connect first.');
        return;
      }

      try {
        showLoadingIndicator('Syncing from Salesforce...');
        
        // Get current month/year
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth() + 1;
        
        // Pull monthly data
        const monthlyData = await sf.getMonthlyPerformance(
          currentMember.salesforceUserId,
          year,
          month
        );
        
        // Pull weekly data (last 7 days)
        const weekStart = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)
          .toISOString().split('T')[0];
        const weekEnd = now.toISOString().split('T')[0];
        
        const weeklyData = await sf.getWeeklyActivity(
          currentMember.salesforceUserId,
          weekStart,
          weekEnd
        );
        
        // Get pipeline health
        const pipeline = await sf.getPipelineHealth(currentMember.salesforceUserId);
        
        // Update current session or create new one
        if (!currentSession) {
          // Create new session for current month
          const sessionId = `session-${Date.now()}`;
          currentMember.sessions1on1 = currentMember.sessions1on1 || {};
          currentMember.sessions1on1[sessionId] = {
            date: now.toISOString(),
            dateFormatted: now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
            created: now.toISOString(),
            monthlyGoal: monthlyData,
            weeklyTargets: [],
            actionPlan: [],
            notes: ''
          };
          currentSession = currentMember.sessions1on1[sessionId];
          currentSessionId = sessionId;
        } else {
          // Update existing session
          currentSession.monthlyGoal = monthlyData;
        }
        
        // Auto-generate weekly targets based on actual data
        currentSession.weeklyTargets = [
          {
            id: Date.now(),
            text: `${weeklyData.meetingsBooked} meetings booked (Target: 7)`,
            status: weeklyData.meetingsBooked >= 7 ? 'completed' : weeklyData.meetingsBooked >= 5 ? 'paused' : 'failed'
          },
          {
            id: Date.now() + 1,
            text: `${weeklyData.newProspects} new prospect meetings (Target: 3)`,
            status: weeklyData.newProspects >= 3 ? 'completed' : weeklyData.newProspects >= 2 ? 'paused' : 'failed'
          },
          {
            id: Date.now() + 2,
            text: `${weeklyData.callsCompleted} calls completed (Target: 20)`,
            status: weeklyData.callsCompleted >= 20 ? 'completed' : weeklyData.callsCompleted >= 15 ? 'paused' : 'failed'
          },
          {
            id: Date.now() + 3,
            text: `Pipeline: $${(pipeline.totalPipeline / 1000).toFixed(0)}K across ${pipeline.openOpps} opps`,
            status: 'completed'
          }
        ];
        
        // Save
        saveData();
        
        // Update last sync time
        localStorage.setItem('sf_last_sync', now.toISOString());
        localStorage.setItem(`sf_last_sync_${currentMember.id}`, now.toISOString());
        
        // Re-render
        renderMonthlyGoal();
        renderWeeklyTargets();
        updateLastSyncTime();
        
        hideLoadingIndicator();
        
        // Show success with details
        const syncDetails = document.getElementById('sfSyncDetails');
        if (syncDetails) {
          syncDetails.innerHTML = `
            <div style="color: #22c55e; font-weight: 600; margin-bottom: 8px;">‚úì Successfully synced from Salesforce</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px;">
              <div>
                <div style="color: var(--text-muted); font-size: 11px;">Revenue Closed</div>
                <div style="font-weight: 600;">$${(monthlyData.current / 1000).toFixed(0)}K / $${(monthlyData.target / 1000).toFixed(0)}K</div>
              </div>
              <div>
                <div style="color: var(--text-muted); font-size: 11px;">Opps Created</div>
                <div style="font-weight: 600;">${monthlyData.opportunitiesCreated}</div>
              </div>
              <div>
                <div style="color: var(--text-muted); font-size: 11px;">In Negotiation</div>
                <div style="font-weight: 600;">${monthlyData.dealsToNegotiate}</div>
              </div>
              <div>
                <div style="color: var(--text-muted); font-size: 11px;">Pipeline Value</div>
                <div style="font-weight: 600;">$${(pipeline.totalPipeline / 1000).toFixed(0)}K</div>
              </div>
            </div>
          `;
        }
        
        alert('‚úì Successfully synced from Salesforce!');
        
      } catch (error) {
        console.error('Salesforce sync error:', error);
        hideLoadingIndicator();
        alert(`‚ùå Error syncing from Salesforce: ${error.message}`);
      }
    }

    function updateLastSyncTime() {
      const lastSyncElements = document.querySelectorAll('.sf-last-sync');
      const lastSync = localStorage.getItem(`sf_last_sync_${currentMember?.id}`);
      
      lastSyncElements.forEach(el => {
        if (lastSync) {
          const syncDate = new Date(lastSync);
          const now = new Date();
          const diffMinutes = Math.floor((now - syncDate) / 60000);
          
          let timeAgo = '';
          if (diffMinutes < 1) {
            timeAgo = 'just now';
          } else if (diffMinutes < 60) {
            timeAgo = `${diffMinutes} min ago`;
          } else if (diffMinutes < 1440) {
            timeAgo = `${Math.floor(diffMinutes / 60)} hr ago`;
          } else {
            timeAgo = `${Math.floor(diffMinutes / 1440)} days ago`;
          }
          
          el.textContent = `Last synced: ${timeAgo}`;
        } else {
          el.textContent = 'Never synced';
        }
      });
    }

    // Salesforce User Mapping
    function showSalesforceMappingModal() {
      const modal = document.getElementById('salesforceMappingModal');
      if (modal) {
        modal.classList.add('active');
        renderSalesforceMappingOptions();
      }
    }

    function closeSalesforceMappingModal() {
      const modal = document.getElementById('salesforceMappingModal');
      if (modal) {
        modal.classList.remove('active');
      }
    }

    async function renderSalesforceMappingOptions() {
      const content = document.getElementById('salesforceMappingContent');
      if (!content || !currentMember) return;
      
      const sf = new SalesforceAPI();
      
      if (!sf.isConnected()) {
        content.innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üîó</div>
            <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Not Connected to Salesforce</div>
            <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 24px;">
              Connect to Salesforce to map team members to Salesforce users
            </div>
            <button class="btn btn-primary" onclick="connectToSalesforce()">
              Connect to Salesforce
            </button>
          </div>
        `;
        return;
      }
      
      content.innerHTML = `
        <div class="form-group">
          <label class="form-label">Map ${currentMember.name} to Salesforce User</label>
          <div style="margin-bottom: 16px;">
            <input type="text" 
              class="form-input" 
              id="sfUserEmail" 
              placeholder="Enter Salesforce user email"
              value="${currentMember.email || ''}"
              style="margin-bottom: 8px;">
            <button class="btn btn-secondary" onclick="findSalesforceUserByEmail()">
              üîç Find User
            </button>
          </div>
          
          <div id="sfUserSearchResults"></div>
          
          <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--bg-secondary);">
            <label class="form-label">Or enter Salesforce User ID directly:</label>
            <input type="text" 
              class="form-input" 
              id="sfUserId" 
              placeholder="e.g., 0051U000001AbCd"
              value="${currentMember.salesforceUserId || ''}">
          </div>
          
          <div style="margin-top: 24px; display: flex; gap: 12px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="closeSalesforceMappingModal()">Cancel</button>
            <button class="btn btn-primary" onclick="saveSalesforceMapping()">Save Mapping</button>
          </div>
        </div>
      `;
    }

    async function findSalesforceUserByEmail() {
      const email = document.getElementById('sfUserEmail').value.trim();
      if (!email) {
        alert('Please enter an email address');
        return;
      }
      
      const sf = new SalesforceAPI();
      const resultsDiv = document.getElementById('sfUserSearchResults');
      
      try {
        showLoadingIndicator('Searching Salesforce...');
        
        const user = await sf.findUserByEmail(email);
        
        hideLoadingIndicator();
        
        if (user) {
          resultsDiv.innerHTML = `
            <div style="padding: 12px; background: var(--bg-secondary); border-radius: 8px; margin-top: 8px;">
              <div style="color: #22c55e; font-weight: 600; margin-bottom: 8px;">‚úì User Found</div>
              <div style="font-size: 13px;">
                <div><strong>Name:</strong> ${user.Name}</div>
                <div><strong>Email:</strong> ${user.Email}</div>
                <div><strong>User ID:</strong> ${user.Id}</div>
              </div>
              <button class="btn btn-primary" onclick="document.getElementById('sfUserId').value = '${user.Id}'" style="margin-top: 12px; font-size: 12px;">
                Use This User
              </button>
            </div>
          `;
          document.getElementById('sfUserId').value = user.Id;
        } else {
          resultsDiv.innerHTML = `
            <div style="padding: 12px; background: #fee; border-radius: 8px; margin-top: 8px; color: #991b1b;">
              ‚ùå No active Salesforce user found with email: ${email}
            </div>
          `;
        }
      } catch (error) {
        hideLoadingIndicator();
        resultsDiv.innerHTML = `
          <div style="padding: 12px; background: #fee; border-radius: 8px; margin-top: 8px; color: #991b1b;">
            ‚ùå Error searching Salesforce: ${error.message}
          </div>
        `;
      }
    }

    function saveSalesforceMapping() {
      const userId = document.getElementById('sfUserId').value.trim();
      
      if (!userId) {
        alert('Please enter a Salesforce User ID');
        return;
      }
      
      if (!currentMember) {
        alert('No team member selected');
        return;
      }
      
      currentMember.salesforceUserId = userId;
      saveData();
      
      closeSalesforceMappingModal();
      alert(`‚úì Successfully mapped ${currentMember.name} to Salesforce User ID: ${userId}`);
      
      // Update UI if on prep tab
      updateSalesforceConnectionStatus();
    }

    async function autoMapAllSalesforceUsers() {
      const sf = new SalesforceAPI();
      
      if (!sf.isConnected()) {
        alert('‚ö†Ô∏è Not connected to Salesforce. Please connect first.');
        return;
      }
      
      if (!confirm('Auto-map all team members to Salesforce users by email address?')) {
        return;
      }
      
      try {
        showLoadingIndicator('Auto-mapping team members...');
        
        let mapped = 0;
        let failed = 0;
        
        for (let member of teamMembers) {
          if (!member.salesforceUserId && member.email) {
            try {
              const user = await sf.findUserByEmail(member.email);
              if (user) {
                member.salesforceUserId = user.Id;
                mapped++;
              } else {
                failed++;
              }
            } catch (error) {
              console.error(`Failed to map ${member.name}:`, error);
              failed++;
            }
          }
        }
        
        saveData();
        hideLoadingIndicator();
        
        alert(`‚úì Auto-mapping complete!\n\nMapped: ${mapped}\nFailed: ${failed}`);
        
      } catch (error) {
        hideLoadingIndicator();
        alert(`‚ùå Error during auto-mapping: ${error.message}`);
      }
    }

    function showLoadingIndicator(message) {
      let indicator = document.getElementById('loadingIndicator');
      if (!indicator) {
        indicator = document.createElement('div');
        indicator.id = 'loadingIndicator';
        indicator.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
          color: white;
          font-size: 18px;
          font-weight: 600;
        `;
        document.body.appendChild(indicator);
      }
      indicator.innerHTML = `
        <div style="text-align: center;">
          <div style="font-size: 48px; margin-bottom: 16px;">‚ö°</div>
          <div>${message}</div>
        </div>
      `;
      indicator.style.display = 'flex';
    }

    function hideLoadingIndicator() {
      const indicator = document.getElementById('loadingIndicator');
      if (indicator) {
        indicator.style.display = 'none';
      }
    }

    // ==========================================
    // TEAM DATA
    // ==========================================
    console.log('=== TeamCoach Pro Script Loading ===');
    console.log('Script started successfully');
    
    // Data Structure
    let teamMembers = [
      {
        id: 1,
        name: "Sarah Chen",
        email: "sarah.chen@company.com", // Used for Salesforce mapping
        salesforceUserId: null, // Will be populated when mapped to SF user
        readiness: "R2",
        competence: 4,
        commitment: 7,
        personality: "Peacock",
        personalitySecondary: "Dolphin",
        careerStage: "Mid-Career",
        workStyle: "Collaborative",
        communicationStyle: "Socializer",
        perfStatus: "at-risk",
        focusArea: "Enterprise deals",
        next1on1: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000),
        lastContact: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000),
        personalNotes: "Recently returned from parental leave, adjusting to new territory structure",
        careerGoals: "Move into team lead role within 18 months",
        motivators: "Recognition, team collaboration, career progression",
        demotivators: "Micromanagement, isolation, unclear expectations",
        conversations: [],
        actions: [
          { id: 1, text: "Shadow 2 enterprise deals with Tom", due: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000), completed: false },
          { id: 2, text: "Complete MEDDICC training module", due: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), completed: false }
        ],
        sessions1on1: {
          'session-1733932800000': {
            date: new Date('2024-10-14').toISOString(),
            dateFormatted: 'October 14, 2024',
            created: new Date('2024-10-14').toISOString(),
            monthlyGoal: { 
              target: 250000, 
              current: 75000,
              opportunitiesCreated: 8,
              dealsToNegotiate: 2,
              revenueClosed: 75000
            },
            weeklyTargets: [
              { id: 1697890001, text: '7 new meetings booked', status: 'completed' },
              { id: 1697890002, text: '3 new prospect meetings', status: 'completed' },
              { id: 1697890003, text: 'Complete MEDDICC framework training', status: 'completed' },
              { id: 1697890004, text: 'Update CRM with Q4 opportunities', status: 'failed' },
              { id: 1697890005, text: 'Practice executive presentation with Marcus', status: 'completed' }
            ],
            actionPlan: [
              { 
                id: 1697890101, 
                milestone: 'Complete MEDDICC certification course', 
                owner: 'Sarah Chen', 
                due: '2024-10-28',
                evidence: 'Certificate and framework applied to top 3 deals',
                status: 'completed'
              },
              { 
                id: 1697890102, 
                milestone: 'Shadow Marcus on 2 enterprise discovery calls', 
                owner: 'Sarah Chen', 
                due: '2024-10-21',
                evidence: 'Debrief notes and learnings documented',
                status: 'completed'
              },
              { 
                id: 1697890103, 
                milestone: 'Build territory account plan for top 20 accounts', 
                owner: 'Sarah Chen', 
                due: '2024-10-31',
                evidence: 'Strategic account plan reviewed with manager',
                status: 'in-progress'
              }
            ],
            notes: 'Great start to Q4. Sarah is enthusiastic and eager to learn. Completed MEDDICC training ahead of schedule. Confidence building as she applies frameworks to real deals. Still struggling with executive presence - working on this through shadowing. Territory plan is taking shape but needs more focus on enterprise accounts. Overall positive momentum.'
          },
          'session-1734537600000': {
            date: new Date('2024-10-28').toISOString(),
            dateFormatted: 'October 28, 2024',
            created: new Date('2024-10-28').toISOString(),
            monthlyGoal: { 
              target: 250000, 
              current: 125000,
              opportunitiesCreated: 12,
              dealsToNegotiate: 3,
              revenueClosed: 125000
            },
            weeklyTargets: [
              { id: 1698890001, text: '7 new meetings booked', status: 'completed' },
              { id: 1698890002, text: '3 new prospect meetings', status: 'paused' },
              { id: 1698890003, text: 'Move Acme Corp to negotiation stage', status: 'completed' },
              { id: 1698890004, text: 'Close TechStart deal ($45K)', status: 'completed' },
              { id: 1698890005, text: 'Present territory plan to leadership', status: 'completed' }
            ],
            actionPlan: [
              { 
                id: 1698890101, 
                milestone: 'Close Acme Corp deal by Nov 15', 
                owner: 'Sarah Chen', 
                due: '2024-11-15',
                evidence: 'Signed contract, $65K ARR',
                status: 'in-progress'
              },
              { 
                id: 1698890102, 
                milestone: 'Schedule C-level meetings at top 5 enterprise targets', 
                owner: 'Sarah Chen', 
                due: '2024-11-08',
                evidence: 'Calendar invites confirmed with execs',
                status: 'in-progress'
              },
              { 
                id: 1698890103, 
                milestone: 'Prepare negotiation strategy for 3 Q4 deals', 
                owner: 'Sarah Chen', 
                due: '2024-11-05',
                evidence: 'Negotiation playbook completed and reviewed',
                status: 'open'
              },
              { 
                id: 1698890104, 
                milestone: 'Build business case template for enterprise deals', 
                owner: 'Sarah Chen', 
                due: '2024-11-12',
                evidence: 'ROI calculator and template approved',
                status: 'open'
              }
            ],
            notes: 'Excellent progress! Sarah closed her first significant deal this quarter ($45K TechStart). She applied MEDDICC framework beautifully and it showed in her qualification and closing. Moving Acme Corp to negotiation is a big win. Still need to work on prospecting cadence - only 2 new prospect meetings vs target of 3. Territory plan presentation went well with leadership. Focus for next 2 weeks: get Acme over the line and build pipeline for Q1.'
          },
          'session-1735142400000': {
            date: new Date('2024-11-11').toISOString(),
            dateFormatted: 'November 11, 2024',
            created: new Date('2024-11-11').toISOString(),
            monthlyGoal: { 
              target: 250000, 
              current: 165000,
              opportunitiesCreated: 15,
              dealsToNegotiate: 5,
              revenueClosed: 165000
            },
            weeklyTargets: [
              { id: 1699890001, text: '7 new meetings booked', status: 'failed' },
              { id: 1699890002, text: '3 new prospect meetings', status: 'completed' },
              { id: 1699890003, text: 'Close Acme Corp deal', status: 'paused' },
              { id: 1699890004, text: 'Get legal approval on DataFlow contract', status: 'completed' },
              { id: 1699890005, text: 'Prep for Enterprise Solutions demo (3 stakeholders)', status: 'completed' }
            ],
            actionPlan: [
              { 
                id: 1699890101, 
                milestone: 'Resolve Acme Corp legal redlines and close by Nov 22', 
                owner: 'Sarah Chen', 
                due: '2024-11-22',
                evidence: 'Signed MSA and first PO',
                status: 'blocked'
              },
              { 
                id: 1699890102, 
                milestone: 'Close DataFlow deal ($55K) by Nov 18', 
                owner: 'Sarah Chen', 
                due: '2024-11-18',
                evidence: 'Signed contract and payment received',
                status: 'in-progress'
              },
              { 
                id: 1699890103, 
                milestone: 'Restart prospecting cadence - 10 calls/day', 
                owner: 'Sarah Chen', 
                due: '2024-11-25',
                evidence: 'Daily call log showing 50+ calls per week',
                status: 'open'
              },
              { 
                id: 1699890104, 
                milestone: 'Shadow David on technical deep-dive call', 
                owner: 'Sarah Chen', 
                due: '2024-11-20',
                evidence: 'Debrief document with key learnings',
                status: 'open'
              }
            ],
            notes: 'Mixed week. Acme deal hit unexpected legal snag - their procurement added new security requirements. Sarah handled it professionally but frustrated by delay. Good news: DataFlow moving quickly and should close next week. Bad news: prospecting dropped off - only 4 new meetings vs 7 target. Sarah admitted she got focused on closing existing deals and neglected top of funnel. Had coaching conversation about pipeline balance. She committed to blocking 2 hours daily for prospecting. Overall still tracking to quota but need to rebuild Q1 pipeline NOW.'
          },
          'session-1735747200000': {
            date: new Date('2024-11-25').toISOString(),
            dateFormatted: 'November 25, 2024',
            created: new Date('2024-11-25').toISOString(),
            monthlyGoal: { 
              target: 250000, 
              current: 220000,
              opportunitiesCreated: 18,
              dealsToNegotiate: 4,
              revenueClosed: 220000
            },
            weeklyTargets: [
              { id: 1700890001, text: '7 new meetings booked', status: 'completed' },
              { id: 1700890002, text: '3 new prospect meetings', status: 'completed' },
              { id: 1700890003, text: 'Close DataFlow deal ($55K)', status: 'completed' },
              { id: 1700890004, text: 'Get Acme unblocked - legal call scheduled', status: 'completed' },
              { id: 1700890005, text: 'Build Q1 pipeline plan', status: 'completed' }
            ],
            actionPlan: [
              { 
                id: 1700890101, 
                milestone: 'Close Acme Corp by Dec 6 (revised timeline)', 
                owner: 'Sarah Chen', 
                due: '2024-12-06',
                evidence: 'Executed contract, $65K ARR booked',
                status: 'in-progress'
              },
              { 
                id: 1700890102, 
                milestone: 'Generate 5 new qualified opportunities for Q1', 
                owner: 'Sarah Chen', 
                due: '2024-12-13',
                evidence: 'Discovery calls completed, MEDDICC scored >7',
                status: 'in-progress'
              },
              { 
                id: 1700890103, 
                milestone: 'Complete negotiation training with Marcus', 
                owner: 'Sarah Chen', 
                due: '2024-12-10',
                evidence: 'Role-play sessions and feedback incorporated',
                status: 'open'
              },
              { 
                id: 1700890104, 
                milestone: 'Attend Enterprise Selling workshop (Dec 3-4)', 
                owner: 'Sarah Chen', 
                due: '2024-12-04',
                evidence: 'Attendance confirmation and key takeaways documented',
                status: 'open'
              }
            ],
            notes: 'HUGE win - DataFlow closed! $55K deal, Sarah crushed the negotiation. She used everything from training and it showed. Acme is unblocked, legal call went well, should close next week. Most importantly: prospecting is BACK. Sarah hit all activity targets this week - 8 new meetings, 4 new prospects. She said blocking time on calendar made all the difference. Also loved her Q1 pipeline plan - identified 12 target accounts with research and outreach strategy for each. Confidence is way up. If Acme closes, she hits 88% of Q4 quota which is excellent given parental leave. Momentum is strong heading into December.'
          },
          'session-1736352000000': {
            date: new Date('2024-12-09').toISOString(),
            dateFormatted: 'December 9, 2024',
            created: new Date('2024-12-09').toISOString(),
            monthlyGoal: { 
              target: 250000, 
              current: 285000,
              opportunitiesCreated: 22,
              dealsToNegotiate: 6,
              revenueClosed: 285000
            },
            weeklyTargets: [
              { id: 1701890001, text: '7 new meetings booked', status: 'completed' },
              { id: 1701890002, text: '3 new prospect meetings', status: 'completed' },
              { id: 1701890003, text: 'Close Acme Corp ($65K)', status: 'completed' },
              { id: 1701890004, text: 'Move 2 deals to negotiation stage', status: 'completed' },
              { id: 1701890005, text: 'Complete year-end pipeline review', status: 'completed' }
            ],
            actionPlan: [
              { 
                id: 1701890101, 
                milestone: 'Build Q1 success plan with stretch goals', 
                owner: 'Sarah Chen', 
                due: '2024-12-20',
                evidence: 'Q1 account plan, activity targets, skills to develop',
                status: 'open'
              },
              { 
                id: 1701890102, 
                milestone: 'Close year-end pull-forward deals (2 opportunities)', 
                owner: 'Sarah Chen', 
                due: '2024-12-20',
                evidence: 'Contracts signed before Dec 31',
                status: 'in-progress'
              },
              { 
                id: 1701890103, 
                milestone: 'Schedule Q1 executive briefings (3 accounts)', 
                owner: 'Sarah Chen', 
                due: '2024-01-10',
                evidence: 'Calendar holds with VP+ level contacts',
                status: 'open'
              },
              { 
                id: 1701890104, 
                milestone: 'Complete Presidents Club application', 
                owner: 'Sarah Chen', 
                due: '2024-12-31',
                evidence: 'Application submitted with Q4 results',
                status: 'open'
              }
            ],
            notes: 'ACME CLOSED! $65K - Sarah is ecstatic and rightfully so. Total Q4: $285K = 114% of quota!! Absolutely crushing it. This is a complete turnaround from early October. The MEDDICC training paid off big time. Her discovery calls are sharper, qualification is stronger, and she navigates negotiations with confidence. Enterprise Selling workshop was excellent - came back energized with new strategies. Pipeline health is best I have seen: 22 total opps created this quarter, 6 in active negotiation, strong Q1 foundation with $450K+ pipeline already. Discussed Presidents Club - she is likely in! Also had career conversation - she wants team lead role. Agreed to create development plan focused on leadership skills, mentoring Jessica, and leading team project in Q1. This is the Sarah I hired - she is back and better than ever. Parental leave transition complete. Ready to make Q1 her best quarter yet.'
          }
        },
        currentSessionId: 'session-1736352000000',
        devPlan: {
          skills: [
            { name: "Enterprise Selling", current: 45, target: 80 },
            { name: "Executive Presence", current: 60, target: 85 },
            { name: "Negotiation", current: 50, target: 75 }
          ],
          activities: [
            { type: "training", desc: "MEDDICC Certification", target: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), status: "in-progress" },
            { type: "shadowing", desc: "Shadow 3 enterprise deals with Tom", target: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000), status: "planned" }
          ]
        },
        alerts: [
          { type: "overdue", message: "Action item overdue: Shadow enterprise deals" },
          { type: "performance", message: "Q4 tracking 15% below target" }
        ]
      },
      {
        id: 2,
        name: "Marcus Johnson",
        readiness: "R3",
        competence: 8,
        commitment: 6,
        personality: "Panther",
        personalitySecondary: "Owl",
        careerStage: "Established",
        workStyle: "Independent",
        communicationStyle: "Director",
        perfStatus: "on-track",
        focusArea: "Closing velocity",
        next1on1: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
        lastContact: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),
        personalNotes: "Very results-driven, prefers autonomy, responds well to data",
        careerGoals: "Consistently hit Presidents Club, potentially move to strategic accounts",
        motivators: "Competition, autonomy, clear metrics",
        demotivators: "Excessive process, hand-holding, unclear priorities",
        conversations: [],
        actions: [],
        sessions1on1: {},
        currentSessionId: null,
        devPlan: {
          activities: [
            { type: "project", desc: "Lead Q1 Enterprise Strategic Account Plan", target: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000), status: "in-progress" }
          ]
        },
        alerts: []
      },
      {
        id: 3,
        name: "Emily Rodriguez",
        readiness: "R1",
        competence: 3,
        commitment: 8,
        personality: "Owl",
        personalitySecondary: "Dolphin",
        careerStage: "Early Career",
        workStyle: "Independent",
        communicationStyle: "Thinker",
        perfStatus: "on-track",
        focusArea: "Discovery fundamentals",
        next1on1: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000),
        lastContact: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000),
        personalNotes: "Analytically strong, sometimes overthinks, needs encouragement to act",
        careerGoals: "Build foundation in consultative selling, achieve quota consistently",
        motivators: "Learning, structure, clear frameworks",
        demotivators: "Ambiguity, being put on the spot, rushed decisions",
        conversations: [],
        actions: [],
        sessions1on1: {},
        currentSessionId: null,
        devPlan: {
          activities: [
            { type: "training", desc: "Complete Sales Foundations Course", target: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), status: "in-progress" },
            { type: "shadowing", desc: "Shadow 5 discovery calls with David", target: new Date(Date.now() + 21 * 24 * 60 * 60 * 1000), status: "planned" },
            { type: "reading", desc: "Read Challenger Sale", target: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000), status: "planned" }
          ]
        },
        alerts: [
          { type: "reminder", message: "1:1 tomorrow - prepare ramp plan review" }
        ]
      },
      {
        id: 4,
        name: "David Park",
        readiness: "R4",
        competence: 9,
        commitment: 9,
        personality: "Dolphin",
        personalitySecondary: "Peacock",
        careerStage: "Late Career",
        workStyle: "Collaborative",
        communicationStyle: "Relater",
        perfStatus: "exceeding",
        focusArea: "Mentoring others",
        next1on1: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000),
        lastContact: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000),
        personalNotes: "Top performer, natural mentor, values relationships over transactions",
        careerGoals: "Continue excellence, support team development, maintain work-life balance",
        motivators: "Helping others, relationships, stability",
        demotivators: "Conflict, aggressive tactics, cutting corners",
        conversations: [],
        actions: [],
        sessions1on1: {},
        currentSessionId: null,
        devPlan: {
          activities: [
            { type: "mentoring", desc: "Mentor Emily and 2 new hires", target: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), status: "in-progress" },
            { type: "training", desc: "Leadership Foundations Course", target: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000), status: "planned" }
          ]
        },
        alerts: []
      },
      {
        id: 5,
        name: "Jessica Martinez",
        readiness: "R2",
        competence: 5,
        commitment: 8,
        personality: "Peacock",
        personalitySecondary: "Owl",
        careerStage: "Early Career",
        workStyle: "Collaborative",
        communicationStyle: "Socializer",
        perfStatus: "on-track",
        focusArea: "Building pipeline consistency",
        next1on1: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000),
        lastContact: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000),
        personalNotes: "Strong at relationship building, needs structure. Came from hospitality, loves people but new to B2B",
        careerGoals: "Make Presidents Club within 2 years, eventually move to channel sales",
        motivators: "Recognition, helping customers, team wins",
        demotivators: "Rejection, working alone, ambiguous expectations",
        conversations: [],
        actions: [
          { id: 1, text: "Practice SPIN questioning with Marcus", due: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000), completed: false },
          { id: 2, text: "Schedule 15 prospecting calls per day", due: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000), completed: false }
        ],
        sessions1on1: {},
        currentSessionId: null,
        devPlan: {
          skills: [
            { name: "Prospecting", current: 55, target: 75 },
            { name: "Discovery Skills", current: 40, target: 70 },
            { name: "Pipeline Management", current: 35, target: 65 }
          ],
          activities: [
            { type: "training", desc: "Complete SPIN Selling Course", target: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000), status: "in-progress" },
            { type: "shadowing", desc: "Shadow Marcus on 5 cold calls", target: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), status: "planned" }
          ]
        },
        alerts: [
          { type: "reminder", message: "Q4 ramp target: 75% of quota" }
        ]
      },
      {
        id: 6,
        name: "Kevin O'Brien",
        readiness: "R3",
        competence: 7,
        commitment: 5,
        personality: "Panther",
        personalitySecondary: "Owl",
        careerStage: "Mid-Career",
        workStyle: "Independent",
        communicationStyle: "Director",
        perfStatus: "at-risk",
        focusArea: "Re-engaging with process",
        next1on1: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000),
        lastContact: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000),
        personalNotes: "Veteran rep, burned out, questioning sales career. Talented but disengaged. Going through divorce",
        careerGoals: "Undecided - considering leaving sales or moving to product/solutions engineering",
        motivators: "Autonomy, solving complex problems, working with smart people",
        demotivators: "Micromanagement, repetitive tasks, politics",
        conversations: [],
        actions: [
          { id: 1, text: "Explore internal transfer opportunities", due: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000), completed: false },
          { id: 2, text: "Complete 3 strategic account plans", due: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), completed: false }
        ],
        sessions1on1: {},
        currentSessionId: null,
        devPlan: {
          skills: [
            { name: "Strategic Account Planning", current: 80, target: 90 },
            { name: "Solution Selling", current: 75, target: 85 }
          ],
          activities: [
            { type: "project", desc: "Lead technical win plan for Fortune 500 prospect", target: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), status: "planned" }
          ]
        },
        alerts: [
          { type: "performance", message: "Engagement concerns - missed last two team meetings" },
          { type: "overdue", message: "Strategic account plans overdue by 2 days" }
        ]
      },
      {
        id: 7,
        name: "Priya Patel",
        readiness: "R1",
        competence: 2,
        commitment: 9,
        personality: "Owl",
        personalitySecondary: "Dolphin",
        careerStage: "Early Career",
        workStyle: "Independent",
        communicationStyle: "Thinker",
        perfStatus: "on-track",
        focusArea: "Sales fundamentals and confidence",
        next1on1: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000),
        lastContact: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000),
        personalNotes: "Fresh MBA grad, brilliant analytical mind, zero sales experience. Overthinks everything, needs confidence building",
        careerGoals: "Become enterprise AE, eventually VP of Sales",
        motivators: "Learning, mastery, clear metrics, intellectual challenge",
        demotivators: "Ambiguity, feeling unprepared, making mistakes publicly",
        conversations: [],
        actions: [
          { id: 1, text: "Complete first 10 discovery calls", due: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), completed: false },
          { id: 2, text: "Memorize product positioning deck", due: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000), completed: false },
          { id: 3, text: "Role-play objection handling with Emily", due: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000), completed: false }
        ],
        sessions1on1: {},
        currentSessionId: null,
        devPlan: {
          skills: [
            { name: "Discovery Skills", current: 20, target: 60 },
            { name: "Product Knowledge", current: 45, target: 80 },
            { name: "Objection Handling", current: 15, target: 55 },
            { name: "Presentation Skills", current: 30, target: 65 }
          ],
          activities: [
            { type: "training", desc: "Complete Sales Bootcamp", target: new Date(Date.now() + 21 * 24 * 60 * 60 * 1000), status: "in-progress" },
            { type: "shadowing", desc: "Shadow 20 calls across different reps", target: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000), status: "in-progress" },
            { type: "reading", desc: "Read SPIN Selling", target: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000), status: "planned" }
          ]
        },
        alerts: [
          { type: "reminder", message: "Week 3 of onboarding - first live calls scheduled" }
        ]
      },
      {
        id: 8,
        name: "James Thompson",
        readiness: "R4",
        competence: 9,
        commitment: 7,
        personality: "Dolphin",
        personalitySecondary: "Owl",
        careerStage: "Late Career",
        workStyle: "Hybrid",
        communicationStyle: "Relater",
        perfStatus: "exceeding",
        focusArea: "Strategic accounts and mentoring",
        next1on1: new Date(Date.now() + 21 * 24 * 60 * 60 * 1000),
        lastContact: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000),
        personalNotes: "20 year veteran, technical background, amazing with engineers. Quiet leader, doesn't need much attention",
        careerGoals: "Maintain performance, develop next-gen talent, semi-retirement in 5 years",
        motivators: "Complex technical sales, mentoring others, flexible schedule",
        demotivators: "Drama, administrative overhead, unnecessary meetings",
        conversations: [],
        actions: [],
        sessions1on1: {},
        currentSessionId: null,
        devPlan: {
          skills: [
            { name: "Coaching & Mentoring", current: 65, target: 85 },
            { name: "Technical Acumen", current: 95, target: 95 }
          ],
          activities: [
            { type: "mentoring", desc: "Mentor Priya through first quarter", target: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), status: "in-progress" }
          ]
        },
        alerts: []
      },
      {
        id: 9,
        name: "Alicia Washington",
        readiness: "R3",
        competence: 7,
        commitment: 8,
        personality: "Panther",
        personalitySecondary: "Peacock",
        careerStage: "Mid-Career",
        workStyle: "Independent",
        communicationStyle: "Director",
        perfStatus: "exceeding",
        focusArea: "Leadership pipeline development",
        next1on1: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000),
        lastContact: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000),
        personalNotes: "High performer with clear leadership aspirations. Competitive, direct, gets results. Ready for bigger role",
        careerGoals: "Sales manager within 12 months, VP of Sales within 5 years",
        motivators: "Promotion, competition, impact, building something",
        demotivators: "Being held back, unclear career path, busy work",
        conversations: [],
        actions: [
          { id: 1, text: "Lead Q1 SKO breakout session", due: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), completed: false },
          { id: 2, text: "Complete leadership assessment", due: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), completed: false },
          { id: 3, text: "Mentor Jessica on negotiation tactics", due: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000), completed: false }
        ],
        sessions1on1: {},
        currentSessionId: null,
        devPlan: {
          skills: [
            { name: "Leadership", current: 65, target: 85 },
            { name: "Coaching & Mentoring", current: 55, target: 80 },
            { name: "Strategic Account Planning", current: 75, target: 90 },
            { name: "Executive Presence", current: 80, target: 95 }
          ],
          activities: [
            { type: "project", desc: "Lead new rep onboarding program redesign", target: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000), status: "in-progress" },
            { type: "mentoring", desc: "Formally mentor Jessica", target: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), status: "in-progress" },
            { type: "training", desc: "Manager Development Program", target: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000), status: "planned" }
          ]
        },
        alerts: [
          { type: "reminder", message: "Leadership discussion - promotion timing" }
        ]
      }
    ];

    let currentMember = null;
    let currentConversationActions = [];

    // Coaching Scenario Library
    const coachingScenarios = [
      {
        id: 1,
        title: "Giving Critical Feedback (SBI Model)",
        profiles: ["R2", "Peacock"],
        situation: "Team member missed quota two quarters in a row",
        approach: "Use SBI model: State the Situation, describe the Behavior, explain the Impact. Then involve them in the solution. Peacocks need positives first and collaborative problem-solving.",
        script: [
          "SITUATION: 'I want to discuss your Q3 and Q4 performance. Let's look at the numbers together.' (Set context)",
          "BEHAVIOR: 'Your close rate dropped from 28% to 18%, and you've missed quota both quarters.' (Specific, observable facts)",
          "IMPACT: 'This affects the team's overall number and your path to Presidents Club. More importantly, I'm concerned about your confidence.' (Explain consequences)",
          "INVOLVE: 'What do you think is contributing to this pattern?' (Get their perspective)",
          "COLLABORATE: 'Let's create a plan together. I'm thinking we focus on discovery depth and qualification criteria using MEDDICC.' (Joint solution)",
          "COMMIT: 'Can you commit to implementing MEDDICC on your next 5 opportunities, and we'll review together weekly?'"
        ],
        followUp: "Schedule weekly 30-min deal coaching sessions for next month, celebrate small wins loudly, provide MEDDICC resources"
      },
      {
        id: 2,
        title: "Giving Critical Feedback (SBI Model)",
        profiles: ["R2", "Owl"],
        situation: "Team member missed quota two quarters in a row",
        approach: "Use SBI model with data-driven approach. Owls respond well to frameworks and analytical problem-solving.",
        script: [
          "SITUATION: 'I've analyzed your pipeline metrics from Q3 and Q4. Let's review them together.' (Data-driven context)",
          "BEHAVIOR: 'Your conversion rate dropped 10 points, from 28% to 18%. Your average deal size remained stable, but velocity slowed 20%.' (Specific metrics)",
          "IMPACT: 'You missed quota both quarters, which puts your annual number at risk. The pattern suggests a systematic issue we need to solve.' (Logical consequences)",
          "ANALYZE: 'What patterns do you see in the deals that didn't close versus those that did?' (Engage analytical thinking)",
          "FRAMEWORK: 'I think we need a more structured qualification framework. Here's MEDDICC - it provides the systematic approach you need.' (Provide structure)",
          "ACTION: 'Would you create a qualification checklist for your top 10 opps using this framework, and we review Monday?'"
        ],
        followUp: "Send MEDDICC resources, schedule metrics review in 1 week, provide written framework documentation"
      },
      {
        id: 3,
        title: "Giving Critical Feedback (SBI Model)",
        profiles: ["R2", "Panther"],
        situation: "Team member missed quota two quarters in a row",
        approach: "Use SBI model but be direct and challenge-oriented. Panthers respect directness and respond to competitive framing.",
        script: [
          "SITUATION: 'You missed target two quarters. That's not your standard. Let's talk about it.' (Direct, no fluff)",
          "BEHAVIOR: 'Close rate dropped 10 points. Pipeline velocity down 20%. These are the facts.' (Blunt data)",
          "IMPACT: 'You're off track for annual quota. More importantly, you're better than this performance shows.' (Challenge their pride)",
          "CHALLENGE: 'Sarah closed 3 enterprise deals last quarter. You're more talented than that - so what's going on?' (Competitive spark)",
          "CLEAR STAKES: 'Here's what needs to happen: 30% improvement in Q1 or we need to have a different conversation.' (Direct consequences)",
          "THEIR PLAN: 'You're smart. You know what's wrong. What's your plan to fix it?'"
        ],
        followUp: "Weekly numbers review, hold them accountable, remove obstacles, let them own the solution"
      },
      {
        id: 4,
        title: "Giving Critical Feedback (SBI Model)",
        profiles: ["R2", "Dolphin"],
        situation: "Team member missed quota two quarters in a row",
        approach: "Use SBI model with empathy and support. Dolphins need psychological safety while still being clear about performance issues.",
        script: [
          "SITUATION: 'I wanted to check in with you. I've noticed you missed quota the last two quarters.' (Caring opener)",
          "BEHAVIOR: 'Your close rate has dropped, and your pipeline velocity has slowed. These are unusual patterns for you.' (Gentle facts)",
          "IMPACT: 'I'm concerned because this affects your commission and your standing. More importantly, I can tell this is weighing on you.' (Empathy for them)",
          "UNDERSTAND: 'What's been challenging? Are there things outside of work affecting you that I should know about?' (Create safety)",
          "SUPPORT: 'Your skills are strong - your clients love you. Let's figure out what's blocking your success and remove it together.' (Reassurance)",
          "COLLABORATE: 'How can I help? Should we look at your accounts together? Adjust territory? What support do you need?'"
        ],
        followUp: "Check in frequently, provide emotional support, ensure they feel valued, adjust pressure if personal issues present"
      },
      {
        id: 5,
        title: "Coaching on Lost Deal (GROW Model)",
        profiles: ["R1", "Owl"],
        situation: "First major deal loss, rep is discouraged",
        approach: "Use GROW model to turn loss into learning. Owls need analytical debriefs and structured frameworks to build confidence.",
        script: [
          "GOAL: 'Let's debrief this deal. Our goal is to extract 3-5 lessons you can apply to the next opportunity. Sound good?' (Set learning objective)",
          "REALITY: 'Walk me through the buying process from their perspective. What signals did we see at each stage?' (Explore what happened)",
          "REALITY: 'Where did we have strong evidence they would buy? Where were the red flags we might have missed?' (Analytical review)",
          "OPTIONS: 'Knowing what you know now, what could we have done differently? What are 3-4 alternative approaches?' (Generate solutions)",
          "OPTIONS: 'I see three key areas: earlier executive engagement, tighter ROI case, and stronger champion cultivation. Which resonates most?' (Provide framework)",
          "WILL: 'Your discovery was excellent. Keep doing that. On your next opportunity, which of these will you implement first?'"
        ],
        followUp: "Provide deal framework checklist, shadow next discovery call, send positive reinforcement email"
      },
      {
        id: 6,
        title: "Coaching on Lost Deal",
        profiles: ["R3", "Panther"],
        situation: "Lost major deal to competitor",
        approach: "Quick tactical debrief, extract competitive intel, redirect energy to winning. Panthers don't want to dwell on losses.",
        script: [
          "REALITY: 'That one stung. What happened? Give me the quick version.' (Direct, fast)",
          "REALITY: 'What did the competitor do that we didn't? Price? Feature? Relationship? I need intel.' (Extract learnings)",
          "OPTIONS: 'Alright, we learn and move on. What's your next big opportunity? Let's win that one.' (Redirect focus)",
          "OPTIONS: 'Use this. You now know their playbook. How do you beat them next time?' (Competitive advantage)",
          "WILL: 'I know you don't lose often. Go make this one sting for them. What's your plan?'"
        ],
        followUp: "Provide competitive battle card, get them back in the field immediately, celebrate next win"
      },
      {
        id: 7,
        title: "Career Development (GROW Model)",
        profiles: ["R3", "Peacock"],
        situation: "Rep wants to move into leadership",
        approach: "Use GROW model to create structured development path. Channel their energy into concrete milestones.",
        script: [
          "GOAL: 'I love your ambition. Let's talk about your path to leadership. What does that look like to you - timeline, role, responsibilities?' (Clarify aspiration)",
          "REALITY: 'You're a strong performer. Leadership means shifting from doing to enabling others to do. How do you feel about that transition?' (Test readiness)",
          "REALITY: 'Currently, leaders here consistently hit 110%+ quota, successfully mentor 2+ people, and lead team projects. Where are you on each?' (Assess current state)",
          "OPTIONS: 'Here's what I need to see: consistent quota attainment, two successful mentees showing measurable improvement, and leadership on a team initiative. What else should we add?' (Co-create criteria)",
          "OPTIONS: 'I can give you a mentee next quarter and a team project. Or would you prefer to nail quota first, then add responsibilities?' (Explore paths)",
          "WILL: 'So you'll take on mentoring Sarah and leading the Q2 team kickoff project. If you crush these, I'll advocate for you when the next role opens. Deal?'"
        ],
        followUp: "Assign mentee, provide leadership resources, monthly check-ins on progress toward criteria"
      },
      {
        id: 8,
        title: "Handling Personal Issue Affecting Work",
        profiles: ["R2", "Dolphin"],
        situation: "Performance drop due to personal circumstances",
        approach: "Lead with empathy, create psychological safety, adjust expectations temporarily while maintaining dignity.",
        script: [
          "SITUATION: 'I noticed your performance has changed. More importantly, you seem different. Are you okay?' (Care first, not performance)",
          "REALITY: 'I want you to know this is a safe space. What's going on? No judgment, just support.' (Create safety)",
          "[After they share] 'Thank you for trusting me. That's a lot to carry. I'm glad you told me.' (Validate vulnerability)",
          "OPTIONS: 'How can I support you? We could adjust your targets temporarily, shift your accounts, or just give you space. What would help most?' (Empower them)",
          "WILL: 'Let's reduce your target by 20% for this quarter while you handle this. Your job is safe, your career is safe. Just focus on what you need to.' (Remove pressure)",
          "WILL: 'Check in with me weekly, even if it's just to say you're managing. You're not alone in this.'"
        ],
        followUp: "Provide EAP resources if available, frequent low-pressure check-ins, protect their dignity on the team"
      },
      {
        id: 9,
        title: "Addressing Skill Gap (SBI + GROW)",
        profiles: ["R1", "Panther"],
        situation: "New rep struggling with discovery, rushing to pitch",
        approach: "Use SBI to identify the behavior problem, then GROW to build the skill. Frame discovery as competitive weapon for Panthers.",
        script: [
          "SITUATION: 'Let's debrief your last few calls. I want to help you get more wins.' (Context)",
          "BEHAVIOR: 'I listened to three calls. You pitched in the first 5 minutes on each one. That's a pattern.' (Specific observation)",
          "IMPACT: 'When you pitch too early, you don't know their pain. You're guessing. That's why deals stall.' (Explain consequence)",
          "GOAL: 'Discovery is your competitive weapon. Master this and you'll close 2x faster. Want to learn it?' (Reframe as advantage)",
          "REALITY: 'Right now, you're pitching at minute 5. Top performers don't pitch until minute 15-20. That's the gap.' (Current state)",
          "OPTIONS: 'Here's the play: next 10 calls, no pitch until 15 minutes in. Just questions. Can you do that?' (Clear challenge)",
          "WILL: 'I'm going to listen to every call and coach you. This is the skill that will make you elite. Two weeks of discipline and you'll see the difference.'"
        ],
        followUp: "Call reviews every 2 days, provide question framework, celebrate when they execute correctly"
      },
      {
        id: 10,
        title: "Motivating During Slump (GROW Model)",
        profiles: ["R3", "Peacock"],
        situation: "Normally high-energy rep seems deflated",
        approach: "Use GROW to re-ignite energy and create quick win opportunity. Peacocks need momentum and recognition.",
        script: [
          "REALITY: 'You're not yourself lately. What's up?' (Direct observation)",
          "REALITY: 'Remember when you closed that impossible deal with the CFO last year? That was pure you. What's different now?' (Anchor to success)",
          "GOAL: 'I think you need a win. Let's get you back on track. What would feel like a big win right now?' (Define target)",
          "OPTIONS: 'What's your best opportunity right now? The one you're most excited about?' (Find energy)",
          "OPTIONS: 'Let's go win that together. I'll join your next call, help with strategy, bring in whoever you need. What would help?' (Offer support)",
          "WILL: 'You're too good to stay in this slump. Let's remind everyone why you're here. What's your next move?'"
        ],
        followUp: "Get directly involved in their deals, provide hands-on support, celebrate small wins loudly and publicly"
      },
      {
        id: 11,
        title: "Celebrating a Big Win",
        profiles: ["R3", "Peacock"],
        situation: "Rep just closed their biggest deal of the year",
        approach: "Celebrate wins loudly and publicly for Peacocks. Use the moment to build confidence and set next challenge.",
        script: [
          "CELEBRATE: 'You did it! That was masterful - tell me how you closed them.' (Let them tell the story)",
          "RECOGNIZE: 'I'm making sure leadership knows about this. You made the company $500K and proved enterprise is your strength.' (Public recognition)",
          "REINFORCE: 'What you did with the CFO objection was exactly right. That's textbook negotiation.' (Specific praise)",
          "EXTRACT LEARNINGS: 'What was the turning point? When did you know they would buy?' (Capture success pattern)",
          "MOMENTUM: 'You're on fire. What's next? Let's ride this wave.' (Channel energy)",
          "CHALLENGE: 'You just proved you can close enterprise. I want you at 3 deals this size next quarter. Ready?'"
        ],
        followUp: "Send company-wide recognition email, share success in team meeting, assign bigger opportunities"
      },
      {
        id: 12,
        title: "Skill Gap Discussion",
        profiles: ["R1", "Panther"],
        situation: "New rep strong on activity but weak on discovery skills",
        approach: "Use SBI to identify gap, then GROW to build the skill. Panthers want direct feedback and clear path to improvement.",
        script: [
          "SITUATION: 'You're crushing activity - 50 calls a week. That's elite work ethic.' (Acknowledge strength)",
          "BEHAVIOR: 'But you're booking demos at 2%. The team average is 8%. That tells me discovery needs work.' (State the gap)",
          "IMPACT: 'You're working hard but not efficiently. You're burning leads that could close.' (Explain consequences)",
          "GOAL: 'Let's get your discovery to 8%+ in 30 days. That quintuples your pipeline. Sound good?' (Set target)",
          "OPTIONS: 'I can assign you to shadow David for a week, give you a discovery framework, or both. What do you prefer?' (Offer paths)",
          "WILL: 'Shadow David's next 10 calls. Take notes on his questions. Then we'll build your version together. Start tomorrow?'"
        ],
        followUp: "Arrange shadowing with top performer, provide discovery question framework, review their first 5 calls together"
      }
    ];

    // Initialize
    renderTeamGrid();
    renderScenarios();

    // Navigation
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        const view = this.dataset.view;
        
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
        document.getElementById(view).classList.add('active');

        // Render content for specific views
        if (view === 'development') {
          renderTeamDevelopment();
        } else if (view === 'settings') {
          renderMembersEditGrid();
        } else if (view === 'ai-assistant') {
          initializeAIAssistant();
        } else if (view === 'reports') {
          initializeReports();
        }
      });
    });

    // Render Team Grid
    function renderTeamGrid(filter = 'all', searchQuery = '') {
      const grid = document.getElementById('teamGrid');
      
      let filtered = teamMembers.filter(member => {
        const matchesSearch = member.name.toLowerCase().includes(searchQuery.toLowerCase());
        
        if (!matchesSearch) return false;
        
        if (filter === 'all') return true;
        if (filter === 'needs-attention') return member.perfStatus === 'at-risk' || member.perfStatus === 'struggling';
        if (filter === 'upcoming-1on1') {
          const daysUntil = Math.ceil((member.next1on1 - Date.now()) / (1000 * 60 * 60 * 24));
          return daysUntil <= 3;
        }
        if (filter === 'action-overdue') {
          return member.actions.some(a => !a.completed && a.due < Date.now());
        }
        
        return true;
      });

      if (filtered.length === 0) {
        grid.innerHTML = `
          <div class="empty-state" style="grid-column: 1/-1;">
            <div class="empty-icon">üîç</div>
            <div class="empty-text">No team members found</div>
            <div class="empty-hint">Try adjusting your filters</div>
          </div>
        `;
        return;
      }

      grid.innerHTML = filtered.map(member => {
        const daysUntil1on1 = Math.ceil((member.next1on1 - Date.now()) / (1000 * 60 * 60 * 24));
        const hasOverdueActions = member.actions.some(a => !a.completed && a.due < Date.now());
        const needsAttention = member.perfStatus === 'at-risk' || member.perfStatus === 'struggling' || hasOverdueActions;
        
        return `
          <div class="team-card ${needsAttention ? 'needs-attention' : 'on-track'}" onclick="openMemberModal(${member.id})">
            ${member.alerts.length > 0 ? `<div class="alert-badge">${member.alerts.length}</div>` : ''}
            
            <div class="member-name">${member.name}</div>
            
            <div class="member-tags">
              <span class="tag">${member.readiness}</span>
              <span class="tag">${member.personality}${member.personalitySecondary ? '/' + member.personalitySecondary : ''}</span>
              <span class="tag">${member.perfStatus.replace('-', ' ')}</span>
            </div>
            
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">
              <strong>Focus:</strong> ${member.focusArea}
            </div>
            
            <div class="next-action">
              <strong>Next 1:1:</strong> ${daysUntil1on1 === 0 ? 'Today' : daysUntil1on1 === 1 ? 'Tomorrow' : `in ${daysUntil1on1} days`}
            </div>
            
            ${hasOverdueActions ? '<div style="font-size: 12px; color: var(--accent-danger); margin-top: 8px;">‚ö†Ô∏è Overdue actions</div>' : ''}
          </div>
        `;
      }).join('');
    }

    // Filter functionality
    document.querySelectorAll('.filter-chip').forEach(chip => {
      chip.addEventListener('click', function() {
        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
        this.classList.add('active');
        
        const filter = this.dataset.filter;
        const searchQuery = document.getElementById('searchBox').value;
        renderTeamGrid(filter, searchQuery);
      });
    });

    document.getElementById('searchBox').addEventListener('input', function() {
      const activeFilter = document.querySelector('.filter-chip.active').dataset.filter;
      renderTeamGrid(activeFilter, this.value);
    });

    // Open Member Modal
    function openMemberModal(memberId) {
      console.log('openMemberModal called with ID:', memberId);
      
      currentMember = teamMembers.find(m => m.id === memberId);
      if (!currentMember) {
        console.error('Member not found:', memberId);
        return;
      }
      
      document.getElementById('modalMemberName').textContent = currentMember.name;
      
      // Switch to first tab
      document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelector('.modal-tab[data-tab="prep"]').classList.add('active');
      document.getElementById('tab-prep').classList.add('active');
      
      render1on1Prep();
      renderProfile();
      renderHistory();
      renderDevelopment();
      renderAlerts();
      
      // Update Salesforce connection status
      updateSalesforceConnectionStatus();
      updateLastSyncTime();
      
      document.getElementById('memberModal').classList.add('active');
    }

    function closeMemberModal() {
      document.getElementById('memberModal').classList.remove('active');
      currentMember = null;
    }

    // Modal Tab Switching
    document.querySelectorAll('.modal-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        const tabName = this.dataset.tab;
        
        document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');
      });
    });

    // Render 1:1 Prep
    function render1on1Prep() {
      if (!currentMember) return;
      
      // Initialize and render prep sessions
      try {
        renderPrepSessions();
      } catch (error) {
        console.error('Error rendering prep sessions:', error);
      }
      
      // Alerts
      const alertsHTML = currentMember.alerts.length > 0 ? 
        currentMember.alerts.map(alert => `
          <div class="alert-box">
            <div class="alert-title">${alert.type.toUpperCase()}</div>
            <div class="alert-content">${alert.message}</div>
          </div>
        `).join('') : '';
      
      document.getElementById('prepAlerts').innerHTML = alertsHTML;
      
      // Auto-Generated Agenda
      const agendaItems = [];
      
      // Performance check
      if (currentMember.perfStatus === 'at-risk' || currentMember.perfStatus === 'struggling') {
        agendaItems.push('üìä Performance review and support plan');
      }
      
      // Overdue actions
      const overdueActions = currentMember.actions.filter(a => !a.completed && a.due < Date.now());
      if (overdueActions.length > 0) {
        agendaItems.push(`‚ö†Ô∏è Follow up on ${overdueActions.length} overdue action item(s)`);
      }
      
      // Development
      if (currentMember.devPlan.activities.length > 0) {
        agendaItems.push('üéØ Development plan progress check');
      }
      
      // Standard items based on profile
      if (currentMember.readiness === 'R1') {
        agendaItems.push('üìö Learning check-in and ramp progress');
        agendaItems.push('‚ùì Questions and clarifications');
      } else if (currentMember.readiness === 'R2') {
        agendaItems.push('üéØ Focus area coaching: ' + currentMember.focusArea);
        agendaItems.push('üí™ Confidence building and support');
      } else if (currentMember.readiness === 'R3') {
        agendaItems.push('üöÄ Opportunity review and strategy');
        agendaItems.push('üìà Remove any blockers');
      } else {
        agendaItems.push('üåü Strategic initiatives and mentorship');
        agendaItems.push('üí° Ideas and feedback from the field');
      }
      
      // Career development
      if (currentMember.careerGoals) {
        agendaItems.push('üéØ Career development discussion');
      }
      
      document.getElementById('autoAgenda').innerHTML = `
        <ol style="padding-left: 20px; font-size: 14px; line-height: 2;">
          ${agendaItems.map(item => `<li>${item}</li>`).join('')}
        </ol>
      `;
      
      // Recommended Topics
      const topics = [];
      if (currentMember.perfStatus === 'at-risk') {
        topics.push({ icon: 'üéØ', text: 'Specific pipeline gaps and how to close them', priority: 'high' });
      }
      if (currentMember.personalNotes) {
        topics.push({ icon: 'üí≠', text: 'Check in on: ' + currentMember.personalNotes, priority: 'medium' });
      }
      topics.push({ icon: '‚ù§Ô∏è', text: 'What\'s energizing them right now?', priority: 'medium' });
      topics.push({ icon: 'üòü', text: 'What\'s frustrating them right now?', priority: 'medium' });
      
      document.getElementById('recommendedTopics').innerHTML = topics.map(t => `
        <div class="info-card">
          <div style="font-size: 18px; margin-bottom: 8px;">${t.icon}</div>
          <div class="info-card-content">${t.text}</div>
        </div>
      `).join('');
      
      // Profile-based Questions
      const questions = getProfileQuestions(currentMember.readiness, currentMember.personality);
      document.getElementById('profileQuestions').innerHTML = `
        <div class="coaching-box">
          <div class="coaching-box-title">Questions for ${currentMember.readiness}/${currentMember.personality}</div>
          <ul class="coaching-list">
            ${questions.map(q => `<li>${q}</li>`).join('')}
          </ul>
        </div>
      `;
      
      // Current actions now handled by Action Plan Table
      // renderCurrentActions();
    }

    function getProfileQuestions(readiness, personality) {
      const questions = [];
      
      // Readiness-based
      if (readiness === 'R1') {
        questions.push("What's been your biggest learning this week?");
        questions.push("What questions do you have that I haven't answered?");
        questions.push("What part of the role still feels unclear?");
      } else if (readiness === 'R2') {
        questions.push("What's working well right now?");
        questions.push("Where do you feel stuck?");
        questions.push("How can I better support you?");
      } else if (readiness === 'R3') {
        questions.push("What's your strategy on [biggest deal]?");
        questions.push("What obstacles can I remove?");
        questions.push("What are you learning from your deals?");
      } else {
        questions.push("What trends are you seeing in the market?");
        questions.push("How can you help develop others?");
        questions.push("What would you do differently if you were me?");
      }
      
      // Personality overlay
      if (personality === 'Owl') {
        questions.push("What data or patterns are you noticing?");
        questions.push("What framework would help you most right now?");
      } else if (personality === 'Panther') {
        questions.push("What's your biggest win this week?");
        questions.push("What's in your way of hitting your number?");
      } else if (personality === 'Peacock') {
        questions.push("How are your client relationships going?");
        questions.push("What recent success should we celebrate?");
      } else if (personality === 'Dolphin') {
        questions.push("How's the team dynamic feeling to you?");
        questions.push("Who needs help that I might not be seeing?");
      }
      
      return questions;
    }

    function renderCurrentActions() {
      // Legacy function - now using Action Plan Table instead
      const element = document.getElementById('currentActions');
      if (!element) return;
      
      if (!currentConversationActions.length) {
        element.innerHTML = '';
        return;
      }
      
      element.innerHTML = `
        <div class="subsection-title">Actions for this 1:1</div>
        ${currentConversationActions.map((a, idx) => `
          <div class="action-chip" style="display: block; margin-bottom: 8px;">
            ${a.text} - Due: ${new Date(a.due).toLocaleDateString()}
            <button onclick="removeCurrentAction(${idx})" style="margin-left: 8px; background: none; border: none; color: var(--accent-danger); cursor: pointer; font-weight: 700;">‚úï</button>
          </div>
        `).join('')}
      `;
    }

    function addAction() {
      const text = document.getElementById('newAction').value;
      const due = document.getElementById('actionDueDate').value;
      
      if (!text || !due) {
        alert('Please enter both action and due date');
        return;
      }
      
      currentConversationActions.push({
        text: text,
        due: new Date(due)
      });
      
      document.getElementById('newAction').value = '';
      document.getElementById('actionDueDate').value = '';
      
      renderCurrentActions();
    }

    function removeCurrentAction(idx) {
      currentConversationActions.splice(idx, 1);
      renderCurrentActions();
    }

    function save1on1() {
      if (!currentMember) return;
      
      const notes = document.getElementById('currentNotes').value;
      
      const conversation = {
        id: Date.now(),
        date: new Date(),
        type: '1:1',
        notes: notes,
        actions: [...currentConversationActions]
      };
      
      currentMember.conversations.push(conversation);
      currentMember.actions.push(...currentConversationActions.map(a => ({
        ...a,
        id: Date.now() + Math.random(),
        completed: false
      })));
      
      currentMember.lastContact = new Date();
      
      // Save to localStorage
      saveData();
      
      // Clear form
      document.getElementById('currentNotes').value = '';
      currentConversationActions = [];
      
      alert('‚úì 1:1 notes saved successfully!');
      
      renderHistory();
      renderTeamGrid();
    }

    function generateFollowupEmail() {
      if (!currentMember) return;
      
      const notes = document.getElementById('currentNotes').value;
      const actions = currentConversationActions;
      
      let email = `Subject: Follow-up from our 1:1 - ${new Date().toLocaleDateString()}

Hi ${currentMember.name},

Thanks for the great conversation today. Here's a quick recap:

KEY POINTS DISCUSSED:
${notes || 'See your notes above'}

ACTION ITEMS:
${actions.map(a => `- ${a.text} (Due: ${new Date(a.due).toLocaleDateString()})`).join('\n')}

Let me know if you have any questions or need support on any of these items.

Looking forward to our next check-in!

Best,
[Your Name]`;
      
      // Copy to clipboard
      navigator.clipboard.writeText(email);
      alert('‚úì Follow-up email copied to clipboard!');
    }

    // ==========================================
    // ENHANCED 1:1 PREP SESSION MANAGEMENT
    // ==========================================

    function initializePrepSessions() {
      if (!currentMember) {
        console.error('initializePrepSessions: currentMember is null');
        return;
      }
      
      console.log('Initializing prep sessions for:', currentMember.name);
      console.log('Current sessions1on1:', currentMember.sessions1on1);
      console.log('Number of sessions:', Object.keys(currentMember.sessions1on1 || {}).length);
      
      try {
        // Initialize sessions1on1 if it doesn't exist
        if (!currentMember.sessions1on1) {
          console.log('No sessions1on1 object, creating empty one');
          currentMember.sessions1on1 = {};
        }
        
        // Create first session ONLY if none exist
        if (Object.keys(currentMember.sessions1on1).length === 0) {
          console.log('No sessions found, creating first empty session');
          const sessionId = 'session-' + Date.now();
          currentMember.sessions1on1[sessionId] = createEmptyPrepSession();
          currentMember.currentSessionId = sessionId;
          saveData();
        } else {
          console.log('Found', Object.keys(currentMember.sessions1on1).length, 'existing sessions');
        }
        
        // Set current session if not set
        if (!currentMember.currentSessionId || !currentMember.sessions1on1[currentMember.currentSessionId]) {
          const sessionIds = Object.keys(currentMember.sessions1on1);
          currentMember.currentSessionId = sessionIds[sessionIds.length - 1];
          console.log('Set current session to:', currentMember.currentSessionId);
        } else {
          console.log('Current session already set:', currentMember.currentSessionId);
        }
      } catch (error) {
        console.error('Error in initializePrepSessions:', error);
      }
    }

    function createEmptyPrepSession() {
      return {
        date: new Date().toISOString(),
        dateFormatted: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
        created: new Date().toISOString(),
        monthlyGoal: { target: 0, current: 0 },
        weeklyTargets: [],
        actionPlan: [],
        notes: ''
      };
    }

    function renderPrepSessions() {
      initializePrepSessions();
      renderSessionSelector();
      renderMonthlyGoal();
      renderWeeklyTargets();
      renderActionPlanTable();
      loadSessionNotes();
      
      // Render notes history if it's currently visible
      const historyContent = document.getElementById('notesHistoryContent');
      if (historyContent && historyContent.style.display !== 'none') {
        renderNotesHistory();
      }
    }

    function renderSessionSelector() {
      const selector = document.getElementById('sessionSelector');
      if (!selector) return;
      
      const sessions = Object.entries(currentMember.sessions1on1).sort((a, b) => 
        new Date(b[1].created) - new Date(a[1].created)
      );
      
      selector.innerHTML = sessions.map(([id, session]) => `
        <option value="${id}" ${id === currentMember.currentSessionId ? 'selected' : ''}>
          ${session.dateFormatted}
        </option>
      `).join('');
    }

    function switchPrepSession() {
      const selector = document.getElementById('sessionSelector');
      currentMember.currentSessionId = selector.value;
      saveData();
      renderPrepSessions();
    }

    function createNewPrepSession() {
      const dateInput = prompt('Enter session date (YYYY-MM-DD format, or leave blank for today):');
      let sessionDate = new Date();
      
      if (dateInput) {
        sessionDate = new Date(dateInput);
        if (isNaN(sessionDate.getTime())) {
          alert('Invalid date format. Using today\'s date.');
          sessionDate = new Date();
        }
      }
      
      const sessionId = 'session-' + Date.now();
      const newSession = createEmptyPrepSession();
      newSession.date = sessionDate.toISOString();
      newSession.dateFormatted = sessionDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      // Carry forward monthly goal
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      if (currentSession && currentSession.monthlyGoal) {
        newSession.monthlyGoal = { ...currentSession.monthlyGoal };
      }
      
      // Carry forward incomplete action items
      if (currentSession && currentSession.actionPlan) {
        newSession.actionPlan = currentSession.actionPlan
          .filter(item => item.status !== 'completed')
          .map(item => ({ ...item, id: Date.now() + Math.random() }));
      }
      
      currentMember.sessions1on1[sessionId] = newSession;
      currentMember.currentSessionId = sessionId;
      saveData();
      renderPrepSessions();
      
      alert(`‚úì New session created for ${newSession.dateFormatted}`);
    }

    function copyPrepSession() {
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      const sessionId = 'session-' + Date.now();
      const copiedSession = JSON.parse(JSON.stringify(currentSession));
      copiedSession.created = new Date().toISOString();
      copiedSession.date = new Date().toISOString();
      copiedSession.dateFormatted = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) + ' (Copy)';
      
      currentMember.sessions1on1[sessionId] = copiedSession;
      currentMember.currentSessionId = sessionId;
      saveData();
      renderPrepSessions();
      
      alert('‚úì Session copied!');
    }

    // Monthly Goal Functions
    function toggleMonthlyGoalEdit() {
      const section = document.getElementById('monthlyGoalEditSection');
      section.style.display = section.style.display === 'none' ? 'block' : 'none';
    }

    function updateMonthlyGoal() {
      const target = parseInt(document.getElementById('monthlyGoalTarget').value) || 0;
      const current = parseInt(document.getElementById('monthlyGoalCurrent').value) || 0;
      
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      currentSession.monthlyGoal = { target, current };
      
      saveData();
      renderMonthlyGoal();
      toggleMonthlyGoalEdit();
    }

    function renderMonthlyGoal() {
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      const goal = currentSession.monthlyGoal || { target: 0, current: 0 };
      
      const percentage = goal.target > 0 ? Math.round((goal.current / goal.target) * 100) : 0;
      const remaining = goal.target - goal.current;
      
      document.getElementById('monthlyGoalTarget').value = goal.target;
      document.getElementById('monthlyGoalCurrent').value = goal.current;
      
      document.getElementById('monthlyGoalDisplay').innerHTML = `
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <div style="font-weight: 600; color: var(--text-secondary);">Monthly Revenue Progress</div>
            <div style="font-size: 28px; font-weight: 900; color: ${percentage >= 100 ? '#22c55e' : percentage >= 70 ? '#3b82f6' : '#f59e0b'};">
              ${percentage}%
            </div>
          </div>
          
          <div style="background: var(--bg-primary); border-radius: 9999px; height: 28px; overflow: hidden; margin-bottom: 16px;">
            <div style="height: 100%; background: linear-gradient(90deg, ${percentage >= 100 ? '#22c55e' : '#3b82f6'} 0%, ${percentage >= 100 ? '#16a34a' : '#2563eb'} 100%); width: ${Math.min(percentage, 100)}%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px; transition: width 0.4s;">
              ${percentage}%
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; margin-bottom: 16px;">
            <div style="text-align: center; padding: 10px; background: var(--bg-primary); border-radius: 8px;">
              <div style="font-size: 18px; font-weight: 700; color: var(--text-primary);">$${goal.target.toLocaleString()}</div>
              <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">Target</div>
            </div>
            <div style="text-align: center; padding: 10px; background: var(--bg-primary); border-radius: 8px;">
              <div style="font-size: 18px; font-weight: 700; color: var(--text-primary);">$${goal.current.toLocaleString()}</div>
              <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">Closed</div>
            </div>
            <div style="text-align: center; padding: 10px; background: var(--bg-primary); border-radius: 8px;">
              <div style="font-size: 18px; font-weight: 700; color: ${remaining > 0 ? 'var(--text-primary)' : '#22c55e'};">$${Math.abs(remaining).toLocaleString()}</div>
              <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">${remaining > 0 ? 'Remaining' : 'Over Quota'}</div>
            </div>
          </div>

          ${goal.opportunitiesCreated || goal.dealsToNegotiate ? `
            <div style="border-top: 1px solid var(--bg-primary); padding-top: 12px; margin-top: 4px;">
              <div style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px;">Pipeline Metrics</div>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                <div style="text-align: center; padding: 8px; background: var(--bg-primary); border-radius: 6px;">
                  <div style="font-size: 20px; font-weight: 700; color: #3b82f6;">${goal.opportunitiesCreated || 0}</div>
                  <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">Opps Created</div>
                </div>
                <div style="text-align: center; padding: 8px; background: var(--bg-primary); border-radius: 6px;">
                  <div style="font-size: 20px; font-weight: 700; color: #f59e0b;">${goal.dealsToNegotiate || 0}</div>
                  <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">In Negotiation</div>
                </div>
                <div style="text-align: center; padding: 8px; background: var(--bg-primary); border-radius: 6px;">
                  <div style="font-size: 20px; font-weight: 700; color: #22c55e;">${goal.revenueClosed || goal.current ? `$${(goal.revenueClosed || goal.current).toLocaleString()}` : '$0'}</div>
                  <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">Revenue Closed</div>
                </div>
              </div>
            </div>
          ` : ''}
        </div>
      `;
    }

    // Weekly Targets Functions
    function showAddWeeklyTarget() {
      document.getElementById('addWeeklyTargetSection').style.display = 'block';
      document.getElementById('newWeeklyTarget').focus();
    }

    function hideAddWeeklyTarget() {
      document.getElementById('addWeeklyTargetSection').style.display = 'none';
      document.getElementById('newWeeklyTarget').value = '';
    }

    function addWeeklyTarget() {
      const text = document.getElementById('newWeeklyTarget').value.trim();
      if (!text) return;
      
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      if (!currentSession.weeklyTargets) currentSession.weeklyTargets = [];
      
      currentSession.weeklyTargets.push({
        id: Date.now(),
        text: text,
        status: null
      });
      
      saveData();
      renderWeeklyTargets();
      hideAddWeeklyTarget();
    }

    function updateWeeklyTargetStatus(id, status) {
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      const target = currentSession.weeklyTargets.find(t => t.id === id);
      if (target) {
        target.status = target.status === status ? null : status;
        saveData();
        renderWeeklyTargets();
      }
    }

    function deleteWeeklyTarget(id) {
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      currentSession.weeklyTargets = currentSession.weeklyTargets.filter(t => t.id !== id);
      saveData();
      renderWeeklyTargets();
    }

    function renderWeeklyTargets() {
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      const targets = currentSession.weeklyTargets || [];
      
      if (targets.length === 0) {
        document.getElementById('weeklyTargetsList').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üéØ</div>
            <div class="empty-text">No weekly targets set</div>
            <div class="empty-hint">Click "Add Target" to add goals for this week</div>
          </div>
        `;
        return;
      }
      
      document.getElementById('weeklyTargetsList').innerHTML = targets.map(target => `
        <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 8px;">
          <div style="display: flex; gap: 4px;">
            <button onclick="updateWeeklyTargetStatus(${target.id}, 'completed')" 
                    style="width: 32px; height: 32px; border-radius: 6px; border: 2px solid ${target.status === 'completed' ? '#22c55e' : '#374151'}; background: ${target.status === 'completed' ? '#22c55e' : 'transparent'}; color: white; cursor: pointer; font-size: 16px;"
                    title="Completed">
              ${target.status === 'completed' ? '‚úì' : ''}
            </button>
            <button onclick="updateWeeklyTargetStatus(${target.id}, 'failed')" 
                    style="width: 32px; height: 32px; border-radius: 6px; border: 2px solid ${target.status === 'failed' ? '#ef4444' : '#374151'}; background: ${target.status === 'failed' ? '#ef4444' : 'transparent'}; color: white; cursor: pointer; font-size: 16px;"
                    title="Not achieved">
              ${target.status === 'failed' ? '‚úó' : ''}
            </button>
            <button onclick="updateWeeklyTargetStatus(${target.id}, 'paused')" 
                    style="width: 32px; height: 32px; border-radius: 6px; border: 2px solid ${target.status === 'paused' ? '#f59e0b' : '#374151'}; background: ${target.status === 'paused' ? '#f59e0b' : 'transparent'}; color: white; cursor: pointer; font-size: 16px;"
                    title="Paused/Deferred">
              ${target.status === 'paused' ? '‚è∏' : ''}
            </button>
          </div>
          <div style="flex: 1; font-size: 14px; ${target.status === 'completed' ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${target.text}</div>
          <button onclick="deleteWeeklyTarget(${target.id})" style="color: var(--accent-danger); background: none; border: none; cursor: pointer; font-size: 18px;" title="Delete">üóëÔ∏è</button>
        </div>
      `).join('');
    }

    // Action Plan Functions
    function showAddActionPlan() {
      document.getElementById('addActionPlanSection').style.display = 'block';
      document.getElementById('newActionMilestone').focus();
    }

    function hideAddActionPlan() {
      document.getElementById('addActionPlanSection').style.display = 'none';
      document.getElementById('newActionMilestone').value = '';
      document.getElementById('newActionOwner').value = '';
      document.getElementById('newActionDue').value = '';
      document.getElementById('newActionEvidence').value = '';
      document.getElementById('newActionStatus').value = 'open';
    }

    function addActionPlanItem() {
      const milestone = document.getElementById('newActionMilestone').value.trim();
      if (!milestone) return;
      
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      if (!currentSession.actionPlan) currentSession.actionPlan = [];
      
      currentSession.actionPlan.push({
        id: Date.now(),
        milestone: milestone,
        owner: document.getElementById('newActionOwner').value.trim() || currentMember.name,
        due: document.getElementById('newActionDue').value,
        evidence: document.getElementById('newActionEvidence').value.trim(),
        status: document.getElementById('newActionStatus').value
      });
      
      saveData();
      renderActionPlanTable();
      hideAddActionPlan();
    }

    function updateActionPlanStatus(id, status) {
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      const action = currentSession.actionPlan.find(a => a.id === id);
      if (action) {
        action.status = status;
        saveData();
        renderActionPlanTable();
      }
    }

    function deleteActionPlanItem(id) {
      if (!confirm('Delete this action item?')) return;
      
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      currentSession.actionPlan = currentSession.actionPlan.filter(a => a.id !== id);
      saveData();
      renderActionPlanTable();
    }

    function renderActionPlanTable() {
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      const actions = currentSession.actionPlan || [];
      
      if (actions.length === 0) {
        document.getElementById('actionPlanTable').innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚úÖ</div>
            <div class="empty-text">No action items</div>
            <div class="empty-hint">Click "Add Action" to track commitments</div>
          </div>
        `;
        return;
      }
      
      const statusColors = {
        'open': '#3b82f6',
        'in-progress': '#f59e0b',
        'completed': '#22c55e',
        'blocked': '#ef4444'
      };
      
      document.getElementById('actionPlanTable').innerHTML = `
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
            <thead>
              <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--bg-primary);">
                <th style="padding: 10px; text-align: left; font-weight: 600;">Milestone / Action</th>
                <th style="padding: 10px; text-align: left; font-weight: 600;">Owner</th>
                <th style="padding: 10px; text-align: left; font-weight: 600;">Due</th>
                <th style="padding: 10px; text-align: left; font-weight: 600;">Evidence</th>
                <th style="padding: 10px; text-align: left; font-weight: 600;">Status</th>
                <th style="padding: 10px; text-align: center; font-weight: 600;">Actions</th>
              </tr>
            </thead>
            <tbody>
              ${actions.map(action => {
                const dueDate = action.due ? new Date(action.due) : null;
                const isOverdue = dueDate && dueDate < new Date() && action.status !== 'completed';
                
                return `
                  <tr style="border-bottom: 1px solid var(--bg-secondary);">
                    <td style="padding: 10px;">${action.milestone}</td>
                    <td style="padding: 10px;">${action.owner}</td>
                    <td style="padding: 10px; ${isOverdue ? 'color: var(--accent-danger); font-weight: 600;' : ''}">${dueDate ? dueDate.toLocaleDateString() : '-'}</td>
                    <td style="padding: 10px; font-size: 12px; color: var(--text-muted);">${action.evidence || '-'}</td>
                    <td style="padding: 10px;">
                      <select onchange="updateActionPlanStatus(${action.id}, this.value)" style="padding: 4px 8px; border-radius: 6px; border: 1px solid ${statusColors[action.status]}; background: ${statusColors[action.status]}22; color: ${statusColors[action.status]}; font-weight: 600; font-size: 12px;">
                        <option value="open" ${action.status === 'open' ? 'selected' : ''}>Open</option>
                        <option value="in-progress" ${action.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                        <option value="completed" ${action.status === 'completed' ? 'selected' : ''}>Completed</option>
                        <option value="blocked" ${action.status === 'blocked' ? 'selected' : ''}>Blocked</option>
                      </select>
                    </td>
                    <td style="padding: 10px; text-align: center;">
                      <button onclick="deleteActionPlanItem(${action.id})" style="background: none; border: none; cursor: pointer; font-size: 16px; color: var(--accent-danger);" title="Delete">üóëÔ∏è</button>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function loadSessionNotes() {
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      document.getElementById('currentNotes').value = currentSession.notes || '';
    }

    function save1on1Session() {
      const currentSession = currentMember.sessions1on1[currentMember.currentSessionId];
      currentSession.notes = document.getElementById('currentNotes').value;
      saveData();
      alert('‚úì Session saved!');
    }

    function toggleNotesHistory() {
      const content = document.getElementById('notesHistoryContent');
      const toggle = document.getElementById('notesHistoryToggle');
      
      if (content.style.display === 'none') {
        renderNotesHistory();
        content.style.display = 'block';
        toggle.textContent = 'Hide';
      } else {
        content.style.display = 'none';
        toggle.textContent = 'Show All';
      }
    }

    function renderNotesHistory() {
      if (!currentMember || !currentMember.sessions1on1) return;
      
      const sessions = Object.entries(currentMember.sessions1on1)
        .sort((a, b) => new Date(b[1].created) - new Date(a[1].created)); // Newest first
      
      if (sessions.length === 0) {
        document.getElementById('notesHistoryContent').innerHTML = `
          <div class="empty-state">
            <div class="empty-text">No session notes yet</div>
          </div>
        `;
        return;
      }
      
      const html = sessions.map(([sessionId, session], index) => {
        const isCurrent = sessionId === currentMember.currentSessionId;
        const hasNotes = session.notes && session.notes.trim().length > 0;
        
        return `
          <div style="
            padding: 16px; 
            background: ${isCurrent ? 'rgba(59, 130, 246, 0.05)' : 'var(--bg-secondary)'}; 
            border-left: 4px solid ${isCurrent ? '#3b82f6' : 'var(--bg-primary)'};
            border-radius: 8px; 
            margin-bottom: 12px;
          ">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div style="font-weight: 600; color: var(--text-primary);">
                ${session.dateFormatted}
                ${isCurrent ? '<span style="background: #3b82f6; color: white; font-size: 10px; padding: 2px 8px; border-radius: 12px; margin-left: 8px;">CURRENT</span>' : ''}
              </div>
              <button 
                class="btn btn-secondary" 
                onclick="switchToSession('${sessionId}')" 
                style="font-size: 11px; padding: 4px 10px;"
              >
                ${isCurrent ? 'üìù Current' : 'üëÅÔ∏è View'}
              </button>
            </div>
            
            ${session.monthlyGoal ? `
              <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">
                Revenue: $${session.monthlyGoal.current?.toLocaleString() || '0'} / $${session.monthlyGoal.target?.toLocaleString() || '0'} 
                (${session.monthlyGoal.target > 0 ? Math.round((session.monthlyGoal.current / session.monthlyGoal.target) * 100) : 0}%)
                ${session.monthlyGoal.opportunitiesCreated ? ` ‚Ä¢ ${session.monthlyGoal.opportunitiesCreated} opps created` : ''}
              </div>
            ` : ''}
            
            ${hasNotes ? `
              <div style="
                padding: 12px; 
                background: var(--bg-primary); 
                border-radius: 6px; 
                font-size: 13px; 
                line-height: 1.6; 
                color: var(--text-secondary);
                white-space: pre-wrap;
              ">
                ${session.notes}
              </div>
            ` : `
              <div style="font-size: 12px; color: var(--text-muted); font-style: italic;">
                No notes for this session
              </div>
            `}
          </div>
        `;
      }).join('');
      
      document.getElementById('notesHistoryContent').innerHTML = html;
    }

    function switchToSession(sessionId) {
      const selector = document.getElementById('sessionSelector');
      selector.value = sessionId;
      currentMember.currentSessionId = sessionId;
      saveData();
      renderPrepSessions();
      
      // Scroll to top of prep tab
      document.getElementById('tab-prep').scrollTop = 0;
    }


    // Render Profile Tab
    function renderProfile() {
      if (!currentMember) return;
      
      // Core Profile
      document.getElementById('coreProfileContent').innerHTML = `
        <div class="info-card">
          <div class="info-card-title">Readiness Level</div>
          <div class="info-card-content">${currentMember.readiness} - ${getReadinessDescription(currentMember.readiness)}</div>
        </div>
        <div class="info-card">
          <div class="info-card-title">Personality Type</div>
          <div class="info-card-content">${currentMember.personality} - ${getPersonalityDescription(currentMember.personality)}</div>
        </div>
        <div class="info-card">
          <div class="info-card-title">Career Stage</div>
          <div class="info-card-content">${currentMember.careerStage}</div>
        </div>
        <div class="info-card">
          <div class="info-card-title">Work Style</div>
          <div class="info-card-content">${currentMember.workStyle}</div>
        </div>
      `;
      
      // Load current values
      document.getElementById('perfStatus').value = currentMember.perfStatus;
      document.getElementById('focusArea').value = currentMember.focusArea;
      document.getElementById('personalNotes').value = currentMember.personalNotes || '';
      document.getElementById('careerGoals').value = currentMember.careerGoals || '';
      document.getElementById('motivators').value = currentMember.motivators || '';
      document.getElementById('demotivators').value = currentMember.demotivators || '';
      
      // Coaching Guidance
      const guidance = getCoachingGuidance(currentMember.readiness, currentMember.personality);
      document.getElementById('coachingGuidanceContent').innerHTML = `
        <div class="coaching-box">
          <div class="coaching-box-title">How to Coach ${currentMember.readiness}/${currentMember.personality}</div>
          <ul class="coaching-list">
            ${guidance.map(g => `<li>${g}</li>`).join('')}
          </ul>
        </div>
      `;
    }

    function getReadinessDescription(level) {
      const descriptions = {
        'R1': 'New to role, needs direction and structure',
        'R2': 'Growing skills, needs coaching and encouragement',
        'R3': 'Capable performer, needs support and autonomy',
        'R4': 'Expert performer, needs delegation and challenge'
      };
      return descriptions[level];
    }

    function getPersonalityDescription(type) {
      const descriptions = {
        'Owl': 'Analytical thinker, values data and logic',
        'Panther': 'Results driver, values autonomy and achievement',
        'Peacock': 'People influencer, values recognition and relationships',
        'Dolphin': 'Team harmonizer, values collaboration and support'
      };
      return descriptions[type];
    }

    function getCoachingGuidance(readiness, personality) {
      const guidance = [];
      
      // Readiness guidance
      if (readiness === 'R1') {
        guidance.push("Provide clear structure, specific tasks, and frequent check-ins");
        guidance.push("Focus on skill-building through shadowing and practice");
        guidance.push("Celebrate small wins to build confidence");
      } else if (readiness === 'R2') {
        guidance.push("Balance support with increasing autonomy");
        guidance.push("Focus coaching on specific skill gaps");
        guidance.push("Encourage but don't over-help");
      } else if (readiness === 'R3') {
        guidance.push("Shift to strategic discussions vs tactical direction");
        guidance.push("Remove obstacles and provide resources");
        guidance.push("Challenge them with stretch opportunities");
      } else {
        guidance.push("Delegate significant initiatives");
        guidance.push("Leverage as mentor for others");
        guidance.push("Seek their input on team strategy");
      }
      
      // Personality overlay
      if (personality === 'Owl') {
        guidance.push("Communication: Provide data, frameworks, and time to process");
        guidance.push("Motivation: Intellectual challenge, mastery, clear systems");
        guidance.push("Watch for: Analysis paralysis, need permission to act");
      } else if (personality === 'Panther') {
        guidance.push("Communication: Direct, results-focused, respect their time");
        guidance.push("Motivation: Competition, autonomy, clear goals");
        guidance.push("Watch for: Cutting corners, overlooking team dynamics");
      } else if (personality === 'Peacock') {
        guidance.push("Communication: Enthusiastic, relationship-focused, public recognition");
        guidance.push("Motivation: Visibility, collaboration, celebration");
        guidance.push("Watch for: Lack of follow-through, overpromising");
      } else {
        guidance.push("Communication: Empathetic, patient, collaborative");
        guidance.push("Motivation: Team harmony, helping others, stability");
        guidance.push("Watch for: Avoiding conflict, taking on too much");
      }
      
      return guidance;
    }

    function saveProfile() {
      if (!currentMember) return;
      
      currentMember.perfStatus = document.getElementById('perfStatus').value;
      currentMember.focusArea = document.getElementById('focusArea').value;
      currentMember.personalNotes = document.getElementById('personalNotes').value;
      currentMember.careerGoals = document.getElementById('careerGoals').value;
      currentMember.motivators = document.getElementById('motivators').value;
      currentMember.demotivators = document.getElementById('demotivators').value;
      
      saveData();
      renderTeamGrid();
      
      alert('‚úì Profile updated!');
    }

    // Render History Tab
    function renderHistory() {
      if (!currentMember) return;
      
      const convHistory = document.getElementById('conversationHistory');
      
      // Combine conversations and 1:1 sessions into a single timeline
      const allEntries = [];
      
      // Add traditional conversations
      if (currentMember.conversations && currentMember.conversations.length > 0) {
        currentMember.conversations.forEach(conv => {
          allEntries.push({
            date: new Date(conv.date),
            type: 'conversation',
            data: conv
          });
        });
      }
      
      // Add 1:1 sessions
      if (currentMember.sessions1on1) {
        Object.entries(currentMember.sessions1on1).forEach(([sessionId, session]) => {
          allEntries.push({
            date: new Date(session.date),
            type: '1on1',
            data: session,
            sessionId: sessionId
          });
        });
      }
      
      // Sort by date, newest first
      allEntries.sort((a, b) => b.date - a.date);
      
      if (allEntries.length === 0) {
        convHistory.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üí¨</div>
            <div class="empty-text">No conversation history yet</div>
            <div class="empty-hint">Notes from 1:1s will appear here</div>
          </div>
        `;
      } else {
        convHistory.innerHTML = allEntries.map(entry => {
          if (entry.type === '1on1') {
            const session = entry.data;
            const isCurrent = entry.sessionId === currentMember.currentSessionId;
            const hasNotes = session.notes && session.notes.trim().length > 0;
            
            return `
              <div class="conversation-item" style="border-left: 4px solid ${isCurrent ? '#3b82f6' : '#22c55e'};">
                <div class="conversation-header">
                  <div class="conversation-date">
                    ${session.dateFormatted}
                    ${isCurrent ? '<span style="background: #3b82f6; color: white; font-size: 10px; padding: 2px 8px; border-radius: 12px; margin-left: 8px;">CURRENT</span>' : ''}
                  </div>
                  <div class="conversation-type" style="background: #22c55e; color: white;">üìÖ 1:1 Session</div>
                </div>
                
                ${session.monthlyGoal ? `
                  <div style="
                    background: var(--bg-secondary); 
                    padding: 10px 12px; 
                    border-radius: 8px; 
                    margin: 8px 0;
                    font-size: 12px;
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                    gap: 8px;
                  ">
                    <div>
                      <div style="color: var(--text-muted); font-size: 10px;">Revenue</div>
                      <div style="font-weight: 600;">$${session.monthlyGoal.current?.toLocaleString() || '0'} / $${session.monthlyGoal.target?.toLocaleString() || '0'}</div>
                    </div>
                    <div>
                      <div style="color: var(--text-muted); font-size: 10px;">Quota %</div>
                      <div style="font-weight: 600; color: ${session.monthlyGoal.target > 0 && (session.monthlyGoal.current / session.monthlyGoal.target) >= 1 ? '#22c55e' : '#3b82f6'};">
                        ${session.monthlyGoal.target > 0 ? Math.round((session.monthlyGoal.current / session.monthlyGoal.target) * 100) : 0}%
                      </div>
                    </div>
                    ${session.monthlyGoal.opportunitiesCreated ? `
                      <div>
                        <div style="color: var(--text-muted); font-size: 10px;">Opps Created</div>
                        <div style="font-weight: 600;">${session.monthlyGoal.opportunitiesCreated}</div>
                      </div>
                    ` : ''}
                    ${session.monthlyGoal.dealsToNegotiate ? `
                      <div>
                        <div style="color: var(--text-muted); font-size: 10px;">In Negotiation</div>
                        <div style="font-weight: 600;">${session.monthlyGoal.dealsToNegotiate}</div>
                      </div>
                    ` : ''}
                  </div>
                ` : ''}
                
                ${hasNotes ? `
                  <div class="conversation-notes" style="background: var(--bg-secondary); padding: 12px; border-radius: 8px; margin-top: 8px;">
                    ${session.notes}
                  </div>
                ` : `
                  <div style="font-size: 12px; color: var(--text-muted); font-style: italic; margin-top: 8px;">
                    No notes for this session
                  </div>
                `}
                
                ${session.actionPlan && session.actionPlan.length > 0 ? `
                  <div style="margin-top: 12px;">
                    <div style="font-size: 11px; font-weight: 600; color: var(--text-muted); margin-bottom: 6px;">
                      Action Items (${session.actionPlan.length}):
                    </div>
                    <div class="action-items">
                      ${session.actionPlan.map(action => {
                        const statusColors = {
                          'open': '#3b82f6',
                          'in-progress': '#f59e0b',
                          'completed': '#22c55e',
                          'blocked': '#ef4444'
                        };
                        return `
                          <div class="action-chip" style="border-left: 3px solid ${statusColors[action.status]}; padding-left: 8px; margin-bottom: 4px;">
                            <div style="font-size: 12px;">${action.milestone}</div>
                            <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">
                              ${action.owner} ‚Ä¢ Due: ${action.due ? new Date(action.due).toLocaleDateString() : 'N/A'} ‚Ä¢ 
                              <span style="color: ${statusColors[action.status]}; font-weight: 600; text-transform: uppercase;">
                                ${action.status.replace('-', ' ')}
                              </span>
                            </div>
                          </div>
                        `;
                      }).join('')}
                    </div>
                  </div>
                ` : ''}
                
                <button 
                  class="btn btn-secondary" 
                  onclick="viewSession('${entry.sessionId}')" 
                  style="margin-top: 12px; font-size: 12px; padding: 6px 12px;"
                >
                  üìã View Full Session Details
                </button>
              </div>
            `;
          } else {
            // Traditional conversation
            const conv = entry.data;
            return `
              <div class="conversation-item">
                <div class="conversation-header">
                  <div class="conversation-date">${entry.date.toLocaleDateString()}</div>
                  <div class="conversation-type">${conv.type}</div>
                </div>
                <div class="conversation-notes">${conv.notes || 'No notes recorded'}</div>
                ${conv.actions && conv.actions.length > 0 ? `
                  <div class="action-items">
                    ${conv.actions.map(a => `
                      <div class="action-chip">${a.text}</div>
                    `).join('')}
                  </div>
                ` : ''}
              </div>
            `;
          }
        }).join('');
      }
      
      // All Actions
      const allActions = document.getElementById('allActions');
      if (currentMember.actions.length === 0) {
        allActions.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚úì</div>
            <div class="empty-text">No action items yet</div>
          </div>
        `;
      } else {
        allActions.innerHTML = currentMember.actions.map(action => {
          const isOverdue = !action.completed && action.due < Date.now();
          const statusClass = action.completed ? 'completed' : (isOverdue ? 'overdue' : '');
          
          return `
            <div class="action-chip ${statusClass}" style="display: block; margin-bottom: 8px;">
              <input type="checkbox" ${action.completed ? 'checked' : ''} onchange="toggleAction(${action.id})" style="margin-right: 8px;">
              ${action.text} - Due: ${new Date(action.due).toLocaleDateString()}
              ${isOverdue ? ' ‚ö†Ô∏è' : ''}
            </div>
          `;
        }).join('');
      }
    }

    function viewSession(sessionId) {
      // Switch to 1:1 Prep tab
      document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelector('.modal-tab[data-tab="prep"]').classList.add('active');
      document.getElementById('tab-prep').classList.add('active');
      
      // Switch to that session
      currentMember.currentSessionId = sessionId;
      const selector = document.getElementById('sessionSelector');
      if (selector) selector.value = sessionId;
      
      saveData();
      renderPrepSessions();
      
      // Scroll to top
      document.getElementById('tab-prep').scrollTop = 0;
    }

    function toggleAction(actionId) {
      if (!currentMember) return;
      
      const action = currentMember.actions.find(a => a.id === actionId);
      if (action) {
        action.completed = !action.completed;
        saveData();
        renderHistory();
        renderTeamGrid();
      }
    }

    // Render Development Tab
    function renderDevelopment() {
      if (!currentMember) return;
      
      // Initialize devPlan if it doesn't exist
      if (!currentMember.devPlan) {
        currentMember.devPlan = { skills: [], activities: [] };
      }
      if (!currentMember.devPlan.skills) {
        currentMember.devPlan.skills = [];
      }
      if (!currentMember.devPlan.activities) {
        currentMember.devPlan.activities = [];
      }
      
      // Development Plan
      document.getElementById('devPlanContent').innerHTML = `
        <div class="info-card">
          <div class="info-card-title">Career Goals</div>
          <div class="info-card-content">${currentMember.careerGoals || 'Not set'}</div>
        </div>
        <div class="info-card">
          <div class="info-card-title">Current Focus</div>
          <div class="info-card-content">${currentMember.focusArea}</div>
        </div>
      `;
      
      // Skill Progress
      const skillProgress = document.getElementById('skillProgressContent');
      if (currentMember.devPlan.skills.length === 0) {
        skillProgress.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üéØ</div>
            <div class="empty-text">No skills being tracked</div>
            <div class="empty-hint">Click "+ Add Skill to Track" below to start tracking development</div>
          </div>
        `;
      } else {
        skillProgress.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <div style="font-size: 13px; color: var(--text-secondary);">
              ${currentMember.devPlan.skills.length} skill${currentMember.devPlan.skills.length !== 1 ? 's' : ''} being tracked
            </div>
            <button class="btn btn-secondary" onclick="openSkillAssessment()" style="font-size: 12px; padding: 6px 12px;">
              üìã Conduct Assessment
            </button>
          </div>
        ` + currentMember.devPlan.skills.map((skill, idx) => {
          const lastUpdate = skill.lastUpdated ? new Date(skill.lastUpdated).toLocaleDateString() : 'Never assessed';
          const history = skill.history || [];
          const hasHistory = history.length > 0;
          
          return `
            <div class="skill-item" id="skill-item-${idx}" style="flex-direction: column; align-items: stretch;">
              <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                <div style="flex: 1;">
                  <div class="skill-name">${skill.name}</div>
                  <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                    Last updated: ${lastUpdate}
                  </div>
                </div>
                <div style="display: flex; gap: 8px;">
                  <button class="icon-btn" onclick="editSkillProgress(${idx})" title="Quick edit">‚úèÔ∏è</button>
                  <button class="icon-btn" onclick="viewSkillHistory(${idx})" title="View history" ${!hasHistory ? 'style="opacity: 0.5;"' : ''}>üìä</button>
                  <button class="icon-btn" onclick="deleteSkill(${idx})" title="Remove skill" style="color: var(--accent-danger);">üóëÔ∏è</button>
                </div>
              </div>
              
              <div class="skill-progress">
                <div class="progress-bar" onclick="editSkillProgress(${idx})" style="cursor: pointer;" title="Click to update progress">
                  <div class="progress-fill" style="width: ${skill.current}%"></div>
                </div>
                <div class="progress-label">${skill.current}% / ${skill.target}%</div>
              </div>

              ${hasHistory && history.length > 1 ? `
                <div style="font-size: 11px; color: var(--accent-success); margin-top: 4px;">
                  üìà +${skill.current - history[0].previousValue}% improvement since ${new Date(history[0].date).toLocaleDateString()}
                </div>
              ` : ''}

              <div id="edit-skill-${idx}" style="display: none; margin-top: 12px; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                  <label style="font-size: 12px; font-weight: 600; min-width: 80px;">Current Level:</label>
                  <input type="range" class="slider" id="skill-slider-${idx}" min="0" max="100" value="${skill.current}" 
                         style="flex: 1;"
                         oninput="document.getElementById('skill-value-${idx}').textContent = this.value + '%'">
                  <span id="skill-value-${idx}" style="font-size: 14px; font-weight: 700; color: var(--accent-primary); min-width: 45px;">${skill.current}%</span>
                </div>
                <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 12px;">
                  Target: ${skill.target}% ‚Ä¢ Gap: ${skill.target - skill.current}%
                </div>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-primary" style="font-size: 12px; padding: 6px 12px;" onclick="saveSkillProgress(${idx})">
                    Save Progress
                  </button>
                  <button class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px;" onclick="cancelSkillEdit(${idx})">
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    function editSkillProgress(skillIndex) {
      // Hide all other edit forms first
      document.querySelectorAll('[id^="edit-skill-"]').forEach(form => {
        form.style.display = 'none';
      });
      
      // Show this skill's edit form
      const editForm = document.getElementById(`edit-skill-${skillIndex}`);
      editForm.style.display = 'block';
      
      // Scroll into view smoothly
      editForm.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function cancelSkillEdit(skillIndex) {
      const editForm = document.getElementById(`edit-skill-${skillIndex}`);
      editForm.style.display = 'none';
      
      // Reset slider to original value
      if (currentMember && currentMember.devPlan.skills[skillIndex]) {
        const skill = currentMember.devPlan.skills[skillIndex];
        document.getElementById(`skill-slider-${skillIndex}`).value = skill.current;
        document.getElementById(`skill-value-${skillIndex}`).textContent = skill.current + '%';
      }
    }

    function saveSkillProgress(skillIndex) {
      if (!currentMember) return;
      
      const newValue = parseInt(document.getElementById(`skill-slider-${skillIndex}`).value);
      const skill = currentMember.devPlan.skills[skillIndex];
      const oldValue = skill.current;
      
      if (newValue === oldValue) {
        cancelSkillEdit(skillIndex);
        return;
      }
      
      // Initialize history if it doesn't exist
      if (!skill.history) {
        skill.history = [];
      }
      
      // Add to history
      const assessmentDate = new Date();
      skill.history.push({
        date: assessmentDate,
        value: newValue,
        previousValue: oldValue,
        change: newValue - oldValue,
        notes: 'Quick edit update'
      });
      
      // Update the skill
      skill.current = newValue;
      skill.lastUpdated = assessmentDate;
      
      // Calculate improvement
      const improvement = newValue - oldValue;
      const improvementText = improvement > 0 
        ? `+${improvement}%` 
        : `${improvement}%`;
      
      saveData();
      
      // Hide edit form and refresh display
      cancelSkillEdit(skillIndex);
      renderDevelopment();
      renderTeamDevelopment(); // Update team dashboard
      
      // Visual feedback
      const skillItem = document.getElementById(`skill-item-${skillIndex}`);
      if (skillItem) {
        skillItem.style.background = improvement > 0 ? 'rgba(5, 150, 105, 0.1)' : 'rgba(245, 158, 11, 0.1)';
        setTimeout(() => {
          skillItem.style.background = 'transparent';
        }, 1000);
      }
      
      // Success message
      const message = improvement > 0
        ? `‚úì Progress updated!\n\n${skill.name}: ${oldValue}% ‚Üí ${newValue}% (${improvementText})\n\nGreat improvement!`
        : `‚úì Progress updated!\n\n${skill.name}: ${oldValue}% ‚Üí ${newValue}% (${improvementText})`;
      
      alert(message);
    }

    function addDevActivity() {
      if (!currentMember) return;
      
      const type = document.getElementById('activityType').value;
      const desc = document.getElementById('activityDesc').value;
      const target = document.getElementById('activityTarget').value;
      
      if (!desc || !target) {
        alert('Please fill in all fields');
        return;
      }
      
      currentMember.devPlan.activities.push({
        type: type,
        desc: desc,
        target: new Date(target),
        status: 'planned'
      });
      
      saveData();
      
      document.getElementById('activityDesc').value = '';
      document.getElementById('activityTarget').value = '';
      
      alert('‚úì Development activity added!');
      renderDevelopment();
      renderTeamDevelopment(); // Update team view too
    }

    // Skill Tracking Functions
    function toggleAddSkillForm() {
      const form = document.getElementById('addSkillForm');
      const isVisible = form.style.display !== 'none';
      
      if (isVisible) {
        form.style.display = 'none';
      } else {
        form.style.display = 'block';
        // Reset form
        document.getElementById('newSkillName').value = '';
        document.getElementById('customSkillName').value = '';
        document.getElementById('customSkillGroup').style.display = 'none';
        document.getElementById('currentLevel').value = 50;
        document.getElementById('targetLevel').value = 75;
        document.getElementById('currentLevelValue').textContent = '50%';
        document.getElementById('targetLevelValue').textContent = '75%';
      }
    }

    function handleSkillSelection() {
      const select = document.getElementById('newSkillName');
      const customGroup = document.getElementById('customSkillGroup');
      
      if (select.value === 'CUSTOM') {
        customGroup.style.display = 'block';
      } else {
        customGroup.style.display = 'none';
      }
    }

    function addSkillToTrack() {
      if (!currentMember) return;
      
      // Initialize devPlan if needed
      if (!currentMember.devPlan) {
        currentMember.devPlan = { skills: [], activities: [] };
      }
      if (!currentMember.devPlan.skills) {
        currentMember.devPlan.skills = [];
      }
      
      const selectValue = document.getElementById('newSkillName').value;
      let skillName = '';
      
      if (!selectValue) {
        alert('Please select a skill');
        return;
      }
      
      if (selectValue === 'CUSTOM') {
        skillName = document.getElementById('customSkillName').value.trim();
        if (!skillName) {
          alert('Please enter a custom skill name');
          return;
        }
      } else {
        skillName = selectValue;
      }
      
      const currentLevel = parseInt(document.getElementById('currentLevel').value);
      const targetLevel = parseInt(document.getElementById('targetLevel').value);
      
      if (targetLevel <= currentLevel) {
        alert('Target level must be higher than current level');
        return;
      }
      
      // Check if skill already exists
      const existingSkill = currentMember.devPlan.skills.find(s => s.name === skillName);
      if (existingSkill) {
        alert('This skill is already being tracked. Update it from the list above.');
        return;
      }
      
      // Add skill
      currentMember.devPlan.skills.push({
        name: skillName,
        current: currentLevel,
        target: targetLevel
      });
      
      saveData();
      renderDevelopment();
      renderTeamDevelopment(); // Update team dashboard
      toggleAddSkillForm();
      
      alert(`‚úì Now tracking "${skillName}"!\n\nCurrent: ${currentLevel}% ‚Üí Target: ${targetLevel}%`);
    }

    function deleteSkill(skillIndex) {
      if (!currentMember) return;
      
      const skill = currentMember.devPlan.skills[skillIndex];
      const confirmed = confirm(`Remove "${skill.name}" from tracking?\n\nThis will also remove it from the Team Development Dashboard.`);
      
      if (confirmed) {
        currentMember.devPlan.skills.splice(skillIndex, 1);
        saveData();
        renderDevelopment();
        renderTeamDevelopment(); // Update team dashboard
        alert('‚úì Skill removed from tracking');
      }
    }

    // SKILL ASSESSMENT SYSTEM
    function openSkillAssessment() {
      if (!currentMember) return;
      
      // Initialize devPlan if needed
      if (!currentMember.devPlan) {
        currentMember.devPlan = { skills: [], activities: [] };
      }
      if (!currentMember.devPlan.skills) {
        currentMember.devPlan.skills = [];
      }
      
      if (currentMember.devPlan.skills.length === 0) {
        alert('No skills to assess. Add skills to track first.');
        return;
      }
      
      document.getElementById('assessmentModalTitle').textContent = `Skill Assessment: ${currentMember.name}`;
      
      const skillsList = document.getElementById('assessmentSkillsList');
      skillsList.innerHTML = currentMember.devPlan.skills.map((skill, idx) => `
        <div class="assessment-skill-row">
          <div class="assessment-skill-header">
            <div>
              <div class="assessment-skill-name">${skill.name}</div>
              <div class="assessment-old-value">Current: ${skill.current}% ‚Üí Target: ${skill.target}%</div>
            </div>
          </div>
          
          <div style="display: flex; align-items: center; gap: 12px; margin-top: 12px;">
            <label style="font-size: 12px; font-weight: 600; min-width: 80px;">New Level:</label>
            <input type="range" class="slider" id="assess-slider-${idx}" min="0" max="100" value="${skill.current}" 
                   style="flex: 1;"
                   oninput="document.getElementById('assess-value-${idx}').textContent = this.value + '%'; updateAssessmentChange(${idx}, this.value, ${skill.current})">
            <span id="assess-value-${idx}" style="font-size: 16px; font-weight: 700; color: var(--accent-primary); min-width: 50px;">${skill.current}%</span>
          </div>
          
          <div id="assess-change-${idx}" style="font-size: 12px; color: var(--text-muted); margin-top: 8px; min-height: 20px;">
            No change
          </div>
        </div>
      `).join('');
      
      document.getElementById('assessmentNotes').value = '';
      document.getElementById('skillAssessmentModal').classList.add('active');
    }

    function updateAssessmentChange(skillIdx, newValue, oldValue) {
      const change = parseInt(newValue) - parseInt(oldValue);
      const changeDiv = document.getElementById(`assess-change-${skillIdx}`);
      
      if (change === 0) {
        changeDiv.textContent = 'No change';
        changeDiv.style.color = 'var(--text-muted)';
      } else if (change > 0) {
        changeDiv.textContent = `‚Üë Improved by ${change}%`;
        changeDiv.style.color = 'var(--accent-success)';
        changeDiv.style.fontWeight = '600';
      } else {
        changeDiv.textContent = `‚Üì Decreased by ${Math.abs(change)}%`;
        changeDiv.style.color = 'var(--accent-danger)';
        changeDiv.style.fontWeight = '600';
      }
    }

    function saveSkillAssessment() {
      if (!currentMember) return;
      
      const notes = document.getElementById('assessmentNotes').value;
      const assessmentDate = new Date();
      let changesCount = 0;
      
      currentMember.devPlan.skills.forEach((skill, idx) => {
        const newValue = parseInt(document.getElementById(`assess-slider-${idx}`).value);
        const oldValue = skill.current;
        
        if (newValue !== oldValue) {
          changesCount++;
          
          // Initialize history if it doesn't exist
          if (!skill.history) {
            skill.history = [];
          }
          
          // Add to history
          skill.history.push({
            date: assessmentDate,
            value: newValue,
            previousValue: oldValue,
            change: newValue - oldValue,
            notes: notes || null
          });
          
          // Update current value
          skill.current = newValue;
          skill.lastUpdated = assessmentDate;
        }
      });
      
      if (changesCount === 0) {
        alert('No changes were made to skill levels.');
        return;
      }
      
      saveData();
      closeSkillAssessment();
      renderDevelopment();
      renderTeamDevelopment();
      
      alert(`‚úì Assessment saved!\n\n${changesCount} skill${changesCount !== 1 ? 's' : ''} updated and recorded in history.`);
    }

    function closeSkillAssessment() {
      document.getElementById('skillAssessmentModal').classList.remove('active');
    }

    // SKILL HISTORY VIEW
    function viewSkillHistory(skillIndex) {
      if (!currentMember) return;
      
      const skill = currentMember.devPlan.skills[skillIndex];
      
      if (!skill.history || skill.history.length === 0) {
        alert('No history available for this skill yet.\n\nHistory is created when you update skill levels through:\n‚Ä¢ Quick edit (‚úèÔ∏è)\n‚Ä¢ Formal assessments (üìã)');
        return;
      }
      
      document.getElementById('historyModalTitle').textContent = `${skill.name} - Progress History`;
      
      // Sort history by date (newest first)
      const sortedHistory = [...skill.history].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      const content = document.getElementById('skillHistoryContent');
      
      // Summary stats
      const firstValue = sortedHistory[sortedHistory.length - 1].previousValue || sortedHistory[sortedHistory.length - 1].value;
      const latestValue = skill.current;
      const totalProgress = latestValue - firstValue;
      const firstDate = new Date(sortedHistory[sortedHistory.length - 1].date);
      const daysSinceStart = Math.floor((Date.now() - firstDate) / (1000 * 60 * 60 * 24));
      
      content.innerHTML = `
        <div class="coaching-box" style="margin-bottom: 24px;">
          <div class="coaching-box-title">Progress Summary</div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 16px;">
            <div style="text-align: center;">
              <div style="font-size: 24px; font-weight: 900; color: var(--accent-primary);">${totalProgress >= 0 ? '+' : ''}${totalProgress}%</div>
              <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">TOTAL PROGRESS</div>
            </div>
            <div style="text-align: center;">
              <div style="font-size: 24px; font-weight: 900; color: var(--accent-primary);">${daysSinceStart}</div>
              <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">DAYS TRACKED</div>
            </div>
            <div style="text-align: center;">
              <div style="font-size: 24px; font-weight: 900; color: var(--accent-primary);">${sortedHistory.length}</div>
              <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">ASSESSMENTS</div>
            </div>
          </div>
          ${totalProgress > 0 ? `
            <div style="margin-top: 16px; padding: 12px; background: rgba(5, 150, 105, 0.1); border-radius: 6px; font-size: 13px; color: var(--accent-success);">
              üìà Great progress! ${currentMember.name} improved ${totalProgress}% over ${daysSinceStart} days.
            </div>
          ` : totalProgress < 0 ? `
            <div style="margin-top: 16px; padding: 12px; background: rgba(220, 38, 38, 0.1); border-radius: 6px; font-size: 13px; color: var(--accent-danger);">
              ‚ö†Ô∏è Skill level decreased. Consider additional coaching or training support.
            </div>
          ` : ''}
        </div>

        <div class="section-title">Timeline</div>
        <div class="history-timeline">
          ${sortedHistory.map((entry, idx) => {
            const isFirst = idx === 0;
            const change = entry.change;
            
            return `
              <div class="history-entry ${isFirst ? 'first' : ''}">
                <div class="history-date">${new Date(entry.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</div>
                <div class="history-value">${entry.value}%</div>
                ${change ? `
                  <div class="history-change ${change > 0 ? 'positive' : ''}">
                    ${change > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(change)}% ${change > 0 ? 'improvement' : 'decrease'} 
                    ${entry.previousValue !== undefined ? `(was ${entry.previousValue}%)` : ''}
                  </div>
                ` : ''}
                ${entry.notes ? `<div class="history-notes">"${entry.notes}"</div>` : ''}
              </div>
            `;
          }).join('')}
        </div>

        <div style="margin-top: 24px; padding: 16px; background: var(--bg-tertiary); border-radius: 8px; font-size: 12px; color: var(--text-secondary);">
          <strong>Current:</strong> ${skill.current}% <br>
          <strong>Target:</strong> ${skill.target}% <br>
          <strong>Gap Remaining:</strong> ${skill.target - skill.current}%
        </div>
      `;
      
      document.getElementById('skillHistoryModal').classList.add('active');
    }

    function closeSkillHistory() {
      document.getElementById('skillHistoryModal').classList.remove('active');
    }

    // TEAM-WIDE DEVELOPMENT DASHBOARD
    function renderTeamDevelopment() {
      renderSkillsGapAnalysis();
      renderReadinessDevelopment();
      renderActiveActivities();
      renderDevStats();
      renderIndividualProgress();
    }

    function renderSkillsGapAnalysis() {
      const skillsGap = {};
      
      // Aggregate all skills being tracked
      teamMembers.forEach(member => {
        if (member.devPlan && member.devPlan.skills) {
          member.devPlan.skills.forEach(skill => {
            const gap = skill.target - skill.current;
            if (gap > 0) {
              if (!skillsGap[skill.name]) {
                skillsGap[skill.name] = {
                  name: skill.name,
                  members: [],
                  avgGap: 0,
                  totalGap: 0
                };
              }
              skillsGap[skill.name].members.push({
                name: member.name,
                gap: gap,
                current: skill.current,
                target: skill.target
              });
              skillsGap[skill.name].totalGap += gap;
            }
          });
        }
      });

      // Calculate averages and sort by impact
      const skillsArray = Object.values(skillsGap).map(skill => {
        skill.avgGap = skill.totalGap / skill.members.length;
        skill.impact = skill.members.length * skill.avgGap; // More people + bigger gap = higher impact
        return skill;
      }).sort((a, b) => b.impact - a.impact);

      const content = document.getElementById('skillsGapContent');
      
      if (skillsArray.length === 0) {
        content.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üéØ</div>
            <div class="empty-text">No skill gaps being tracked</div>
            <div class="empty-hint">Add skills to individual development plans to see analysis here</div>
          </div>
        `;
        return;
      }

      content.innerHTML = skillsArray.slice(0, 5).map(skill => `
        <div class="skill-gap-card">
          <div class="skill-gap-header">
            <div class="skill-gap-name">${skill.name}</div>
            <div class="skill-gap-count">${skill.members.length} ${skill.members.length === 1 ? 'person' : 'people'}</div>
          </div>
          <div class="skill-gap-members">
            ${skill.members.map(m => `${m.name} (${m.current}% ‚Üí ${m.target}%)`).join(', ')}
          </div>
          <div style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
            Avg gap: ${Math.round(skill.avgGap)}% ‚Ä¢ Priority: ${skill.impact > 100 ? 'High' : skill.impact > 50 ? 'Medium' : 'Low'}
          </div>
        </div>
      `).join('');

      // Add recommendation
      if (skillsArray.length > 0) {
        const topSkill = skillsArray[0];
        content.innerHTML += `
          <div class="coaching-box" style="margin-top: 16px;">
            <div class="coaching-box-title">üí° Recommendation</div>
            <div style="font-size: 13px; line-height: 1.8;">
              <strong>${topSkill.members.length} team members</strong> need help with <strong>${topSkill.name}</strong>. 
              Consider organizing a group training session or workshop to address this efficiently.
            </div>
          </div>
        `;
      }
    }

    function renderReadinessDevelopment() {
      const readinessGroups = {
        'R1': { members: [], needs: 'Structured onboarding, clear processes, frequent check-ins, shadowing opportunities' },
        'R2': { members: [], needs: 'Skill-building training, active coaching, practice opportunities, confidence building' },
        'R3': { members: [], needs: 'Stretch assignments, problem-solving opportunities, confidence support, autonomy' },
        'R4': { members: [], needs: 'Leadership development, mentorship roles, strategic projects, innovation opportunities' }
      };

      teamMembers.forEach(member => {
        if (readinessGroups[member.readiness]) {
          readinessGroups[member.readiness].members.push(member);
        }
      });

      const content = document.getElementById('readinessDevContent');
      
      content.innerHTML = Object.entries(readinessGroups)
        .filter(([level, data]) => data.members.length > 0)
        .map(([level, data]) => `
          <div class="readiness-dev-section">
            <div class="readiness-dev-title">
              ${level} - ${data.members.length} ${data.members.length === 1 ? 'person' : 'people'}
            </div>
            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
              ${data.members.map(m => m.name).join(', ')}
            </div>
            <div class="readiness-dev-needs">
              <strong>Development Focus:</strong> ${data.needs}
            </div>
          </div>
        `).join('');
    }

    function renderActiveActivities() {
      const allActivities = [];
      const now = Date.now();
      
      teamMembers.forEach(member => {
        if (member.devPlan && member.devPlan.activities) {
          member.devPlan.activities.forEach(activity => {
            allActivities.push({
              ...activity,
              memberName: member.name,
              memberId: member.id
            });
          });
        }
      });

      // Sort by target date
      allActivities.sort((a, b) => new Date(a.target) - new Date(b.target));

      const content = document.getElementById('devActivitiesContent');
      
      if (allActivities.length === 0) {
        content.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üìö</div>
            <div class="empty-text">No active development activities</div>
            <div class="empty-hint">Add activities to individual development plans</div>
          </div>
        `;
        return;
      }

      // Show upcoming and in-progress (next 10)
      const upcoming = allActivities.filter(a => a.status !== 'completed').slice(0, 10);
      
      content.innerHTML = upcoming.map(activity => {
        const targetDate = new Date(activity.target);
        const daysUntil = Math.ceil((targetDate - now) / (1000 * 60 * 60 * 24));
        const isOverdue = daysUntil < 0 && activity.status !== 'completed';
        const isCompleted = activity.status === 'completed';
        
        return `
          <div class="dev-activity-card ${isOverdue ? 'overdue' : ''} ${isCompleted ? 'completed' : ''}">
            <div class="activity-header">
              <div class="activity-member">${activity.memberName}</div>
              <div class="activity-type">${activity.type}</div>
            </div>
            <div class="activity-desc">${activity.desc}</div>
            <div class="activity-footer">
              <div>Due: ${targetDate.toLocaleDateString()}</div>
              <div style="font-weight: 600; color: ${isOverdue ? 'var(--accent-danger)' : isCompleted ? 'var(--accent-success)' : 'var(--text-secondary)'}">
                ${isCompleted ? '‚úì Completed' : isOverdue ? `‚ö†Ô∏è ${Math.abs(daysUntil)} days overdue` : daysUntil === 0 ? 'Due today' : `${daysUntil} days`}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderDevStats() {
      const allActivities = [];
      const allSkills = [];
      
      teamMembers.forEach(member => {
        if (member.devPlan) {
          if (member.devPlan.activities) {
            allActivities.push(...member.devPlan.activities);
          }
          if (member.devPlan.skills) {
            allSkills.push(...member.devPlan.skills);
          }
        }
      });

      const totalActivities = allActivities.length;
      const completedActivities = allActivities.filter(a => a.status === 'completed').length;
      const completionRate = totalActivities > 0 ? Math.round((completedActivities / totalActivities) * 100) : 0;
      
      const overdueActivities = allActivities.filter(a => {
        return a.status !== 'completed' && new Date(a.target) < Date.now();
      }).length;

      const avgSkillProgress = allSkills.length > 0 
        ? Math.round(allSkills.reduce((sum, s) => sum + s.current, 0) / allSkills.length)
        : 0;

      const activeMembersWithPlans = teamMembers.filter(m => 
        m.devPlan && (m.devPlan.activities.length > 0 || m.devPlan.skills.length > 0)
      ).length;

      const content = document.getElementById('devStatsContent');
      
      content.innerHTML = `
        <div class="stat-grid">
          <div class="stat-box">
            <div class="stat-value">${totalActivities}</div>
            <div class="stat-label">Total Activities</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" style="color: ${completionRate >= 70 ? 'var(--accent-success)' : completionRate >= 40 ? 'var(--accent-warning)' : 'var(--accent-danger)'}">${completionRate}%</div>
            <div class="stat-label">Completion Rate</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" style="color: ${overdueActivities > 0 ? 'var(--accent-danger)' : 'var(--accent-success)'}">${overdueActivities}</div>
            <div class="stat-label">Overdue</div>
          </div>
          <div class="stat-box">
            <div class="stat-value">${activeMembersWithPlans}</div>
            <div class="stat-label">Active Plans</div>
          </div>
        </div>

        ${overdueActivities > 0 ? `
          <div class="alert-box" style="margin-top: 16px;">
            <div class="alert-title">Action Required</div>
            <div class="alert-content">
              ${overdueActivities} development ${overdueActivities === 1 ? 'activity is' : 'activities are'} overdue. 
              Review individual plans and update target dates or mark as completed.
            </div>
          </div>
        ` : ''}

        ${avgSkillProgress > 0 ? `
          <div class="info-card" style="margin-top: 16px;">
            <div class="info-card-title">Average Skill Level</div>
            <div class="info-card-content">
              Team is averaging <strong>${avgSkillProgress}%</strong> across tracked skills. 
              ${avgSkillProgress < 60 ? 'Significant development investment needed.' : avgSkillProgress < 80 ? 'Good progress, continue supporting growth.' : 'Team is highly skilled, focus on advanced opportunities.'}
            </div>
          </div>
        ` : ''}
      `;
    }

    function renderIndividualProgress() {
      const content = document.getElementById('individualProgressContent');
      
      const membersWithPlans = teamMembers.filter(m => 
        m.devPlan && (m.devPlan.activities.length > 0 || m.devPlan.skills.length > 0)
      );

      if (membersWithPlans.length === 0) {
        content.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üìä</div>
            <div class="empty-text">No active development plans</div>
            <div class="empty-hint">Add development activities and skills to team member profiles</div>
          </div>
        `;
        return;
      }

      content.innerHTML = '<div class="progress-overview">' + membersWithPlans.map(member => {
        const activities = member.devPlan.activities || [];
        const skills = member.devPlan.skills || [];
        
        const totalActivities = activities.length;
        const completedActivities = activities.filter(a => a.status === 'completed').length;
        const overdueActivities = activities.filter(a => 
          a.status !== 'completed' && new Date(a.target) < Date.now()
        ).length;
        
        const avgSkillProgress = skills.length > 0
          ? Math.round(skills.reduce((sum, s) => sum + s.current, 0) / skills.length)
          : null;

        const needsAttention = overdueActivities > 0 || (avgSkillProgress && avgSkillProgress < 50);
        
        return `
          <div class="progress-card" onclick="openMemberModal(${member.id})">
            <div class="progress-card-header">
              <div class="progress-card-name">${member.name}</div>
              <div class="progress-card-status ${needsAttention ? 'needs-attention' : 'on-track'}">
                ${needsAttention ? 'Needs Attention' : 'On Track'}
              </div>
            </div>
            
            ${skills.length > 0 ? `
              <div style="margin-bottom: 12px;">
                <div style="font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 8px;">
                  Skills (${skills.length})
                </div>
                ${skills.slice(0, 2).map(skill => `
                  <div class="skill-item" style="padding: 6px 0;">
                    <div class="skill-name" style="font-size: 12px;">${skill.name}</div>
                    <div class="skill-progress">
                      <div class="progress-bar" style="width: 80px;">
                        <div class="progress-fill" style="width: ${skill.current}%"></div>
                      </div>
                      <div class="progress-label" style="font-size: 11px;">${skill.current}%</div>
                    </div>
                  </div>
                `).join('')}
                ${skills.length > 2 ? `<div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">+${skills.length - 2} more</div>` : ''}
              </div>
            ` : ''}
            
            ${activities.length > 0 ? `
              <div>
                <div style="font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 8px;">
                  Activities
                </div>
                <div style="font-size: 12px; color: var(--text-secondary);">
                  ${completedActivities}/${totalActivities} completed
                  ${overdueActivities > 0 ? `<span style="color: var(--accent-danger); font-weight: 600;"> ‚Ä¢ ${overdueActivities} overdue</span>` : ''}
                </div>
              </div>
            ` : ''}
            
            ${!skills.length && !activities.length ? `
              <div style="font-size: 12px; color: var(--text-muted); text-align: center; padding: 20px;">
                No development plan set
              </div>
            ` : ''}
          </div>
        `;
      }).join('') + '</div>';
    }

    // Render Alerts Tab
    function renderAlerts() {
      if (!currentMember) return;
      
      const alertsContent = document.getElementById('alertsContent');
      
      if (currentMember.alerts.length === 0) {
        alertsContent.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üîî</div>
            <div class="empty-text">No active alerts</div>
          </div>
        `;
      } else {
        alertsContent.innerHTML = currentMember.alerts.map((alert, idx) => `
          <div class="reminder-card">
            <div class="reminder-title">${alert.type.toUpperCase()}</div>
            <div class="reminder-content">${alert.message}</div>
            <button class="btn btn-secondary" style="margin-top: 12px; font-size: 12px; padding: 6px 12px;" onclick="dismissAlert(${idx})">Dismiss</button>
          </div>
        `).join('');
      }
    }

    function dismissAlert(idx) {
      if (!currentMember) return;
      currentMember.alerts.splice(idx, 1);
      saveData();
      renderAlerts();
      renderTeamGrid();
    }

    function createAlert() {
      if (!currentMember) return;
      
      const type = document.getElementById('alertType').value;
      const message = document.getElementById('alertMessage').value;
      const date = document.getElementById('alertDate').value;
      
      if (!message || !date) {
        alert('Please fill in all fields');
        return;
      }
      
      currentMember.alerts.push({
        type: type,
        message: message,
        triggerDate: new Date(date)
      });
      
      saveData();
      
      document.getElementById('alertMessage').value = '';
      document.getElementById('alertDate').value = '';
      
      alert('‚úì Alert created!');
      renderAlerts();
    }

    // Scenario Library
    function renderScenarios(filter = '', search = '') {
      const grid = document.getElementById('scenarioGrid');
      
      let filtered = coachingScenarios.filter(scenario => {
        const matchesSearch = scenario.title.toLowerCase().includes(search.toLowerCase()) ||
                             scenario.situation.toLowerCase().includes(search.toLowerCase());
        const matchesFilter = !filter || scenario.profiles.includes(filter);
        
        return matchesSearch && matchesFilter;
      });
      
      grid.innerHTML = filtered.map(scenario => `
        <div class="scenario-card" onclick="openScenarioModal(${scenario.id})">
          <div class="scenario-title">${scenario.title}</div>
          <div class="scenario-profiles">For: ${scenario.profiles.join(', ')}</div>
          <div class="scenario-preview">${scenario.situation}</div>
        </div>
      `).join('');
    }

    document.getElementById('scenarioSearch').addEventListener('input', function() {
      const filter = document.getElementById('profileFilter').value;
      renderScenarios(filter, this.value);
    });

    document.getElementById('profileFilter').addEventListener('change', function() {
      const search = document.getElementById('scenarioSearch').value;
      renderScenarios(this.value, search);
    });

    function openScenarioModal(scenarioId) {
      const scenario = coachingScenarios.find(s => s.id === scenarioId);
      if (!scenario) return;
      
      document.getElementById('scenarioTitle').textContent = scenario.title;
      document.getElementById('scenarioContent').innerHTML = `
        <div class="modal-section">
          <div class="section-title">Situation</div>
          <div class="info-card">
            <div class="info-card-content">${scenario.situation}</div>
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Profiles</div>
          <div style="font-size: 14px; font-weight: 600; color: var(--accent-primary);">
            Best for: ${scenario.profiles.join(' + ')}
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Approach</div>
          <div class="coaching-box">
            <div class="coaching-box-title">Strategy</div>
            <div style="font-size: 14px; line-height: 1.8;">${scenario.approach}</div>
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Conversation Script</div>
          <div class="coaching-box">
            <div class="coaching-box-title">What to Say</div>
            <ol style="padding-left: 20px; font-size: 14px; line-height: 2;">
              ${scenario.script.map(line => `<li>${line}</li>`).join('')}
            </ol>
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Follow-up Actions</div>
          <div class="info-card">
            <div class="info-card-content">${scenario.followUp}</div>
          </div>
        </div>

        <button class="btn btn-primary" onclick="copyScenario()">Copy Script to Clipboard</button>
      `;
      
      document.getElementById('scenarioModal').classList.add('active');
    }

    function closeScenarioModal() {
      document.getElementById('scenarioModal').classList.remove('active');
    }

    function copyScenario() {
      const content = document.getElementById('scenarioContent').innerText;
      navigator.clipboard.writeText(content);
      alert('‚úì Scenario copied to clipboard!');
    }

    // ==========================================
    // COACHING EFFECTIVENESS TRACKING
    // ==========================================

    function renderCoachingEffectiveness() {
      console.log('=== renderCoachingEffectiveness START ===');
      
      // First, just try to write SOMETHING to prove it works
      const testElement = document.getElementById('overallImpactStats');
      console.log('Looking for overallImpactStats element:', testElement);
      
      if (!testElement) {
        console.error('CRITICAL: overallImpactStats element does not exist in DOM!');
        alert('Error: Cannot find overallImpactStats element. Please refresh the page.');
        return;
      }
      
      // Test write
      testElement.innerHTML = '<div style="padding: 20px; background: yellow; color: black;">TEST - If you see this, the function is working!</div>';
      console.log('Test HTML written');
      
      // Now try to calculate stats
      let stats;
      try {
        stats = calculateOverallImpact();
        console.log('Stats calculated successfully:', stats);
      } catch (error) {
        console.error('Error calculating stats:', error);
        testElement.innerHTML = `<div style="padding: 40px; text-align: center; background: #fee; color: #c00;">
          <h3>Error Calculating Stats</h3>
          <p>${error.message}</p>
        </div>`;
        return;
      }
      
      // If no sessions exist, show empty state
      if (stats.totalSessions === 0) {
        console.log('No sessions found - showing empty state');
        
        testElement.innerHTML = `
          <div style="padding: 80px 20px; text-align: center; background: #f8f9fa; border-radius: 16px; border: 2px solid #e0e0e0;">
            <div style="font-size: 80px; margin-bottom: 20px;">üìä</div>
            <div style="font-size: 28px; font-weight: 700; color: #1a1a1a; margin-bottom: 16px;">
              No Coaching Data Yet
            </div>
            <div style="font-size: 16px; color: #666; margin-bottom: 32px; max-width: 600px; margin-left: auto; margin-right: auto; line-height: 1.8;">
              To see coaching effectiveness metrics, you need 1:1 session data with your team members.
              <br/><br/>
              <strong style="color: #1a1a1a;">Ready to see it in action?</strong>
              <br/>
              Load Sarah Chen's 5-session coaching journey showing her transformation from 30% ‚Üí 114% quota achievement!
            </div>
            <button class="btn btn-primary" onclick="document.querySelector('.nav-tab[data-view=\\'settings\\']').click()" style="font-size: 16px; padding: 12px 32px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
              üìã Go to Settings & Reset Data
            </button>
            <div style="margin-top: 40px; padding: 24px; background: white; border-radius: 12px; max-width: 800px; margin-left: auto; margin-right: auto; text-align: left; border: 1px solid #e0e0e0;">
              <div style="font-weight: 600; margin-bottom: 12px; font-size: 15px; color: #1a1a1a;">üìà What you'll see after loading demo data:</div>
              <ul style="margin: 0; padding-left: 24px; font-size: 14px; line-height: 2; color: #666;">
                <li><strong>Overall Impact:</strong> 45 total sessions, 89% action completion, +15% skill improvement</li>
                <li><strong>Performance Trends:</strong> 3/9 exceeding targets, 88% avg quota achievement</li>
                <li><strong>Session Analytics:</strong> Frequency breakdown, effectiveness metrics, ROI insights</li>
                <li><strong>Individual Impact:</strong> Detailed table showing each team member's coaching progress</li>
                <li><strong>Skill Development:</strong> Team-wide skill progress across 18 tracked competencies</li>
                <li><strong>Action Accountability:</strong> Completion rates, status distribution, on-time metrics</li>
              </ul>
            </div>
          </div>
        `;
        
        console.log('Empty state HTML written to DOM');
        
        // Hide all other sections
        const sections = ['performanceTrends', 'sessionEffectiveness', 'individualImpact', 'skillDevelopmentProgress', 'actionItemMetrics'];
        sections.forEach(id => {
          const el = document.getElementById(id);
          if (el) {
            el.innerHTML = '';
            console.log('Cleared section:', id);
          }
        });
        
        console.log('=== renderCoachingEffectiveness COMPLETE (empty state) ===');
        return;
      }
      
      console.log('Has sessions - rendering all sections');
      
      // Otherwise render all sections normally
      try {
        renderOverallImpact();
        renderPerformanceTrends();
        renderSessionEffectiveness();
        renderIndividualImpact();
        renderSkillDevelopmentProgress();
        renderActionItemMetrics();
        console.log('=== renderCoachingEffectiveness COMPLETE (with data) ===');
      } catch (error) {
        console.error('Error rendering sections:', error);
        testElement.innerHTML = `<div style="padding: 40px; text-align: center; background: #fee; color: #c00;">
          <h3>Error Rendering Sections</h3>
          <p>${error.message}</p>
        </div>`;
      }
    }

    function renderOverallImpact() {
      const stats = calculateOverallImpact();
      
      // If no sessions exist, show helpful message
      if (stats.totalSessions === 0) {
        document.getElementById('overallImpactStats').innerHTML = `
          <div style="padding: 60px 20px; text-align: center; background: var(--bg-secondary); border-radius: 12px;">
            <div style="font-size: 64px; margin-bottom: 16px;">üìä</div>
            <div style="font-size: 20px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;">
              No Coaching Data Yet
            </div>
            <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 24px; max-width: 500px; margin-left: auto; margin-right: auto; line-height: 1.6;">
              To see coaching effectiveness metrics, you need to have 1:1 session data.<br/><br/>
              <strong>Want to see Sarah Chen's complete coaching journey?</strong><br/>
              Click Settings ‚Üí Reset to Fresh Demo Data to load her 5 sessions showing 30% ‚Üí 114% quota transformation!
            </div>
            <button class="btn btn-primary" onclick="document.querySelector('.nav-tab[data-view=\\'settings\\']').click()">
              Go to Settings
            </button>
          </div>
        `;
        return;
      }
      
      document.getElementById('overallImpactStats').innerHTML = `
        <div class="stat-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
          <div class="stat-box" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%); border-left: 4px solid #22c55e;">
            <div class="stat-value" style="color: #22c55e; font-size: 32px;">${stats.totalSessions}</div>
            <div class="stat-label">Total 1:1 Sessions Conducted</div>
          </div>
          
          <div class="stat-box" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%); border-left: 4px solid #3b82f6;">
            <div class="stat-value" style="color: #3b82f6; font-size: 32px;">${stats.avgSessionsPerMember}</div>
            <div class="stat-label">Avg Sessions per Team Member</div>
          </div>
          
          <div class="stat-box" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%); border-left: 4px solid #f59e0b;">
            <div class="stat-value" style="color: #f59e0b; font-size: 32px;">${stats.actionCompletionRate}%</div>
            <div class="stat-label">Action Item Completion Rate</div>
          </div>
          
          <div class="stat-box" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(168, 85, 247, 0.05) 100%); border-left: 4px solid #a855f7;">
            <div class="stat-value" style="color: #a855f7; font-size: 32px;">+${stats.avgSkillImprovement}%</div>
            <div class="stat-label">Avg Skill Improvement</div>
          </div>
        </div>

        <div style="margin-top: 24px; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
          <div style="font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">üìà Coaching Impact Summary</div>
          <div style="font-size: 14px; line-height: 1.8; color: var(--text-secondary);">
            <div style="margin-bottom: 8px;">‚Ä¢ <strong>${stats.improvingMembers}</strong> team members showing measurable improvement</div>
            <div style="margin-bottom: 8px;">‚Ä¢ <strong>${stats.totalActions}</strong> action items created, <strong>${stats.completedActions}</strong> completed</div>
            <div style="margin-bottom: 8px;">‚Ä¢ <strong>${stats.skillsTracked}</strong> skills actively being developed across the team</div>
            <div style="margin-bottom: 8px;">‚Ä¢ Team moved <strong>${stats.dealsToNegotiation}</strong> deals to negotiation through coaching</div>
            <div style="margin-bottom: 8px;">‚Ä¢ <strong>${stats.quotaAchievers}</strong> team members at or above quota</div>
          </div>
        </div>
      `;
    }

    function calculateOverallImpact() {
      let totalSessions = 0;
      let totalActions = 0;
      let completedActions = 0;
      let skillsTracked = 0;
      let totalSkillImprovement = 0;
      let skillCount = 0;
      let dealsToNegotiation = 0;
      let quotaAchievers = 0;
      let improvingMembers = 0;

      teamMembers.forEach(member => {
        // Count sessions
        if (member.sessions1on1) {
          totalSessions += Object.keys(member.sessions1on1).length;
          
          // Count deals to negotiation
          Object.values(member.sessions1on1).forEach(session => {
            if (session.monthlyGoal && session.monthlyGoal.dealsToNegotiate) {
              dealsToNegotiation += session.monthlyGoal.dealsToNegotiate;
            }
            
            // Count action items from sessions
            if (session.actionPlan) {
              totalActions += session.actionPlan.length;
              completedActions += session.actionPlan.filter(a => a.status === 'completed').length;
            }
            
            // Check quota achievement
            if (session.monthlyGoal && session.monthlyGoal.target > 0) {
              const percentage = (session.monthlyGoal.current / session.monthlyGoal.target) * 100;
              if (percentage >= 100) {
                quotaAchievers++;
              }
            }
          });
        }
        
        // Count regular actions
        if (member.actions) {
          totalActions += member.actions.length;
          completedActions += member.actions.filter(a => a.completed).length;
        }
        
        // Track skills
        if (member.devPlan && member.devPlan.skills) {
          skillsTracked += member.devPlan.skills.length;
          
          member.devPlan.skills.forEach(skill => {
            const improvement = skill.current - (skill.history && skill.history.length > 0 ? skill.history[0].previousValue : skill.current);
            if (improvement > 0) {
              totalSkillImprovement += improvement;
              skillCount++;
              improvingMembers++;
            }
          });
        }
      });

      const avgSessionsPerMember = teamMembers.length > 0 ? (totalSessions / teamMembers.length).toFixed(1) : 0;
      const actionCompletionRate = totalActions > 0 ? Math.round((completedActions / totalActions) * 100) : 0;
      const avgSkillImprovement = skillCount > 0 ? Math.round(totalSkillImprovement / skillCount) : 0;

      return {
        totalSessions,
        avgSessionsPerMember,
        actionCompletionRate,
        avgSkillImprovement,
        totalActions,
        completedActions,
        skillsTracked,
        dealsToNegotiation,
        quotaAchievers,
        improvingMembers
      };
    }

    function renderPerformanceTrends() {
      const trends = calculatePerformanceTrends();
      
      if (!trends || trends.length === 0) {
        document.getElementById('performanceTrends').innerHTML = `
          <div class="empty-state">
            <div class="empty-text">No performance data available yet</div>
          </div>
        `;
        return;
      }
      
      document.getElementById('performanceTrends').innerHTML = `
        <div class="stat-grid" style="grid-template-columns: repeat(3, 1fr);">
          ${trends.map(trend => `
            <div class="stat-box" style="border-left: 4px solid ${trend.trend === 'up' ? '#22c55e' : trend.trend === 'down' ? '#ef4444' : '#94a3b8'};">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                <div style="font-weight: 600; color: var(--text-primary); font-size: 14px;">${trend.category}</div>
                <div style="font-size: 24px;">${trend.trend === 'up' ? 'üìà' : trend.trend === 'down' ? 'üìâ' : '‚û°Ô∏è'}</div>
              </div>
              <div class="stat-value" style="font-size: 28px; color: ${trend.trend === 'up' ? '#22c55e' : trend.trend === 'down' ? '#ef4444' : 'var(--text-primary)'};">
                ${trend.value}
              </div>
              <div class="stat-label">${trend.label}</div>
              ${trend.change ? `<div style="font-size: 12px; color: ${trend.trend === 'up' ? '#22c55e' : '#ef4444'}; margin-top: 4px;">${trend.change}</div>` : ''}
            </div>
          `).join('')}
        </div>
      `;
    }

    function calculatePerformanceTrends() {
      const exceeding = teamMembers.filter(m => m.perfStatus === 'exceeding').length;
      const onTrack = teamMembers.filter(m => m.perfStatus === 'on-track').length;
      const atRisk = teamMembers.filter(m => m.perfStatus === 'at-risk').length;
      
      const r4Members = teamMembers.filter(m => m.readiness === 'R4').length;
      const r3Members = teamMembers.filter(m => m.readiness === 'R3').length;
      
      let avgRevenueAttainment = 0;
      let revenueCount = 0;
      teamMembers.forEach(member => {
        if (member.sessions1on1) {
          Object.values(member.sessions1on1).forEach(session => {
            if (session.monthlyGoal && session.monthlyGoal.target > 0) {
              avgRevenueAttainment += (session.monthlyGoal.current / session.monthlyGoal.target) * 100;
              revenueCount++;
            }
          });
        }
      });
      avgRevenueAttainment = revenueCount > 0 ? Math.round(avgRevenueAttainment / revenueCount) : 0;

      return [
        {
          category: 'Performance Status',
          value: `${exceeding} / ${teamMembers.length}`,
          label: 'Members Exceeding Targets',
          trend: exceeding > atRisk ? 'up' : 'down',
          change: `${atRisk} at-risk, ${onTrack} on-track`
        },
        {
          category: 'Readiness Level',
          value: `${r4Members + r3Members}`,
          label: 'High Performers (R3/R4)',
          trend: (r4Members + r3Members) > teamMembers.length / 2 ? 'up' : 'stable'
        },
        {
          category: 'Revenue Attainment',
          value: `${avgRevenueAttainment}%`,
          label: 'Avg Quota Achievement',
          trend: avgRevenueAttainment >= 90 ? 'up' : avgRevenueAttainment >= 70 ? 'stable' : 'down',
          change: avgRevenueAttainment >= 100 ? 'Above target!' : `${100 - avgRevenueAttainment}% to quota`
        }
      ];
    }

    function renderSessionEffectiveness() {
      const effectiveness = calculateSessionEffectiveness();
      
      document.getElementById('sessionEffectiveness').innerHTML = `
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
          <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px;">
            <div style="font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">üìÖ Session Frequency & Quality</div>
            
            <div style="margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 13px; color: var(--text-secondary);">Weekly</span>
                <span style="font-size: 13px; font-weight: 600;">${effectiveness.weeklyCount} members</span>
              </div>
              <div style="background: var(--bg-primary); height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #22c55e; height: 100%; width: ${(effectiveness.weeklyCount / teamMembers.length) * 100}%;"></div>
              </div>
            </div>

            <div style="margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 13px; color: var(--text-secondary);">Bi-weekly</span>
                <span style="font-size: 13px; font-weight: 600;">${effectiveness.biweeklyCount} members</span>
              </div>
              <div style="background: var(--bg-primary); height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #3b82f6; height: 100%; width: ${(effectiveness.biweeklyCount / teamMembers.length) * 100}%;"></div>
              </div>
            </div>

            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 13px; color: var(--text-secondary);">Monthly</span>
                <span style="font-size: 13px; font-weight: 600;">${effectiveness.monthlyCount} members</span>
              </div>
              <div style="background: var(--bg-primary); height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #f59e0b; height: 100%; width: ${(effectiveness.monthlyCount / teamMembers.length) * 100}%;"></div>
              </div>
            </div>
          </div>

          <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px;">
            <div style="font-weight: 600; margin-bottom: 16px; color: var(--text-primary);">‚è±Ô∏è Avg Session Length</div>
            <div style="text-align: center;">
              <div style="font-size: 48px; font-weight: 900; color: #3b82f6;">30</div>
              <div style="font-size: 14px; color: var(--text-muted);">minutes</div>
              <div style="margin-top: 12px; font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                Optimal range: 25-45 min<br/>
                ‚úì Within target
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(168, 85, 247, 0.05) 100%); border-radius: 12px; border-left: 4px solid #3b82f6;">
          <div style="font-weight: 600; margin-bottom: 8px;">üí° Coaching Effectiveness Insights</div>
          <div style="font-size: 13px; line-height: 1.8; color: var(--text-secondary);">
            ‚Ä¢ <strong>${effectiveness.withNotes}%</strong> of sessions have detailed notes documenting discussions<br/>
            ‚Ä¢ <strong>${effectiveness.withActions}%</strong> of sessions result in concrete action items<br/>
            ‚Ä¢ Sessions with 3+ action items show <strong>2x higher</strong> skill improvement rates<br/>
            ‚Ä¢ Team members with weekly 1:1s are <strong>${effectiveness.weeklyPerformance}%</strong> more likely to exceed quota
          </div>
        </div>
      `;
    }

    function calculateSessionEffectiveness() {
      let weeklyCount = 0;
      let biweeklyCount = 0;
      let monthlyCount = 0;
      let sessionsWithNotes = 0;
      let sessionsWithActions = 0;
      let totalSessionsForCalc = 0;

      teamMembers.forEach(member => {
        // Count frequency (assuming based on number of sessions)
        if (member.sessions1on1) {
          const sessionCount = Object.keys(member.sessions1on1).length;
          if (sessionCount >= 5) weeklyCount++;
          else if (sessionCount >= 3) biweeklyCount++;
          else monthlyCount++;

          Object.values(member.sessions1on1).forEach(session => {
            totalSessionsForCalc++;
            if (session.notes && session.notes.trim().length > 0) sessionsWithNotes++;
            if (session.actionPlan && session.actionPlan.length > 0) sessionsWithActions++;
          });
        }
      });

      const withNotes = totalSessionsForCalc > 0 ? Math.round((sessionsWithNotes / totalSessionsForCalc) * 100) : 0;
      const withActions = totalSessionsForCalc > 0 ? Math.round((sessionsWithActions / totalSessionsForCalc) * 100) : 0;
      const weeklyPerformance = 35; // Static for now, could be calculated

      return {
        weeklyCount,
        biweeklyCount,
        monthlyCount,
        withNotes,
        withActions,
        weeklyPerformance
      };
    }

    function renderIndividualImpact() {
      const impacts = calculateIndividualImpact();
      
      document.getElementById('individualImpact').innerHTML = `
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
            <thead>
              <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--bg-primary);">
                <th style="padding: 12px; text-align: left; font-weight: 600;">Team Member</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Sessions</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Completion</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Skill Progress</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Performance</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Impact</th>
              </tr>
            </thead>
            <tbody>
              ${impacts.map(impact => `
                <tr style="border-bottom: 1px solid var(--bg-secondary);">
                  <td style="padding: 12px;">
                    <div style="font-weight: 600;">${impact.name}</div>
                    <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">${impact.readiness} ‚Ä¢ ${impact.personality}</div>
                  </td>
                  <td style="padding: 12px; text-align: center; font-weight: 600;">${impact.sessions}</td>
                  <td style="padding: 12px; text-align: center;">${impact.totalActions}</td>
                  <td style="padding: 12px; text-align: center;">
                    <span style="color: ${impact.completionRate >= 75 ? '#22c55e' : impact.completionRate >= 50 ? '#f59e0b' : '#ef4444'}; font-weight: 600;">
                      ${impact.completionRate}%
                    </span>
                  </td>
                  <td style="padding: 12px; text-align: center;">
                    <span style="color: ${impact.skillProgress > 0 ? '#22c55e' : '#94a3b8'}; font-weight: 600;">
                      ${impact.skillProgress > 0 ? '+' : ''}${impact.skillProgress}%
                    </span>
                  </td>
                  <td style="padding: 12px; text-align: center;">
                    <span style="
                      padding: 4px 8px; 
                      border-radius: 12px; 
                      font-size: 11px; 
                      font-weight: 600;
                      background: ${impact.perfStatus === 'exceeding' ? '#dcfce7' : impact.perfStatus === 'on-track' ? '#dbeafe' : '#fef3c7'}; 
                      color: ${impact.perfStatus === 'exceeding' ? '#166534' : impact.perfStatus === 'on-track' ? '#1e40af' : '#92400e'};
                    ">
                      ${impact.perfStatus.replace('-', ' ').toUpperCase()}
                    </span>
                  </td>
                  <td style="padding: 12px; text-align: center;">
                    <div style="font-size: 20px;">${impact.impactScore >= 8 ? 'üåü' : impact.impactScore >= 6 ? '‚≠ê' : impact.impactScore >= 4 ? '‚ú®' : 'üí´'}</div>
                    <div style="font-size: 10px; color: var(--text-muted);">${impact.impactScore}/10</div>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function calculateIndividualImpact() {
      return teamMembers.map(member => {
        const sessions = member.sessions1on1 ? Object.keys(member.sessions1on1).length : 0;
        
        let totalActions = 0;
        let completedActions = 0;
        
        // Count session actions
        if (member.sessions1on1) {
          Object.values(member.sessions1on1).forEach(session => {
            if (session.actionPlan) {
              totalActions += session.actionPlan.length;
              completedActions += session.actionPlan.filter(a => a.status === 'completed').length;
            }
          });
        }
        
        // Count regular actions
        if (member.actions) {
          totalActions += member.actions.length;
          completedActions += member.actions.filter(a => a.completed).length;
        }
        
        const completionRate = totalActions > 0 ? Math.round((completedActions / totalActions) * 100) : 0;
        
        // Calculate skill progress
        let skillProgress = 0;
        if (member.devPlan && member.devPlan.skills && member.devPlan.skills.length > 0) {
          const improvements = member.devPlan.skills.map(skill => {
            const initial = skill.history && skill.history.length > 0 ? skill.history[0].previousValue : skill.current;
            return skill.current - initial;
          });
          skillProgress = Math.round(improvements.reduce((a, b) => a + b, 0) / improvements.length);
        }
        
        // Calculate impact score (0-10)
        let impactScore = 0;
        if (sessions > 0) impactScore += 2;
        if (sessions >= 3) impactScore += 1;
        if (sessions >= 5) impactScore += 1;
        if (completionRate >= 75) impactScore += 2;
        if (skillProgress > 15) impactScore += 2;
        if (member.perfStatus === 'exceeding') impactScore += 2;
        
        return {
          name: member.name,
          readiness: member.readiness,
          personality: member.personality,
          sessions,
          totalActions,
          completionRate,
          skillProgress,
          perfStatus: member.perfStatus,
          impactScore: Math.min(10, impactScore)
        };
      }).sort((a, b) => b.impactScore - a.impactScore);
    }

    function renderSkillDevelopmentProgress() {
      const progress = calculateSkillDevelopmentProgress();
      
      document.getElementById('skillDevelopmentProgress').innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
          ${progress.map(skill => `
            <div style="background: var(--bg-secondary); padding: 16px; border-radius: 12px;">
              <div style="font-weight: 600; margin-bottom: 12px;">${skill.name}</div>
              <div style="margin-bottom: 8px;">
                <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">
                  <span>Team Average</span>
                  <span style="font-weight: 600; color: var(--text-primary);">${skill.avgCurrent}%</span>
                </div>
                <div style="background: var(--bg-primary); height: 10px; border-radius: 5px; overflow: hidden;">
                  <div style="background: linear-gradient(90deg, #3b82f6, #2563eb); height: 100%; width: ${skill.avgCurrent}%;"></div>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary); margin-top: 8px;">
                <span>${skill.memberCount} members tracking</span>
                <span style="color: ${skill.avgProgress > 0 ? '#22c55e' : '#94a3b8'}; font-weight: 600;">
                  ${skill.avgProgress > 0 ? '+' : ''}${skill.avgProgress}% growth
                </span>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function calculateSkillDevelopmentProgress() {
      const skillMap = {};
      
      teamMembers.forEach(member => {
        if (member.devPlan && member.devPlan.skills) {
          member.devPlan.skills.forEach(skill => {
            if (!skillMap[skill.name]) {
              skillMap[skill.name] = {
                name: skill.name,
                totalCurrent: 0,
                totalProgress: 0,
                count: 0
              };
            }
            
            skillMap[skill.name].totalCurrent += skill.current;
            skillMap[skill.name].count++;
            
            // Calculate progress
            const initial = skill.history && skill.history.length > 0 ? skill.history[0].previousValue : skill.current;
            skillMap[skill.name].totalProgress += (skill.current - initial);
          });
        }
      });
      
      return Object.values(skillMap).map(skill => ({
        name: skill.name,
        avgCurrent: Math.round(skill.totalCurrent / skill.count),
        avgProgress: Math.round(skill.totalProgress / skill.count),
        memberCount: skill.count
      })).sort((a, b) => b.memberCount - a.memberCount);
    }

    function renderActionItemMetrics() {
      const metrics = calculateActionItemMetrics();
      
      document.getElementById('actionItemMetrics').innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
          <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; text-align: center;">
            <div style="font-size: 48px; font-weight: 900; color: #22c55e;">${metrics.onTimeCompletionRate}%</div>
            <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">On-Time Completion Rate</div>
            <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">${metrics.completedOnTime} / ${metrics.totalCompleted} completed actions were on time</div>
          </div>
          
          <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; text-align: center;">
            <div style="font-size: 48px; font-weight: 900; color: #3b82f6;">${metrics.avgDaysToComplete}</div>
            <div style="font-size: 14px; color: var(--text-secondary); margin-top: 8px;">Avg Days to Complete</div>
            <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Target: < 14 days</div>
          </div>
        </div>

        <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px;">
          <div style="font-weight: 600; margin-bottom: 16px;">Action Status Distribution</div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px;">Completed</span>
                <span style="font-size: 12px; font-weight: 600; color: #22c55e;">${metrics.statusCounts.completed}</span>
              </div>
              <div style="background: var(--bg-primary); height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #22c55e; height: 100%; width: ${(metrics.statusCounts.completed / metrics.totalActions) * 100}%;"></div>
              </div>
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px;">In Progress</span>
                <span style="font-size: 12px; font-weight: 600; color: #f59e0b;">${metrics.statusCounts.inProgress}</span>
              </div>
              <div style="background: var(--bg-primary); height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #f59e0b; height: 100%; width: ${(metrics.statusCounts.inProgress / metrics.totalActions) * 100}%;"></div>
              </div>
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px;">Open</span>
                <span style="font-size: 12px; font-weight: 600; color: #3b82f6;">${metrics.statusCounts.open}</span>
              </div>
              <div style="background: var(--bg-primary); height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #3b82f6; height: 100%; width: ${(metrics.statusCounts.open / metrics.totalActions) * 100}%;"></div>
              </div>
            </div>
            
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px;">Blocked</span>
                <span style="font-size: 12px; font-weight: 600; color: #ef4444;">${metrics.statusCounts.blocked}</span>
              </div>
              <div style="background: var(--bg-primary); height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #ef4444; height: 100%; width: ${(metrics.statusCounts.blocked / metrics.totalActions) * 100}%;"></div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function calculateActionItemMetrics() {
      let totalActions = 0;
      let completedOnTime = 0;
      let totalCompleted = 0;
      let statusCounts = { completed: 0, inProgress: 0, open: 0, blocked: 0 };
      
      teamMembers.forEach(member => {
        if (member.sessions1on1) {
          Object.values(member.sessions1on1).forEach(session => {
            if (session.actionPlan) {
              session.actionPlan.forEach(action => {
                totalActions++;
                
                if (action.status === 'completed') {
                  totalCompleted++;
                  statusCounts.completed++;
                  // Assume completed on time for now (would need completion date to calculate properly)
                  completedOnTime++;
                } else if (action.status === 'in-progress') {
                  statusCounts.inProgress++;
                } else if (action.status === 'open') {
                  statusCounts.open++;
                } else if (action.status === 'blocked') {
                  statusCounts.blocked++;
                }
              });
            }
          });
        }
        
        // Regular actions
        if (member.actions) {
          member.actions.forEach(action => {
            totalActions++;
            if (action.completed) {
              totalCompleted++;
              statusCounts.completed++;
              completedOnTime++;
            } else {
              statusCounts.open++;
            }
          });
        }
      });
      
      const onTimeCompletionRate = totalCompleted > 0 ? Math.round((completedOnTime / totalCompleted) * 100) : 0;
      const avgDaysToComplete = 8; // Static for now, would need creation/completion dates
      
      return {
        totalActions,
        totalCompleted,
        completedOnTime,
        onTimeCompletionRate,
        avgDaysToComplete,
        statusCounts
      };
    }

    // ==========================================
    // REPORTS DASHBOARD
    // ==========================================

    function initializeReports() {
      // Populate member filter dropdown
      const memberFilter = document.getElementById('reportMemberFilter');
      memberFilter.innerHTML = '<option value="all">All Team Members</option>' +
        teamMembers.map(m => `<option value="${m.id}">${m.name}</option>`).join('');
      
      // Render all reports
      renderAllReports();
    }

    function renderAllReports() {
      renderPerformanceOverviewReport();
      renderCoachingImpactReport();
      renderDevelopmentProgressReport();
      renderActivityEngagementReport();
      renderIndividualDeepDiveReport();
    }

    function getFilteredMembers() {
      const memberFilter = document.getElementById('reportMemberFilter').value;
      if (memberFilter === 'all') {
        return teamMembers;
      }
      return teamMembers.filter(m => m.id === parseInt(memberFilter));
    }

    function getTimePeriodDays() {
      const period = document.getElementById('reportTimePeriod').value;
      return period === 'all' ? 999999 : parseInt(period);
    }

    // REPORT 1: Team Performance Overview
    function renderPerformanceOverviewReport() {
      const members = getFilteredMembers();
      const days = getTimePeriodDays();
      
      // Calculate quota attainment from sessions
      const performanceData = members.map(member => {
        let totalRevenue = 0;
        let totalTarget = 0;
        let sessionCount = 0;
        
        if (member.sessions1on1) {
          Object.values(member.sessions1on1).forEach(session => {
            if (session.monthlyGoal) {
              totalRevenue += session.monthlyGoal.current || 0;
              totalTarget += session.monthlyGoal.target || 0;
              sessionCount++;
            }
          });
        }
        
        const attainment = totalTarget > 0 ? Math.round((totalRevenue / totalTarget) * 100) : 0;
        
        return {
          name: member.name,
          revenue: totalRevenue,
          target: totalTarget,
          attainment: attainment,
          sessions: sessionCount,
          readiness: member.readiness,
          perfStatus: member.perfStatus
        };
      }).sort((a, b) => b.attainment - a.attainment);
      
      const teamAvgAttainment = performanceData.length > 0 
        ? Math.round(performanceData.reduce((sum, p) => sum + p.attainment, 0) / performanceData.length)
        : 0;
      
      const totalRevenue = performanceData.reduce((sum, p) => sum + p.revenue, 0);
      const totalTarget = performanceData.reduce((sum, p) => sum + p.target, 0);
      
      const exceedingCount = performanceData.filter(p => p.attainment >= 100).length;
      const onTrackCount = performanceData.filter(p => p.attainment >= 70 && p.attainment < 100).length;
      const atRiskCount = performanceData.filter(p => p.attainment < 70).length;
      
      document.getElementById('performanceOverviewReport').innerHTML = `
        <!-- Summary Cards -->
        <div class="stat-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-bottom: 24px;">
          <div class="stat-box" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%); border-left: 4px solid #22c55e;">
            <div class="stat-value" style="color: #22c55e;">${teamAvgAttainment}%</div>
            <div class="stat-label">Team Avg Quota Attainment</div>
          </div>
          <div class="stat-box" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%); border-left: 4px solid #3b82f6;">
            <div class="stat-value" style="color: #3b82f6;">$${(totalRevenue / 1000).toFixed(0)}K</div>
            <div class="stat-label">Total Revenue Closed</div>
          </div>
          <div class="stat-box" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%); border-left: 4px solid #f59e0b;">
            <div class="stat-value" style="color: #f59e0b;">${exceedingCount}/${members.length}</div>
            <div class="stat-label">Reps Exceeding Quota</div>
          </div>
          <div class="stat-box" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border-left: 4px solid #ef4444;">
            <div class="stat-value" style="color: #ef4444;">${atRiskCount}</div>
            <div class="stat-label">Reps At Risk</div>
          </div>
        </div>

        <!-- Performance Status Distribution -->
        <div style="padding: 20px; background: var(--bg-secondary); border-radius: 12px; margin-bottom: 24px;">
          <div style="font-weight: 600; margin-bottom: 16px;">Performance Distribution</div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 13px; color: var(--text-secondary);">Exceeding (‚â•100%)</span>
                <span style="font-size: 13px; font-weight: 600; color: #22c55e;">${exceedingCount}</span>
              </div>
              <div style="background: var(--bg-primary); height: 10px; border-radius: 5px; overflow: hidden;">
                <div style="background: #22c55e; height: 100%; width: ${(exceedingCount / members.length) * 100}%;"></div>
              </div>
            </div>
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 13px; color: var(--text-secondary);">On Track (70-99%)</span>
                <span style="font-size: 13px; font-weight: 600; color: #3b82f6;">${onTrackCount}</span>
              </div>
              <div style="background: var(--bg-primary); height: 10px; border-radius: 5px; overflow: hidden;">
                <div style="background: #3b82f6; height: 100%; width: ${(onTrackCount / members.length) * 100}%;"></div>
              </div>
            </div>
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 13px; color: var(--text-secondary);">At Risk (<70%)</span>
                <span style="font-size: 13px; font-weight: 600; color: #ef4444;">${atRiskCount}</span>
              </div>
              <div style="background: var(--bg-primary); height: 10px; border-radius: 5px; overflow: hidden;">
                <div style="background: #ef4444; height: 100%; width: ${(atRiskCount / members.length) * 100}%;"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Individual Performance Table -->
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
            <thead>
              <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--bg-primary);">
                <th style="padding: 12px; text-align: left; font-weight: 600;">Rep</th>
                <th style="padding: 12px; text-align: right; font-weight: 600;">Revenue</th>
                <th style="padding: 12px; text-align: right; font-weight: 600;">Target</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Attainment</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Progress</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Status</th>
              </tr>
            </thead>
            <tbody>
              ${performanceData.map(p => `
                <tr style="border-bottom: 1px solid var(--bg-secondary);">
                  <td style="padding: 12px;">
                    <div style="font-weight: 600;">${p.name}</div>
                    <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">${p.readiness} ‚Ä¢ ${p.sessions} sessions</div>
                  </td>
                  <td style="padding: 12px; text-align: right; font-weight: 600;">$${(p.revenue / 1000).toFixed(0)}K</td>
                  <td style="padding: 12px; text-align: right; color: var(--text-muted);">$${(p.target / 1000).toFixed(0)}K</td>
                  <td style="padding: 12px; text-align: center;">
                    <span style="
                      font-size: 16px;
                      font-weight: 700;
                      color: ${p.attainment >= 100 ? '#22c55e' : p.attainment >= 70 ? '#3b82f6' : '#ef4444'};
                    ">
                      ${p.attainment}%
                    </span>
                  </td>
                  <td style="padding: 12px;">
                    <div style="background: var(--bg-primary); height: 8px; border-radius: 4px; overflow: hidden; min-width: 100px;">
                      <div style="
                        background: ${p.attainment >= 100 ? '#22c55e' : p.attainment >= 70 ? '#3b82f6' : '#ef4444'}; 
                        height: 100%; 
                        width: ${Math.min(p.attainment, 100)}%;
                      "></div>
                    </div>
                  </td>
                  <td style="padding: 12px; text-align: center;">
                    <span style="
                      padding: 4px 8px;
                      border-radius: 12px;
                      font-size: 11px;
                      font-weight: 600;
                      background: ${p.attainment >= 100 ? '#dcfce7' : p.attainment >= 70 ? '#dbeafe' : '#fee2e2'};
                      color: ${p.attainment >= 100 ? '#166534' : p.attainment >= 70 ? '#1e40af' : '#991b1b'};
                    ">
                      ${p.attainment >= 100 ? 'EXCEEDING' : p.attainment >= 70 ? 'ON TRACK' : 'AT RISK'}
                    </span>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    // REPORT 2: Coaching Impact Analysis
    function renderCoachingImpactReport() {
      const members = getFilteredMembers();
      
      const coachingData = members.map(member => {
        const sessionCount = member.sessions1on1 ? Object.keys(member.sessions1on1).length : 0;
        
        let totalActions = 0;
        let completedActions = 0;
        let beforeQuota = 0;
        let afterQuota = 0;
        
        if (member.sessions1on1) {
          const sessions = Object.values(member.sessions1on1).sort((a, b) => 
            new Date(a.date) - new Date(b.date)
          );
          
          sessions.forEach((session, idx) => {
            if (session.actionPlan) {
              totalActions += session.actionPlan.length;
              completedActions += session.actionPlan.filter(a => a.status === 'completed').length;
            }
            
            if (session.monthlyGoal && session.monthlyGoal.target > 0) {
              const attainment = (session.monthlyGoal.current / session.monthlyGoal.target) * 100;
              if (idx === 0) beforeQuota = attainment;
              if (idx === sessions.length - 1) afterQuota = attainment;
            }
          });
        }
        
        const actionCompletionRate = totalActions > 0 ? Math.round((completedActions / totalActions) * 100) : 0;
        const quotaImprovement = afterQuota - beforeQuota;
        
        let skillImprovement = 0;
        if (member.devPlan && member.devPlan.skills && member.devPlan.skills.length > 0) {
          const improvements = member.devPlan.skills.map(skill => {
            const initial = skill.history && skill.history.length > 0 ? skill.history[0].previousValue : skill.current;
            return skill.current - initial;
          });
          skillImprovement = Math.round(improvements.reduce((a, b) => a + b, 0) / improvements.length);
        }
        
        return {
          name: member.name,
          sessions: sessionCount,
          totalActions,
          completedActions,
          actionCompletionRate,
          beforeQuota: Math.round(beforeQuota),
          afterQuota: Math.round(afterQuota),
          quotaImprovement: Math.round(quotaImprovement),
          skillImprovement
        };
      }).filter(d => d.sessions > 0).sort((a, b) => b.quotaImprovement - a.quotaImprovement);
      
      const avgSessions = coachingData.length > 0 
        ? (coachingData.reduce((sum, d) => sum + d.sessions, 0) / coachingData.length).toFixed(1)
        : 0;
      
      const avgActionCompletion = coachingData.length > 0
        ? Math.round(coachingData.reduce((sum, d) => sum + d.actionCompletionRate, 0) / coachingData.length)
        : 0;
      
      const avgQuotaImprovement = coachingData.length > 0
        ? Math.round(coachingData.reduce((sum, d) => sum + d.quotaImprovement, 0) / coachingData.length)
        : 0;
      
      const avgSkillImprovement = coachingData.length > 0
        ? Math.round(coachingData.reduce((sum, d) => sum + d.skillImprovement, 0) / coachingData.length)
        : 0;
      
      document.getElementById('coachingImpactReport').innerHTML = `
        <!-- Coaching Impact Summary -->
        <div class="stat-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-bottom: 24px;">
          <div class="stat-box" style="border-left: 4px solid #667eea;">
            <div class="stat-value" style="color: #667eea;">${avgSessions}</div>
            <div class="stat-label">Avg Sessions per Rep</div>
          </div>
          <div class="stat-box" style="border-left: 4px solid #22c55e;">
            <div class="stat-value" style="color: #22c55e;">${avgActionCompletion}%</div>
            <div class="stat-label">Action Completion Rate</div>
          </div>
          <div class="stat-box" style="border-left: 4px solid #3b82f6;">
            <div class="stat-value" style="color: ${avgQuotaImprovement >= 0 ? '#22c55e' : '#ef4444'};">
              ${avgQuotaImprovement >= 0 ? '+' : ''}${avgQuotaImprovement}%
            </div>
            <div class="stat-label">Avg Quota Improvement</div>
          </div>
          <div class="stat-box" style="border-left: 4px solid #a855f7;">
            <div class="stat-value" style="color: #a855f7;">+${avgSkillImprovement}%</div>
            <div class="stat-label">Avg Skill Improvement</div>
          </div>
        </div>

        ${coachingData.length === 0 ? `
          <div class="empty-state">
            <div class="empty-icon">üìä</div>
            <div class="empty-text">No coaching data available</div>
            <div class="empty-hint">1:1 sessions needed to generate coaching impact metrics</div>
          </div>
        ` : `
          <!-- Individual Coaching Impact Cards -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 16px;">
            ${coachingData.map(d => `
              <div style="padding: 20px; background: var(--bg-secondary); border-radius: 12px; border-left: 4px solid ${d.quotaImprovement >= 20 ? '#22c55e' : d.quotaImprovement >= 0 ? '#3b82f6' : '#ef4444'};">
                <div style="font-weight: 700; font-size: 16px; margin-bottom: 12px;">${d.name}</div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 12px;">
                  <div>
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 2px;">Sessions</div>
                    <div style="font-size: 20px; font-weight: 700; color: #667eea;">${d.sessions}</div>
                  </div>
                  <div>
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 2px;">Actions</div>
                    <div style="font-size: 20px; font-weight: 700;">${d.completedActions}/${d.totalActions}</div>
                  </div>
                </div>

                <div style="margin-bottom: 12px;">
                  <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Quota Performance</div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="font-size: 14px; font-weight: 600;">${d.beforeQuota}%</div>
                    <div style="flex: 1; height: 2px; background: var(--bg-primary); position: relative;">
                      <div style="position: absolute; right: 0; top: -4px; font-size: 18px;">‚Üí</div>
                    </div>
                    <div style="font-size: 18px; font-weight: 700; color: ${d.afterQuota >= 100 ? '#22c55e' : '#3b82f6'};">${d.afterQuota}%</div>
                  </div>
                  <div style="font-size: 12px; margin-top: 4px; color: ${d.quotaImprovement >= 0 ? '#22c55e' : '#ef4444'}; font-weight: 600;">
                    ${d.quotaImprovement >= 0 ? '‚Üó' : '‚Üò'} ${d.quotaImprovement >= 0 ? '+' : ''}${d.quotaImprovement}% change
                  </div>
                </div>

                <div style="display: flex; justify-content: space-between; padding-top: 12px; border-top: 1px solid var(--bg-primary);">
                  <div>
                    <div style="font-size: 11px; color: var(--text-muted);">Action Completion</div>
                    <div style="font-size: 14px; font-weight: 600; color: ${d.actionCompletionRate >= 75 ? '#22c55e' : '#f59e0b'};">${d.actionCompletionRate}%</div>
                  </div>
                  <div>
                    <div style="font-size: 11px; color: var(--text-muted);">Skill Improvement</div>
                    <div style="font-size: 14px; font-weight: 600; color: #a855f7;">+${d.skillImprovement}%</div>
                  </div>
                  <div>
                    <div style="font-size: 11px; color: var(--text-muted);">ROI</div>
                    <div style="font-size: 20px;">
                      ${d.quotaImprovement >= 20 ? 'üåü' : d.quotaImprovement >= 10 ? '‚≠ê' : d.quotaImprovement >= 0 ? '‚ú®' : 'üí´'}
                    </div>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        `}
      `;
    }

    // REPORT 3: Development Progress
    function renderDevelopmentProgressReport() {
      const members = getFilteredMembers();
      
      // Collect all skills across team
      const skillMap = {};
      members.forEach(member => {
        if (member.devPlan && member.devPlan.skills) {
          member.devPlan.skills.forEach(skill => {
            if (!skillMap[skill.name]) {
              skillMap[skill.name] = {
                name: skill.name,
                totalCurrent: 0,
                totalTarget: 0,
                totalProgress: 0,
                count: 0,
                members: []
              };
            }
            
            skillMap[skill.name].totalCurrent += skill.current;
            skillMap[skill.name].totalTarget += skill.target;
            skillMap[skill.name].count++;
            skillMap[skill.name].members.push({
              name: member.name,
              current: skill.current,
              target: skill.target
            });
            
            const initial = skill.history && skill.history.length > 0 ? skill.history[0].previousValue : skill.current;
            skillMap[skill.name].totalProgress += (skill.current - initial);
          });
        }
      });
      
      const skillsData = Object.values(skillMap).map(skill => ({
        name: skill.name,
        avgCurrent: Math.round(skill.totalCurrent / skill.count),
        avgTarget: Math.round(skill.totalTarget / skill.count),
        avgProgress: Math.round(skill.totalProgress / skill.count),
        gap: Math.round((skill.totalTarget - skill.totalCurrent) / skill.count),
        memberCount: skill.count,
        members: skill.members
      })).sort((a, b) => b.memberCount - a.memberCount);
      
      const totalSkillsTracked = skillsData.reduce((sum, s) => sum + s.memberCount, 0);
      const avgProgress = skillsData.length > 0 
        ? Math.round(skillsData.reduce((sum, s) => sum + s.avgProgress, 0) / skillsData.length)
        : 0;
      
      document.getElementById('developmentProgressReport').innerHTML = `
        <!-- Summary -->
        <div class="stat-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-bottom: 24px;">
          <div class="stat-box" style="border-left: 4px solid #8b5cf6;">
            <div class="stat-value" style="color: #8b5cf6;">${skillsData.length}</div>
            <div class="stat-label">Unique Skills Being Tracked</div>
          </div>
          <div class="stat-box" style="border-left: 4px solid #3b82f6;">
            <div class="stat-value" style="color: #3b82f6;">${totalSkillsTracked}</div>
            <div class="stat-label">Total Skill Instances</div>
          </div>
          <div class="stat-box" style="border-left: 4px solid #22c55e;">
            <div class="stat-value" style="color: #22c55e;">+${avgProgress}%</div>
            <div class="stat-label">Avg Skill Improvement</div>
          </div>
        </div>

        ${skillsData.length === 0 ? `
          <div class="empty-state">
            <div class="empty-icon">üéØ</div>
            <div class="empty-text">No skills being tracked</div>
            <div class="empty-hint">Add skills to team members in the Development tab</div>
          </div>
        ` : `
          <!-- Skills Progress Table -->
          <div style="display: grid; gap: 16px;">
            ${skillsData.map(skill => `
              <div style="padding: 16px; background: var(--bg-secondary); border-radius: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                  <div>
                    <div style="font-weight: 700; font-size: 15px;">${skill.name}</div>
                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px;">
                      ${skill.memberCount} team member${skill.memberCount > 1 ? 's' : ''} tracking
                    </div>
                  </div>
                  <div style="text-align: right;">
                    <div style="font-size: 20px; font-weight: 700; color: ${skill.avgProgress > 0 ? '#22c55e' : '#94a3b8'};">
                      ${skill.avgProgress > 0 ? '+' : ''}${skill.avgProgress}%
                    </div>
                    <div style="font-size: 11px; color: var(--text-muted);">avg growth</div>
                  </div>
                </div>

                <div style="margin-bottom: 8px;">
                  <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">
                    <span>Team Average Progress</span>
                    <span style="font-weight: 600; color: var(--text-primary);">${skill.avgCurrent}% / ${skill.avgTarget}%</span>
                  </div>
                  <div style="background: var(--bg-primary); height: 12px; border-radius: 6px; overflow: hidden;">
                    <div style="background: linear-gradient(90deg, #3b82f6, #2563eb); height: 100%; width: ${skill.avgCurrent}%;"></div>
                  </div>
                  <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">
                    Gap to target: ${skill.gap}%
                  </div>
                </div>

                <!-- Individual member breakdown -->
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 8px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--bg-primary);">
                  ${skill.members.map(m => `
                    <div style="font-size: 11px;">
                      <div style="color: var(--text-secondary); margin-bottom: 2px;">${m.name}</div>
                      <div style="font-weight: 600;">${m.current}% / ${m.target}%</div>
                    </div>
                  `).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        `}
      `;
    }

    // REPORT 4: Activity & Engagement
    function renderActivityEngagementReport() {
      const members = getFilteredMembers();
      
      const activityData = members.map(member => {
        let meetingsBooked = 0;
        let prospectMeetings = 0;
        let dealsProgressed = 0;
        
        if (member.sessions1on1) {
          Object.values(member.sessions1on1).forEach(session => {
            if (session.weeklyTargets) {
              session.weeklyTargets.forEach(target => {
                if (target.text.toLowerCase().includes('meeting') && target.status === 'completed') {
                  meetingsBooked += parseInt(target.text.match(/\d+/)?.[0] || 0);
                }
                if (target.text.toLowerCase().includes('prospect') && target.status === 'completed') {
                  prospectMeetings += parseInt(target.text.match(/\d+/)?.[0] || 0);
                }
              });
            }
            if (session.monthlyGoal && session.monthlyGoal.dealsToNegotiate) {
              dealsProgressed += session.monthlyGoal.dealsToNegotiate;
            }
          });
        }
        
        const sessionCount = member.sessions1on1 ? Object.keys(member.sessions1on1).length : 0;
        const activityScore = meetingsBooked + (prospectMeetings * 2) + (dealsProgressed * 3);
        
        return {
          name: member.name,
          sessions: sessionCount,
          meetingsBooked,
          prospectMeetings,
          dealsProgressed,
          activityScore
        };
      }).sort((a, b) => b.activityScore - a.activityScore);
      
      const totalMeetings = activityData.reduce((sum, d) => sum + d.meetingsBooked, 0);
      const totalProspects = activityData.reduce((sum, d) => sum + d.prospectMeetings, 0);
      const totalDeals = activityData.reduce((sum, d) => sum + d.dealsProgressed, 0);
      
      document.getElementById('activityEngagementReport').innerHTML = `
        <!-- Activity Summary -->
        <div class="stat-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-bottom: 24px;">
          <div class="stat-box" style="border-left: 4px solid #3b82f6;">
            <div class="stat-value" style="color: #3b82f6;">${totalMeetings}</div>
            <div class="stat-label">Total Meetings Booked</div>
          </div>
          <div class="stat-box" style="border-left: 4px solid #f59e0b;">
            <div class="stat-value" style="color: #f59e0b;">${totalProspects}</div>
            <div class="stat-label">New Prospect Meetings</div>
          </div>
          <div class="stat-box" style="border-left: 4px solid #22c55e;">
            <div class="stat-value" style="color: #22c55e;">${totalDeals}</div>
            <div class="stat-label">Deals Moved to Negotiation</div>
          </div>
        </div>

        <!-- Activity Leaderboard -->
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
            <thead>
              <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--bg-primary);">
                <th style="padding: 12px; text-align: left; font-weight: 600;">Rank</th>
                <th style="padding: 12px; text-align: left; font-weight: 600;">Rep</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Meetings</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Prospects</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Deals Progressed</th>
                <th style="padding: 12px; text-align: center; font-weight: 600;">Activity Score</th>
              </tr>
            </thead>
            <tbody>
              ${activityData.map((d, idx) => `
                <tr style="border-bottom: 1px solid var(--bg-secondary);">
                  <td style="padding: 12px; text-align: center;">
                    <div style="font-size: 20px;">
                      ${idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : idx + 1}
                    </div>
                  </td>
                  <td style="padding: 12px; font-weight: 600;">${d.name}</td>
                  <td style="padding: 12px; text-align: center; font-size: 16px; font-weight: 600; color: #3b82f6;">${d.meetingsBooked}</td>
                  <td style="padding: 12px; text-align: center; font-size: 16px; font-weight: 600; color: #f59e0b;">${d.prospectMeetings}</td>
                  <td style="padding: 12px; text-align: center; font-size: 16px; font-weight: 600; color: #22c55e;">${d.dealsProgressed}</td>
                  <td style="padding: 12px; text-align: center;">
                    <div style="font-size: 18px; font-weight: 700; color: ${idx === 0 ? '#22c55e' : 'var(--text-primary)'};">${d.activityScore}</div>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>

        <div style="margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px; font-size: 12px; color: var(--text-muted);">
          <strong>Activity Score Formula:</strong> Meetings Booked + (Prospect Meetings √ó 2) + (Deals Progressed √ó 3)
        </div>
      `;
    }

    // REPORT 5: Individual Deep Dive
    function renderIndividualDeepDiveReport() {
      const memberFilter = document.getElementById('reportMemberFilter').value;
      
      if (memberFilter === 'all') {
        document.getElementById('individualDeepDiveReport').innerHTML = `
          <div style="padding: 40px 20px; text-align: center; background: var(--bg-secondary); border-radius: 12px;">
            <div style="font-size: 48px; margin-bottom: 12px;">üë§</div>
            <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Select a Team Member</div>
            <div style="font-size: 14px; color: var(--text-muted);">
              Use the filter above to view detailed individual performance analysis
            </div>
          </div>
        `;
        return;
      }
      
      const member = teamMembers.find(m => m.id === parseInt(memberFilter));
      if (!member) return;
      
      // Collect all session data
      const sessionHistory = [];
      if (member.sessions1on1) {
        Object.entries(member.sessions1on1).forEach(([id, session]) => {
          sessionHistory.push({
            id,
            date: new Date(session.date),
            dateFormatted: session.dateFormatted,
            quota: session.monthlyGoal ? Math.round((session.monthlyGoal.current / session.monthlyGoal.target) * 100) : 0,
            revenue: session.monthlyGoal ? session.monthlyGoal.current : 0,
            opps: session.monthlyGoal ? session.monthlyGoal.opportunitiesCreated : 0,
            deals: session.monthlyGoal ? session.monthlyGoal.dealsToNegotiate : 0,
            actions: session.actionPlan ? session.actionPlan.length : 0,
            completedActions: session.actionPlan ? session.actionPlan.filter(a => a.status === 'completed').length : 0
          });
        });
      }
      sessionHistory.sort((a, b) => a.date - b.date);
      
      const skills = member.devPlan && member.devPlan.skills ? member.devPlan.skills : [];
      
      document.getElementById('individualDeepDiveReport').innerHTML = `
        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%); padding: 24px; border-radius: 12px; margin-bottom: 24px;">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
              <h3 style="margin: 0 0 8px 0; font-size: 24px;">${member.name}</h3>
              <div style="font-size: 14px; color: var(--text-secondary);">
                ${member.readiness} ‚Ä¢ ${member.personality} ‚Ä¢ ${member.careerStage}
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 4px;">Performance Status</div>
              <span style="
                padding: 6px 12px;
                border-radius: 12px;
                font-size: 13px;
                font-weight: 600;
                background: ${member.perfStatus === 'exceeding' ? '#dcfce7' : member.perfStatus === 'on-track' ? '#dbeafe' : '#fee2e2'};
                color: ${member.perfStatus === 'exceeding' ? '#166534' : member.perfStatus === 'on-track' ? '#1e40af' : '#991b1b'};
              ">
                ${member.perfStatus.toUpperCase().replace('-', ' ')}
              </span>
            </div>
          </div>
        </div>

        ${sessionHistory.length === 0 ? `
          <div class="empty-state">
            <div class="empty-icon">üìä</div>
            <div class="empty-text">No session data available</div>
            <div class="empty-hint">Create 1:1 sessions to track individual progress</div>
          </div>
        ` : `
          <!-- Session Timeline -->
          <div style="margin-bottom: 24px;">
            <div style="font-weight: 600; margin-bottom: 12px; font-size: 16px;">üìÖ Session Timeline</div>
            <div style="overflow-x: auto;">
              <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                  <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--bg-primary);">
                    <th style="padding: 10px; text-align: left;">Date</th>
                    <th style="padding: 10px; text-align: center;">Quota %</th>
                    <th style="padding: 10px; text-align: right;">Revenue</th>
                    <th style="padding: 10px; text-align: center;">Opps</th>
                    <th style="padding: 10px; text-align: center;">Deals</th>
                    <th style="padding: 10px; text-align: center;">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  ${sessionHistory.map((s, idx) => {
                    const quotaChange = idx > 0 ? s.quota - sessionHistory[idx - 1].quota : 0;
                    return `
                      <tr style="border-bottom: 1px solid var(--bg-secondary);">
                        <td style="padding: 10px; font-weight: 600;">${s.dateFormatted}</td>
                        <td style="padding: 10px; text-align: center;">
                          <div style="font-size: 16px; font-weight: 700; color: ${s.quota >= 100 ? '#22c55e' : s.quota >= 70 ? '#3b82f6' : '#ef4444'};">
                            ${s.quota}%
                          </div>
                          ${idx > 0 ? `
                            <div style="font-size: 10px; color: ${quotaChange >= 0 ? '#22c55e' : '#ef4444'};">
                              ${quotaChange >= 0 ? '‚Üó' : '‚Üò'} ${quotaChange >= 0 ? '+' : ''}${quotaChange}%
                            </div>
                          ` : ''}
                        </td>
                        <td style="padding: 10px; text-align: right; font-weight: 600;">$${(s.revenue / 1000).toFixed(0)}K</td>
                        <td style="padding: 10px; text-align: center;">${s.opps}</td>
                        <td style="padding: 10px; text-align: center;">${s.deals}</td>
                        <td style="padding: 10px; text-align: center;">${s.completedActions}/${s.actions}</td>
                      </tr>
                    `;
                  }).join('')}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Progress Metrics -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <div style="padding: 16px; background: var(--bg-secondary); border-radius: 12px;">
              <div style="font-weight: 600; margin-bottom: 12px;">üìà Quota Progression</div>
              <div style="font-size: 32px; font-weight: 900; color: #3b82f6; margin-bottom: 4px;">
                ${sessionHistory[0].quota}% ‚Üí ${sessionHistory[sessionHistory.length - 1].quota}%
              </div>
              <div style="font-size: 14px; color: ${sessionHistory[sessionHistory.length - 1].quota - sessionHistory[0].quota >= 0 ? '#22c55e' : '#ef4444'}; font-weight: 600;">
                ${sessionHistory[sessionHistory.length - 1].quota - sessionHistory[0].quota >= 0 ? '‚Üó' : '‚Üò'} 
                ${sessionHistory[sessionHistory.length - 1].quota - sessionHistory[0].quota >= 0 ? '+' : ''}
                ${sessionHistory[sessionHistory.length - 1].quota - sessionHistory[0].quota}% total change
              </div>
            </div>

            <div style="padding: 16px; background: var(--bg-secondary); border-radius: 12px;">
              <div style="font-weight: 600; margin-bottom: 12px;">üí∞ Revenue Closed</div>
              <div style="font-size: 32px; font-weight: 900; color: #22c55e; margin-bottom: 4px;">
                $${(sessionHistory.reduce((sum, s) => sum + s.revenue, 0) / 1000).toFixed(0)}K
              </div>
              <div style="font-size: 14px; color: var(--text-muted);">
                Across ${sessionHistory.length} sessions
              </div>
            </div>

            <div style="padding: 16px; background: var(--bg-secondary); border-radius: 12px;">
              <div style="font-weight: 600; margin-bottom: 12px;">üéØ Total Activity</div>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                <div>
                  <div style="font-size: 20px; font-weight: 700; color: #3b82f6;">${sessionHistory.reduce((sum, s) => sum + s.opps, 0)}</div>
                  <div style="font-size: 11px; color: var(--text-muted);">Opps Created</div>
                </div>
                <div>
                  <div style="font-size: 20px; font-weight: 700; color: #f59e0b;">${sessionHistory.reduce((sum, s) => sum + s.deals, 0)}</div>
                  <div style="font-size: 11px; color: var(--text-muted);">To Negotiate</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Skills -->
          ${skills.length > 0 ? `
            <div>
              <div style="font-weight: 600; margin-bottom: 12px; font-size: 16px;">üéØ Current Skills</div>
              <div style="display: grid; gap: 12px;">
                ${skills.map(skill => `
                  <div style="padding: 12px; background: var(--bg-secondary); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                      <div style="font-weight: 600;">${skill.name}</div>
                      <div style="font-weight: 700; color: #3b82f6;">${skill.current}% / ${skill.target}%</div>
                    </div>
                    <div style="background: var(--bg-primary); height: 8px; border-radius: 4px; overflow: hidden;">
                      <div style="background: linear-gradient(90deg, #3b82f6, #2563eb); height: 100%; width: ${skill.current}%;"></div>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}
        `}
      `;
    }

    // Export function
    function exportReportData() {
      const members = getFilteredMembers();
      
      // Create CSV data
      let csv = 'Team Performance Report\n\n';
      csv += 'Team Member,Revenue,Target,Quota Attainment,Sessions,Skills Tracked,Action Completion\n';
      
      members.forEach(member => {
        let totalRevenue = 0;
        let totalTarget = 0;
        let sessionCount = 0;
        let totalActions = 0;
        let completedActions = 0;
        
        if (member.sessions1on1) {
          Object.values(member.sessions1on1).forEach(session => {
            if (session.monthlyGoal) {
              totalRevenue += session.monthlyGoal.current || 0;
              totalTarget += session.monthlyGoal.target || 0;
              sessionCount++;
            }
            if (session.actionPlan) {
              totalActions += session.actionPlan.length;
              completedActions += session.actionPlan.filter(a => a.status === 'completed').length;
            }
          });
        }
        
        const attainment = totalTarget > 0 ? Math.round((totalRevenue / totalTarget) * 100) : 0;
        const skillCount = member.devPlan && member.devPlan.skills ? member.devPlan.skills.length : 0;
        const actionRate = totalActions > 0 ? Math.round((completedActions / totalActions) * 100) : 0;
        
        csv += `${member.name},${totalRevenue},${totalTarget},${attainment}%,${sessionCount},${skillCount},${actionRate}%\n`;
      });
      
      // Download CSV
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `team-performance-report-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
      
      alert('‚úì Report exported to CSV!');
    }

    // Team Management
    function addTeamMember() {
      const name = prompt('Enter team member name:');
      if (!name) return;
      
      const newMember = {
        id: Date.now(),
        name: name,
        readiness: 'R2',
        competence: 5,
        commitment: 5,
        personality: 'Owl',
        careerStage: 'Mid-Career',
        workStyle: 'Collaborative',
        communicationStyle: 'Thinker',
        perfStatus: 'on-track',
        focusArea: 'To be defined',
        next1on1: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
        lastContact: new Date(),
        personalNotes: '',
        careerGoals: '',
        motivators: '',
        demotivators: '',
        conversations: [],
        actions: [],
        devPlan: {
          skills: [],
          activities: []
        },
        alerts: []
      };
      
      teamMembers.push(newMember);
      saveData();
      renderTeamGrid();
      renderMembersEditGrid();
      
      alert('‚úì Team member added! Go to Settings to edit their full profile.');
    }

    function importData() {
      alert('CSV import functionality coming soon!\n\nSupported columns:\nName, Readiness, Personality, Career Stage, Work Style, Performance Status, Focus Area');
    }

    function exportData() {
      const csv = convertToCSV(teamMembers);
      downloadCSV(csv, 'team_data.csv');
    }

    function convertToCSV(data) {
      const headers = ['Name', 'Readiness', 'Personality', 'Career Stage', 'Work Style', 'Performance', 'Focus Area'];
      const rows = data.map(m => [
        m.name,
        m.readiness,
        m.personality,
        m.careerStage,
        m.workStyle,
        m.perfStatus,
        m.focusArea
      ]);
      
      return [headers, ...rows].map(row => row.join(',')).join('\n');
    }

    function downloadCSV(csv, filename) {
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
    }

    // Data Persistence
    function saveData() {
      localStorage.setItem('teamCoachData', JSON.stringify(teamMembers));
    }

    function loadData() {
      const saved = localStorage.getItem('teamCoachData');
      if (saved) {
        teamMembers = JSON.parse(saved);
        // Convert date strings back to Date objects and initialize missing fields
        teamMembers.forEach(member => {
          member.next1on1 = new Date(member.next1on1);
          member.lastContact = new Date(member.lastContact);
          member.conversations.forEach(c => c.date = new Date(c.date));
          member.actions.forEach(a => a.due = new Date(a.due));
          
          // Initialize devPlan if missing
          if (!member.devPlan) {
            member.devPlan = { skills: [], activities: [] };
          }
          if (!member.devPlan.skills) {
            member.devPlan.skills = [];
          }
          if (!member.devPlan.activities) {
            member.devPlan.activities = [];
          }
          
          // Initialize sessions1on1 if missing
          if (!member.sessions1on1) {
            member.sessions1on1 = {};
          }
        });
      }
    }

    // Initialize
    loadData();

    // Initialize Salesforce integration
    (async function initializeSalesforce() {
      // Check if returning from OAuth callback
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('code')) {
        await handleSalesforceOAuthCallback();
      }
      
      // Update connection status on all pages
      updateSalesforceConnectionStatus();
    })();

    // TEMPORARY: Function to reset to demo data (clears localStorage)
    function resetToFreshData() {
      if (confirm('This will clear all saved data and reload the demo team. Are you sure?')) {
        localStorage.removeItem('teamCoachData');
        location.reload();
      }
    }
    
    // Add reset button to console for now
    console.log('%cüí° To see Sarah Chen\'s 5 session history:', 'color: #3b82f6; font-size: 14px; font-weight: bold');
    console.log('%cRun this command: resetToFreshData()', 'color: #22c55e; font-size: 12px');
    console.log('%cOr manually: localStorage.removeItem("teamCoachData"); location.reload()', 'color: #9ca3af; font-size: 11px');

    // Render Members Edit Grid
    function renderMembersEditGrid() {
      const grid = document.getElementById('membersEditGrid');
      
      if (teamMembers.length === 0) {
        grid.innerHTML = `
          <div class="empty-state" style="grid-column: 1/-1;">
            <div class="empty-icon">üë•</div>
            <div class="empty-text">No team members yet</div>
            <div class="empty-hint">Click "Add Team Member" to get started</div>
          </div>
        `;
        return;
      }

      grid.innerHTML = teamMembers.map(member => `
        <div class="edit-member-card">
          <div class="edit-card-header">
            <div class="edit-card-name">${member.name}</div>
            <div class="edit-card-actions">
              <button class="icon-btn" onclick="openEditProfileModal(${member.id})" title="Edit Full Profile">‚úèÔ∏è</button>
              <button class="icon-btn" onclick="deleteMemberConfirm(${member.id})" title="Delete" style="color: var(--accent-danger);">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="edit-card-body">
            <div class="edit-field">
              <div class="edit-field-label">Readiness Level</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(${member.id}, 'readiness', this.value)">
                  <option value="R1" ${member.readiness === 'R1' ? 'selected' : ''}>R1 - New</option>
                  <option value="R2" ${member.readiness === 'R2' ? 'selected' : ''}>R2 - Growing</option>
                  <option value="R3" ${member.readiness === 'R3' ? 'selected' : ''}>R3 - Capable</option>
                  <option value="R4" ${member.readiness === 'R4' ? 'selected' : ''}>R4 - Expert</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Personality Type</div>
              <div class="edit-field-value">
                <div style="font-size: 13px; color: var(--text-primary); padding: 8px;">
                  ${member.personality}${member.personalitySecondary ? '/' + member.personalitySecondary : ''}
                  <span style="font-size: 11px; color: var(--text-muted); margin-left: 8px;">(Edit in full profile)</span>
                </div>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Performance Status</div>
              <div class="edit-field-value">
                <select onchange="quickUpdateMember(${member.id}, 'perfStatus', this.value)">
                  <option value="exceeding" ${member.perfStatus === 'exceeding' ? 'selected' : ''}>Exceeding Target</option>
                  <option value="on-track" ${member.perfStatus === 'on-track' ? 'selected' : ''}>On Track</option>
                  <option value="at-risk" ${member.perfStatus === 'at-risk' ? 'selected' : ''}>At Risk</option>
                  <option value="struggling" ${member.perfStatus === 'struggling' ? 'selected' : ''}>Struggling</option>
                </select>
              </div>
            </div>

            <div class="edit-field">
              <div class="edit-field-label">Current Focus Area</div>
              <div class="edit-field-value">
                <input type="text" value="${member.focusArea}" 
                       onchange="quickUpdateMember(${member.id}, 'focusArea', this.value)"
                       placeholder="e.g., Enterprise deals">
              </div>
            </div>

            <div style="display: flex; gap: 8px; margin-top: 8px;">
              <span class="tag" style="font-size: 11px;">${member.careerStage}</span>
              <span class="tag" style="font-size: 11px;">${member.workStyle}</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Quick Update Member (for inline edits)
    function quickUpdateMember(memberId, field, value) {
      const member = teamMembers.find(m => m.id === memberId);
      if (!member) return;
      
      member[field] = value;
      saveData();
      renderTeamGrid();
      
      // Show subtle confirmation
      const card = event.target.closest('.edit-member-card');
      if (card) {
        card.style.background = 'rgba(5, 150, 105, 0.1)';
        setTimeout(() => {
          card.style.background = 'var(--bg-secondary)';
        }, 500);
      }
    }

    // Open Full Edit Profile Modal
    let currentEditingMember = null;

    function openEditProfileModal(memberId) {
      currentEditingMember = teamMembers.find(m => m.id === memberId);
      if (!currentEditingMember) return;
      
      document.getElementById('editProfileTitle').textContent = `Edit Profile: ${currentEditingMember.name}`;
      document.getElementById('editProfileName').value = currentEditingMember.name;
      document.getElementById('editProfileReadiness').value = currentEditingMember.readiness;
      document.getElementById('editProfileCompetence').value = currentEditingMember.competence || 5;
      document.getElementById('editProfileCommitment').value = currentEditingMember.commitment || 5;
      document.getElementById('compValue').textContent = currentEditingMember.competence || 5;
      document.getElementById('commValue').textContent = currentEditingMember.commitment || 5;
      document.getElementById('editProfilePersonality').value = currentEditingMember.personality;
      document.getElementById('editProfilePersonalitySecondary').value = currentEditingMember.personalitySecondary || '';
      document.getElementById('editProfileCareerStage').value = currentEditingMember.careerStage;
      document.getElementById('editProfileWorkStyle').value = currentEditingMember.workStyle;
      document.getElementById('editProfileCommStyle').value = currentEditingMember.communicationStyle || 'Thinker';
      
      document.getElementById('editProfileModal').classList.add('active');
    }

    function closeEditProfileModal() {
      document.getElementById('editProfileModal').classList.remove('active');
      currentEditingMember = null;
    }

    function updateReadinessSuggestion() {
      const comp = parseInt(document.getElementById('editProfileCompetence').value);
      const comm = parseInt(document.getElementById('editProfileCommitment').value);
      const suggestion = document.getElementById('readinessSuggestion');
      const content = suggestion.querySelector('.info-card-content');
      
      let text = '';
      let recommendedR = '';
      
      if (comp <= 5 && comm <= 5) {
        recommendedR = 'R1';
        text = 'üí° <strong>Suggested: R1</strong> - Low skills + low confidence. They need clear direction and close supervision.';
      } else if (comp <= 5 && comm > 5) {
        recommendedR = 'R2';
        text = 'üí° <strong>Suggested: R2</strong> - Low skills + high motivation. They are eager to learn. Coach them actively.';
      } else if (comp > 5 && comm <= 5) {
        recommendedR = 'R3';
        text = 'üí° <strong>Suggested: R3</strong> - High skills + low confidence. They can do it but doubt themselves. Support & encourage.';
      } else {
        recommendedR = 'R4';
        text = 'üí° <strong>Suggested: R4</strong> - High skills + high confidence. They are ready to fly. Delegate and empower!';
      }
      
      content.innerHTML = text;
      suggestion.style.display = 'block';
      
      // Auto-update readiness dropdown
      document.getElementById('editProfileReadiness').value = recommendedR;
    }

    function saveProfileEdit() {
      if (!currentEditingMember) return;
      
      currentEditingMember.name = document.getElementById('editProfileName').value;
      currentEditingMember.readiness = document.getElementById('editProfileReadiness').value;
      currentEditingMember.competence = parseInt(document.getElementById('editProfileCompetence').value);
      currentEditingMember.commitment = parseInt(document.getElementById('editProfileCommitment').value);
      currentEditingMember.personality = document.getElementById('editProfilePersonality').value;
      currentEditingMember.personalitySecondary = document.getElementById('editProfilePersonalitySecondary').value || null;
      currentEditingMember.careerStage = document.getElementById('editProfileCareerStage').value;
      currentEditingMember.workStyle = document.getElementById('editProfileWorkStyle').value;
      currentEditingMember.communicationStyle = document.getElementById('editProfileCommStyle').value;
      
      saveData();
      closeEditProfileModal();
      renderMembersEditGrid();
      renderTeamGrid();
      
      alert('‚úì Profile updated successfully!');
    }

    function deleteMemberConfirm(memberId) {
      const member = teamMembers.find(m => m.id === memberId);
      if (!member) return;
      
      const confirmed = confirm(`Delete ${member.name}?\n\nThis will remove all their data including:\n- Conversation history\n- Action items\n- Development plans\n\nThis cannot be undone.`);
      
      if (confirmed) {
        const index = teamMembers.findIndex(m => m.id === memberId);
        teamMembers.splice(index, 1);
        saveData();
        renderMembersEditGrid();
        renderTeamGrid();
        alert('‚úì Team member deleted');
      }
    }

    // Render edit grid when switching to settings
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        if (this.dataset.view === 'settings') {
          renderMembersEditGrid();
        }
      });
    });

    // Scenario Library
    function renderScenarios(filter = '', search = '') {
      const grid = document.getElementById('scenarioGrid');
      
      let filtered = coachingScenarios.filter(scenario => {
        const matchesSearch = scenario.title.toLowerCase().includes(search.toLowerCase()) ||
                             scenario.situation.toLowerCase().includes(search.toLowerCase());
        const matchesFilter = !filter || scenario.profiles.includes(filter);
        
        return matchesSearch && matchesFilter;
      });
      
      grid.innerHTML = filtered.map(scenario => `
        <div class="scenario-card" onclick="openScenarioModal(${scenario.id})">
          <div class="scenario-title">${scenario.title}</div>
          <div class="scenario-profiles">For: ${scenario.profiles.join(', ')}</div>
          <div class="scenario-preview">${scenario.situation}</div>
        </div>
      `).join('');
    }

    document.getElementById('scenarioSearch').addEventListener('input', function() {
      const filter = document.getElementById('profileFilter').value;
      renderScenarios(filter, this.value);
    });

    document.getElementById('profileFilter').addEventListener('change', function() {
      const search = document.getElementById('scenarioSearch').value;
      renderScenarios(this.value, search);
    });

    function openScenarioModal(scenarioId) {
      const scenario = coachingScenarios.find(s => s.id === scenarioId);
      if (!scenario) return;
      
      document.getElementById('scenarioTitle').textContent = scenario.title;
      document.getElementById('scenarioContent').innerHTML = `
        <div class="modal-section">
          <div class="section-title">Situation</div>
          <div class="info-card">
            <div class="info-card-content">${scenario.situation}</div>
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Profiles</div>
          <div style="font-size: 14px; font-weight: 600; color: var(--accent-primary);">
            Best for: ${scenario.profiles.join(' + ')}
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Approach</div>
          <div class="coaching-box">
            <div class="coaching-box-title">Strategy</div>
            <div style="font-size: 14px; line-height: 1.8;">${scenario.approach}</div>
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Conversation Script</div>
          <div class="coaching-box">
            <div class="coaching-box-title">What to Say</div>
            <ol style="padding-left: 20px; font-size: 14px; line-height: 2;">
              ${scenario.script.map(line => `<li>${line}</li>`).join('')}
            </ol>
          </div>
        </div>

        <div class="modal-section">
          <div class="section-title">Follow-up Actions</div>
          <div class="info-card">
            <div class="info-card-content">${scenario.followUp}</div>
          </div>
        </div>

        <button class="btn btn-primary" onclick="copyScenario()">Copy Script to Clipboard</button>
      `;
      
      document.getElementById('scenarioModal').classList.add('active');
    }

    function closeScenarioModal() {
      document.getElementById('scenarioModal').classList.remove('active');
    }

    function copyScenario() {
      const content = document.getElementById('scenarioContent').innerText;
      navigator.clipboard.writeText(content);
      alert('‚úì Scenario copied to clipboard!');
    }

    // ==========================================
    // AI COACHING ASSISTANT
    // ==========================================

    let aiConversationHistory = [];
    let currentAlerts = []; // Store alerts for event listeners

    // Render Predictive Alerts
    function renderPredictiveAlerts() {
      console.log('renderPredictiveAlerts called');
      const container = document.getElementById('predictiveAlertsContent');
      if (!container) {
        console.error('Predictive alerts container not found - ID: predictiveAlertsContent');
        return;
      }
      
      const alerts = generatePredictiveAlerts();
      currentAlerts = alerts; // Store for event listeners
      console.log('Generated alerts:', alerts.length);
      
      if (alerts.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚úÖ</div>
            <div class="empty-text">No critical alerts</div>
            <div class="empty-hint">Your team is tracking well!</div>
          </div>
        `;
        return;
      }

      container.innerHTML = alerts.map((alert, alertIdx) => `
        <div class="predictive-alert ${alert.level}">
          <div class="alert-severity ${alert.level}">${alert.level}</div>
          <div class="alert-title">${alert.title}</div>
          <div class="alert-description">${alert.description}</div>
          <div class="alert-actions">
            ${alert.actions.map((action, actionIdx) => `
              <button class="alert-action-btn" data-alert-idx="${alertIdx}" data-action-idx="${actionIdx}">${action.label}</button>
            `).join('')}
          </div>
        </div>
      `).join('');
      
      // Add event listeners to all action buttons
      container.querySelectorAll('.alert-action-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const alertIdx = parseInt(this.getAttribute('data-alert-idx'));
          const actionIdx = parseInt(this.getAttribute('data-action-idx'));
          const action = currentAlerts[alertIdx].actions[actionIdx];
          
          console.log('Alert action clicked:', action.label);
          console.log('Executing:', action.onclick);
          
          // Execute the onclick function
          try {
            eval(action.onclick);
          } catch (error) {
            console.error('Error executing action:', error);
            alert('Error executing action: ' + error.message);
          }
        });
      });
      console.log('Alerts rendered successfully');
    }

    function generatePredictiveAlerts() {
      const alerts = [];
      const now = Date.now();
      
      teamMembers.forEach(member => {
        // Performance risk prediction
        if (member.perfStatus === 'at-risk' || member.perfStatus === 'struggling') {
          const daysSinceLastContact = Math.floor((now - member.lastContact) / (1000 * 60 * 60 * 24));
          
          alerts.push({
            level: 'critical',
            title: `${member.name} at performance risk`,
            description: `${member.perfStatus === 'struggling' ? 'Struggling' : 'At risk'} performance status. Last contact was ${daysSinceLastContact} days ago. ${member.readiness === 'R1' || member.readiness === 'R2' ? 'Early-stage rep needs immediate coaching intervention.' : 'Experienced rep showing concerning pattern.'}`,
            actions: [
              { label: 'Schedule 1:1', onclick: `openMemberModal(${member.id})` },
              { label: 'Get AI Coaching Plan', onclick: `getAICoachingPlan(${member.id})` }
            ]
          });
        }
        
        // Overdue action items
        if (member.actions && member.actions.length > 0) {
          const overdueActions = member.actions.filter(a => !a.completed && a.due < now);
          if (overdueActions.length > 0) {
            alerts.push({
              level: 'warning',
              title: `${member.name} has ${overdueActions.length} overdue action${overdueActions.length > 1 ? 's' : ''}`,
              description: `Action items overdue by ${Math.max(...overdueActions.map(a => Math.floor((now - a.due) / (1000 * 60 * 60 * 24))))} days. Follow-up needed.`,
              actions: [
                { label: 'Review Actions', onclick: `openMemberModal(${member.id}); setTimeout(() => { document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active')); document.querySelector('[data-tab="history"]').classList.add('active'); document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active')); document.getElementById('tab-history').classList.add('active'); }, 100)` }
              ]
            });
          }
        }

        // Skill development stagnation
        if (member.devPlan && member.devPlan.skills && member.devPlan.skills.length > 0) {
          const stagnantSkills = member.devPlan.skills.filter(s => {
            const daysSinceUpdate = s.lastUpdated ? Math.floor((now - new Date(s.lastUpdated)) / (1000 * 60 * 60 * 24)) : 999;
            return daysSinceUpdate > 90 && (s.target - s.current) > 20;
          });
          
          if (stagnantSkills.length > 0) {
            alerts.push({
              level: 'warning',
              title: `${member.name} - skill development stalled`,
              description: `${stagnantSkills.length} skill${stagnantSkills.length > 1 ? 's' : ''} haven't been updated in 90+ days with significant gaps remaining. Consider reassessing development plan.`,
              actions: [
                { label: 'Conduct Assessment', onclick: `openMemberModal(${member.id}); setTimeout(() => { document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active')); document.querySelector('[data-tab="development"]').classList.add('active'); document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active')); document.getElementById('tab-development').classList.add('active'); openSkillAssessment(); }, 100)` }
              ]
            });
          }
        }

        // 1:1 overdue
        const daysSince1on1 = Math.floor((now - member.lastContact) / (1000 * 60 * 60 * 24));
        if (daysSince1on1 > 14) {
          alerts.push({
            level: 'warning',
            title: `${member.name} - 1:1 overdue`,
            description: `Last 1:1 was ${daysSince1on1} days ago. ${member.readiness === 'R1' ? 'R1 reps need weekly check-ins.' : member.readiness === 'R2' ? 'R2 reps need bi-weekly check-ins.' : 'Regular touchpoints maintain engagement.'}`,
            actions: [
              { label: 'Schedule Now', onclick: `openMemberModal(${member.id})` }
            ]
          });
        }
      });

      // Positive alerts
      teamMembers.forEach(member => {
        if (member.devPlan && member.devPlan.skills && member.devPlan.skills.length > 0) {
          const improvedSkills = member.devPlan.skills.filter(s => {
            if (!s.history || s.history.length < 2) return false;
            const recentProgress = s.history.slice(-2);
            const improvement = recentProgress[1].value - recentProgress[0].value;
            return improvement >= 15;
          });

          if (improvedSkills.length > 0) {
            alerts.push({
              level: 'success',
              title: `${member.name} - significant skill improvement!`,
              description: `${improvedSkills.length} skill${improvedSkills.length > 1 ? 's' : ''} improved 15%+ recently. Great coaching impact! Consider recognizing this progress.`,
              actions: [
                { label: 'Send Recognition', onclick: `alert('Great idea! Consider sending ${member.name} a note recognizing their skill development progress.')` }
              ]
            });
          }
        }
      });

      // Sort by severity
      const severityOrder = { critical: 0, warning: 1, info: 2, success: 3 };
      alerts.sort((a, b) => severityOrder[a.level] - severityOrder[b.level]);

      return alerts;
    }

    function refreshPredictiveAlerts() {
      renderPredictiveAlerts();
      alert('‚úì Alerts refreshed with latest data');
    }

    // Render Calendar Sync
    function renderCalendarSync() {
      const container = document.getElementById('calendarContent');
      const upcoming = getUpcoming1on1s();
      
      if (upcoming.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üìÖ</div>
            <div class="empty-text">No upcoming 1:1s scheduled</div>
            <div class="empty-hint">Schedule 1:1s with your team members</div>
          </div>
        `;
        return;
      }

      container.innerHTML = upcoming.map(item => {
        const date = new Date(item.date);
        const day = date.getDate();
        const month = date.toLocaleDateString('en-US', { month: 'short' });
        
        return `
          <div class="calendar-item">
            <div class="calendar-date-badge">
              <div class="calendar-date-day">${day}</div>
              <div class="calendar-date-month">${month}</div>
            </div>
            <div class="calendar-item-content">
              <div class="calendar-item-title">1:1 with ${item.member.name}</div>
              <div class="calendar-item-time">${date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}</div>
            </div>
            <button class="btn btn-primary" onclick="prepFor1on1(${item.member.id})" style="font-size: 12px; padding: 8px 16px;">
              Prep 1:1
            </button>
          </div>
        `;
      }).join('');
    }

    function getUpcoming1on1s() {
      const now = Date.now();
      const oneWeek = 7 * 24 * 60 * 60 * 1000;
      
      return teamMembers
        .filter(m => m.next1on1 && new Date(m.next1on1) > now && new Date(m.next1on1) < now + oneWeek)
        .map(m => ({ member: m, date: new Date(m.next1on1) }))
        .sort((a, b) => a.date - b.date);
    }

    function syncCalendar() {
      alert('üìÖ Calendar Sync\n\nIn production, this would:\n‚Ä¢ Connect to Google Calendar/Outlook\n‚Ä¢ Auto-populate 1:1 dates\n‚Ä¢ Send prep reminders\n‚Ä¢ Log completed 1:1s\n\nFor now, manually set next 1:1 dates in member profiles.');
    }

    function prepFor1on1(memberId) {
      openMemberModal(memberId);
      // Switch to prep tab
      setTimeout(() => {
        document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
        document.querySelector('.modal-tab[data-tab="prep"]').classList.add('active');
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-prep').classList.add('active');
      }, 100);
    }

    // Render Coaching Effectiveness
    function renderCoachingEffectiveness() {
      const container = document.getElementById('effectivenessContent');
      const metrics = calculateCoachingEffectiveness();
      
      container.innerHTML = `
        <div class="effectiveness-grid">
          <div class="effectiveness-metric">
            <div class="effectiveness-value positive">+${metrics.avgSkillImprovement}%</div>
            <div class="effectiveness-label">Avg Skill Improvement</div>
            <div class="effectiveness-trend up">‚Üë Last 90 days</div>
          </div>
          <div class="effectiveness-metric">
            <div class="effectiveness-value">${metrics.totalSessions}</div>
            <div class="effectiveness-label">Total 1:1 Sessions</div>
            <div class="effectiveness-trend">${metrics.sessionsChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(metrics.sessionsChange)}% vs last period</div>
          </div>
          <div class="effectiveness-metric">
            <div class="effectiveness-value ${metrics.actionCompletionRate >= 70 ? 'positive' : 'negative'}">${metrics.actionCompletionRate}%</div>
            <div class="effectiveness-label">Action Completion</div>
            <div class="effectiveness-trend ${metrics.actionCompletionRate >= 70 ? 'up' : 'down'}">
              ${metrics.actionCompletionRate >= 70 ? 'Strong follow-through' : 'Needs improvement'}
            </div>
          </div>
          <div class="effectiveness-metric">
            <div class="effectiveness-value ${metrics.atRiskReduction > 0 ? 'positive' : ''}">${metrics.performanceImprovement}</div>
            <div class="effectiveness-label">Performance Improvements</div>
            <div class="effectiveness-trend">People moved to On Track</div>
          </div>
        </div>

        <div style="margin-top: 24px; padding: 16px; background: var(--bg-tertiary); border-radius: 8px;">
          <strong style="font-size: 14px;">Coaching ROI Insights:</strong>
          <ul style="margin: 12px 0 0 20px; font-size: 13px; line-height: 1.8; color: var(--text-secondary);">
            ${metrics.insights.map(insight => `<li>${insight}</li>`).join('')}
          </ul>
        </div>
      `;
    }

    function calculateCoachingEffectiveness() {
      const now = Date.now();
      const ninetyDaysAgo = now - (90 * 24 * 60 * 60 * 1000);
      
      // Calculate average skill improvement
      let totalImprovement = 0;
      let skillsWithHistory = 0;
      
      teamMembers.forEach(member => {
        if (member.devPlan && member.devPlan.skills) {
          member.devPlan.skills.forEach(skill => {
            if (skill.history && skill.history.length > 0) {
              const recentHistory = skill.history.filter(h => new Date(h.date) > ninetyDaysAgo);
              if (recentHistory.length > 0) {
                const totalChange = recentHistory.reduce((sum, h) => sum + h.change, 0);
                totalImprovement += totalChange;
                skillsWithHistory++;
              }
            }
          });
        }
      });
      
      const avgSkillImprovement = skillsWithHistory > 0 ? Math.round(totalImprovement / skillsWithHistory) : 0;
      
      // Calculate total sessions
      const totalSessions = teamMembers.reduce((sum, m) => sum + (m.conversations?.length || 0), 0);
      
      // Calculate action completion rate
      const allActions = teamMembers.flatMap(m => m.actions || []);
      const completedActions = allActions.filter(a => a.completed).length;
      const actionCompletionRate = allActions.length > 0 ? Math.round((completedActions / allActions.length) * 100) : 0;
      
      // Calculate performance improvements
      const performanceImprovement = teamMembers.filter(m => 
        m.perfStatus === 'on-track' || m.perfStatus === 'exceeding'
      ).length;
      
      // Generate insights
      const insights = [];
      if (avgSkillImprovement > 15) {
        insights.push(`Strong skill development: Team improving ${avgSkillImprovement}% on average - your coaching is highly effective`);
      } else if (avgSkillImprovement > 0) {
        insights.push(`Moderate skill development: ${avgSkillImprovement}% average improvement - consider more focused coaching`);
      }
      
      if (actionCompletionRate >= 80) {
        insights.push('Excellent follow-through: 80%+ action completion shows strong accountability');
      } else if (actionCompletionRate < 50) {
        insights.push('Action completion below 50% - consider fewer, more focused commitments per 1:1');
      }
      
      if (totalSessions / teamMembers.length < 1) {
        insights.push('Increase 1:1 frequency - team averaging less than 1 session per person in tracked period');
      }
      
      return {
        avgSkillImprovement,
        totalSessions,
        sessionsChange: 0, // Would calculate from historical data
        actionCompletionRate,
        performanceImprovement,
        insights: insights.length > 0 ? insights : ['Continue tracking coaching activities to generate insights']
      };
    }

    function viewCoachingROI() {
      alert('üìä Full Coaching Effectiveness Report\n\nDetailed report would include:\n‚Ä¢ Skill progression charts over time\n‚Ä¢ 1:1 frequency vs performance correlation\n‚Ä¢ Action item completion trends\n‚Ä¢ Before/after coaching impact analysis\n‚Ä¢ Individual coaching ROI by team member\n\n(Full reporting feature coming soon)');
    }

    // AI Quick Actions
    function aiQuickAction(action) {
      console.log('=== aiQuickAction called ===');
      console.log('Action:', action);
      
      // Scroll to the AI chat interface
      const chatContainer = document.getElementById('aiChatMessages');
      if (chatContainer) {
        chatContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
      
      const queries = {
        'who-needs-attention': 'Who on my team needs the most attention this week and why?',
        'predict-risks': 'Analyze my team data and predict which team members are at risk of missing their goals. What patterns do you see?',
        'coaching-suggestions': 'Based on my team\'s current status, what are your top 3 coaching recommendations for me this week?',
        'prep-1on1s': 'I have 1:1s coming up this week. Generate a prioritized prep list with key discussion topics for each person.'
      };
      
      const query = queries[action];
      console.log('Query to send:', query);
      
      if (!query) {
        console.error('Unknown action:', action);
        alert('Unknown action: ' + action);
        return;
      }
      
      try {
        askAI(query);
        console.log('askAI called successfully');
      } catch (error) {
        console.error('Error calling askAI:', error);
        alert('Error: ' + error.message);
      }
    }

    function askAI(question) {
      console.log('askAI called with question:', question);
      const input = document.getElementById('aiChatInput');
      if (!input) {
        console.error('AI Chat input not found!');
        return;
      }
      input.value = question;
      sendAIMessage();
    }

    async function sendAIMessage() {
      console.log('sendAIMessage called');
      const input = document.getElementById('aiChatInput');
      const message = input.value.trim();
      
      console.log('Message to send:', message);
      
      if (!message) {
        console.log('No message, returning');
        return;
      }
      
      // Add user message to chat
      addAIMessage(message, 'user');
      input.value = '';
      
      // Show loading state
      const sendBtn = document.getElementById('sendBtnText');
      const loader = document.getElementById('sendBtnLoader');
      sendBtn.style.display = 'none';
      loader.style.display = 'inline';
      document.querySelector('.ai-send-btn').disabled = true;
      
      try {
        console.log('Calling getAIResponse...');
        const response = await getAIResponse(message);
        console.log('Got response, length:', response?.length);
        console.log('Response preview:', response?.substring(0, 100));
        addAIMessage(response, 'assistant');
        console.log('Message added to chat');
      } catch (error) {
        console.error('sendAIMessage Error:', error);
        addAIMessage('Sorry, I encountered an error. Please try again.', 'assistant');
      } finally {
        sendBtn.style.display = 'inline';
        loader.style.display = 'none';
        document.querySelector('.ai-send-btn').disabled = false;
      }
    }

    function addAIMessage(text, sender) {
      console.log('addAIMessage called:', { sender, textLength: text?.length });
      
      const messagesContainer = document.getElementById('aiChatMessages');
      if (!messagesContainer) {
        console.error('AI chat messages container not found!');
        return;
      }
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `ai-message ai-${sender}`;
      
      const avatar = sender === 'user' ? 'üë§' : 'ü§ñ';
      const time = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
      
      messageDiv.innerHTML = `
        <div class="ai-message-avatar">${avatar}</div>
        <div class="ai-message-content">
          <div class="ai-message-text">${formatAIMessage(text)}</div>
          <div class="ai-message-time">${time}</div>
        </div>
      `;
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      console.log('Message added successfully');
    }

    function formatAIMessage(text) {
      // Simple markdown-like formatting
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n/g, '<br>')
        .replace(/‚Ä¢ /g, '‚Ä¢ ');
    }

    // Demo AI Response Generator (for when API is unavailable)
    // MUST be defined BEFORE getAIResponse
    function getDemoAIResponse(userMessage) {
      console.log('getDemoAIResponse called with:', userMessage?.substring(0, 50));
      
      const lowerMessage = userMessage.toLowerCase();
      
      // Detect question type and provide appropriate demo response
      if (lowerMessage.includes('who needs attention') || lowerMessage.includes('prioritize')) {
        return generatePriorityResponse();
      } else if (lowerMessage.includes('predict') || lowerMessage.includes('risk')) {
        return generateRiskPredictionResponse();
      } else if (lowerMessage.includes('coaching plan') || lowerMessage.includes('30 days')) {
        return generateCoachingPlanResponse(userMessage);
      } else if (lowerMessage.includes('1:1') || lowerMessage.includes('prep') || lowerMessage.includes('agenda')) {
        return generate1on1AgendaResponse(userMessage);
      } else if (lowerMessage.includes('coaching') && lowerMessage.includes('recommendation')) {
        return generateCoachingRecommendations();
      } else if (lowerMessage.includes('effectiveness') || lowerMessage.includes('how is my coaching')) {
        return generateEffectivenessResponse();
      } else {
        return generateGenericResponse(userMessage);
      }
    }

    async function getAIResponse(userMessage) {
      // Check if running locally (file:// protocol) - skip API and go straight to demo
      if (window.location.protocol === 'file:') {
        console.log('Running locally - using demo mode directly');
        return getDemoAIResponse(userMessage);
      }
      
      // Build context about the team
      const teamContext = buildTeamContext();
      
      const systemPrompt = `You are an expert sales coaching assistant helping a sales manager lead their team effectively. You have access to detailed information about each team member including their readiness level (R1-R4), personality type (Owl/Panther/Peacock/Dolphin), performance status, skill development progress, and conversation history.

Your role is to:
1. Provide specific, actionable coaching recommendations
2. Identify patterns and risks in team performance
3. Suggest coaching approaches tailored to individual profiles
4. Generate 1:1 agendas based on member context
5. Predict performance risks based on data patterns

Be concise, direct, and practical. Focus on actions the manager can take immediately.

Current team data:
${teamContext}`;

      try {
        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 1000,
            messages: [
              ...aiConversationHistory,
              { role: "user", content: userMessage }
            ],
            system: systemPrompt
          })
        });

        if (!response.ok) {
          throw new Error(`API returned ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        const assistantMessage = data.content.find(c => c.type === 'text')?.text || 'I apologize, but I couldn\'t generate a response. Please try again.';
        
        // Update conversation history
        aiConversationHistory.push(
          { role: "user", content: userMessage },
          { role: "assistant", content: assistantMessage }
        );
        
        // Keep only last 20 messages to manage context
        if (aiConversationHistory.length > 20) {
          aiConversationHistory = aiConversationHistory.slice(-20);
        }
        
        return assistantMessage;
        
      } catch (error) {
        console.error('AI API Error:', error);
        
        try {
          console.log('Falling back to demo mode');
          
          // Return demo response instead of failing
          const demoResponse = getDemoAIResponse(userMessage);
          console.log('Demo response generated:', demoResponse.substring(0, 100) + '...');
          return demoResponse;
        } catch (demoError) {
          console.error('Error in demo mode:', demoError);
          return "I'm in demo mode but encountered an error. Your team data:\n\n" + 
                 teamMembers.map(m => `${m.name}: ${m.perfStatus}`).join('\n');
        }
      }
    }

    function generatePriorityResponse() {
      const atRisk = teamMembers.filter(m => m.perfStatus === 'at-risk' || m.perfStatus === 'struggling');
      const withOverdueActions = teamMembers.filter(m => m.actions.some(a => !a.completed && a.due < Date.now()));
      
      let response = "**Priority Focus This Week:**\n\n";
      
      if (atRisk.length > 0) {
        response += `**1. ${atRisk[0].name} (URGENT)**\n`;
        response += `‚Ä¢ Status: ${atRisk[0].perfStatus}\n`;
        response += `‚Ä¢ Profile: ${atRisk[0].readiness}/${atRisk[0].personality}\n`;
        response += `‚Ä¢ Recommendation: Schedule immediate 1:1. Use SBI model for critical feedback. Focus on ${atRisk[0].focusArea}.\n\n`;
      }
      
      if (withOverdueActions.length > 0 && withOverdueActions[0].id !== atRisk[0]?.id) {
        response += `**2. ${withOverdueActions[0].name} (HIGH)**\n`;
        response += `‚Ä¢ Has overdue action items\n`;
        response += `‚Ä¢ Recommendation: Review commitments, discuss blockers, reset realistic deadlines.\n\n`;
      }
      
      response += "\n_Note: This is a DEMO response using your team data. To get AI-powered responses, upload this file as an Artifact in Claude.ai_";
      
      return response;
    }

    function generateRiskPredictionResponse() {
      const atRisk = teamMembers.filter(m => m.perfStatus === 'at-risk' || m.perfStatus === 'struggling');
      
      let response = "**Performance Risk Analysis:**\n\n";
      response += "**HIGH RISK (70%+ probability):**\n";
      
      atRisk.forEach(m => {
        const daysSince = Math.floor((Date.now() - m.lastContact) / (1000*60*60*24));
        response += `‚Ä¢ ${m.name} - ${m.readiness}/${m.personality}: Performance ${m.perfStatus}. ${daysSince} days since last contact.\n`;
      });
      
      response += "\n**Early Interventions Recommended:**\n";
      response += "1. Increase 1:1 frequency for high-risk individuals\n";
      response += "2. Create accountability structures for overdue actions\n";
      response += "3. Reassess skill development plans\n";
      
      response += "\n_Note: This is a DEMO response. To get AI-powered analysis, upload this file as an Artifact in Claude.ai_";
      
      return response;
    }

    function generateCoachingPlanResponse(userMessage) {
      const member = teamMembers.find(m => userMessage.includes(m.name));
      
      if (!member) {
        return "I need more context. Which team member should I create a coaching plan for?\n\nTry: 'Generate a coaching plan for Sarah Chen'";
      }
      
      let response = `**30-Day Coaching Plan: ${member.name}**\n\n`;
      response += `**Profile:** ${member.readiness}/${member.personality} | ${member.perfStatus}\n\n`;
      
      response += "**Week 1-2: Foundation**\n";
      if (member.readiness === 'R1' || member.readiness === 'R2') {
        response += `‚Ä¢ 2x per week 1:1s (${member.readiness} rep needs frequent touchpoints)\n`;
        response += `‚Ä¢ Shadow ${member.readiness === 'R1' ? '5' : '3'} deals with top performer\n`;
        response += `‚Ä¢ Provide structured framework for ${member.focusArea}\n\n`;
      } else {
        response += `‚Ä¢ Weekly 1:1 focused on ${member.focusArea}\n`;
        response += "‚Ä¢ Assign stretch project in area of strength\n";
        response += "‚Ä¢ Identify one skill gap to address\n\n";
      }
      
      response += "**Week 3-4: Skill Building**\n";
      response += `‚Ä¢ Personality-based approach: ${member.personality === 'Owl' ? 'Analytical framework with detailed process docs' :
        member.personality === 'Panther' ? 'Challenge with competitive goal' :
        member.personality === 'Peacock' ? 'Collaborative problem-solving, celebrate wins' :
        'Supportive coaching, ensure psychological safety'}\n`;
      response += "‚Ä¢ Implement GROW coaching model\n";
      response += "‚Ä¢ Track progress with specific metrics\n";
      
      response += "\n_Note: This is a DEMO response. To get AI-powered coaching plans, upload this file as an Artifact in Claude.ai_";
      
      return response;
    }

    function generate1on1AgendaResponse(userMessage) {
      const upcoming = getUpcoming1on1s();
      
      if (upcoming.length === 0) {
        return "You don't have any 1:1s scheduled in the next 7 days. Would you like help scheduling some?";
      }
      
      let response = "**This Week's 1:1 Prep Guide:**\n\n";
      
      upcoming.forEach(item => {
        const overdueCount = item.member.actions.filter(a => !a.completed && a.due < Date.now()).length;
        response += `**${item.member.name} - ${new Date(item.date).toLocaleDateString()}**\n`;
        response += `‚Ä¢ Performance: ${item.member.perfStatus}\n`;
        response += `‚Ä¢ Overdue actions: ${overdueCount}\n`;
        response += `‚Ä¢ Focus: ${item.member.focusArea}\n`;
        response += `‚Ä¢ Approach: ${item.member.personality === 'Peacock' ? 'Collaborative, celebrate wins' :
          item.member.personality === 'Owl' ? 'Data-driven, structured' :
          item.member.personality === 'Panther' ? 'Direct, challenge-oriented' :
          'Empathetic, supportive'}\n\n`;
      });
      
      response += "_Note: This is a DEMO response. To get AI-powered agendas, upload this file as an Artifact in Claude.ai_";
      
      return response;
    }

    function generateCoachingRecommendations() {
      let response = "**Top 3 Coaching Recommendations This Week:**\n\n";
      
      const atRisk = teamMembers.filter(m => m.perfStatus === 'at-risk' || m.perfStatus === 'struggling');
      if (atRisk.length > 0) {
        response += `**1. Address Performance Concerns**\n`;
        response += `‚Ä¢ Focus on: ${atRisk[0].name}\n`;
        response += "‚Ä¢ Action: Use SBI model for critical feedback. Set clear 30-day improvement plan.\n\n";
      }
      
      response += "**2. Skill Development Initiative**\n";
      response += `‚Ä¢ ${teamMembers.filter(m => m.devPlan?.skills?.length > 0).length} members have active development plans\n`;
      response += "‚Ä¢ Action: Conduct skill assessments, celebrate progress, identify group training needs.\n\n";
      
      const overdueTotal = teamMembers.reduce((sum, m) => sum + m.actions.filter(a => !a.completed && a.due < Date.now()).length, 0);
      response += "**3. Strengthen Accountability**\n";
      response += `‚Ä¢ ${overdueTotal} total overdue actions across team\n`;
      response += "‚Ä¢ Action: Review completion rates in 1:1s, discuss blockers, reset commitments.\n";
      
      response += "\n_Note: This is a DEMO response. To get AI-powered recommendations, upload this file as an Artifact in Claude.ai_";
      
      return response;
    }

    function generateEffectivenessResponse() {
      const metrics = calculateCoachingEffectiveness();
      
      let response = "**Your Coaching Effectiveness Analysis:**\n\n";
      response += `‚Ä¢ Skill improvement: +${metrics.avgSkillImprovement}% average\n`;
      response += `‚Ä¢ 1:1 sessions: ${metrics.totalSessions} tracked\n`;
      response += `‚Ä¢ Action completion: ${metrics.actionCompletionRate}%\n\n`;
      
      response += "**What's Working:**\n";
      if (metrics.avgSkillImprovement > 10) response += "‚úì Strong skill development coaching\n";
      if (metrics.actionCompletionRate >= 70) response += "‚úì Good accountability culture\n";
      
      response += "\n_Note: This is a DEMO response. To get AI-powered analysis, upload this file as an Artifact in Claude.ai_";
      
      return response;
    }

    function generateGenericResponse(userMessage) {
      return `I can help with that! I have access to your team data and can provide coaching recommendations.\n\nTry asking:\n‚Ä¢ "Who needs the most attention this week?"\n‚Ä¢ "Generate a 1:1 agenda for [name]"\n‚Ä¢ "What coaching approach for a ${teamMembers[0].readiness}/${teamMembers[0].personality}?"\n‚Ä¢ "Predict performance risks"\n\n_Note: This is DEMO MODE. To get full AI-powered responses, upload this file as an Artifact in Claude.ai where the Anthropic API is accessible._`;
    }

    function buildTeamContext() {
      const context = teamMembers.map(member => {
        const overdueActions = member.actions.filter(a => !a.completed && a.due < Date.now()).length;
        const skillGaps = member.devPlan?.skills?.filter(s => (s.target - s.current) > 20).length || 0;
        const daysSince1on1 = Math.floor((Date.now() - member.lastContact) / (1000 * 60 * 60 * 24));
        
        return `
**${member.name}**
- Profile: ${member.readiness}/${member.personality} (${member.careerStage})
- Performance: ${member.perfStatus}
- Focus Area: ${member.focusArea}
- Last 1:1: ${daysSince1on1} days ago
- Overdue Actions: ${overdueActions}
- Skill Gaps (20%+): ${skillGaps}
- Recent Conversations: ${member.conversations?.length || 0}
${member.personalNotes ? `- Notes: ${member.personalNotes}` : ''}
${member.careerGoals ? `- Career Goals: ${member.careerGoals}` : ''}
        `.trim();
      }).join('\n\n');
      
      return context;
    }

    function getAICoachingPlan(memberId) {
      console.log('getAICoachingPlan called for member ID:', memberId);
      
      const member = teamMembers.find(m => m.id === memberId);
      if (!member) {
        console.error('Member not found with ID:', memberId);
        return;
      }
      
      console.log('Found member:', member.name);
      
      const question = `${member.name} is ${member.perfStatus} with profile ${member.readiness}/${member.personality}. They are focused on ${member.focusArea}. What specific coaching plan would you recommend for the next 30 days?`;
      
      console.log('Generated question:', question);
      
      // Switch to AI tab
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.nav-tab[data-view="ai-assistant"]').classList.add('active');
      document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
      document.getElementById('ai-assistant').classList.add('active');
      
      console.log('Switched to AI tab');
      
      // Initialize AI assistant (in case it wasn't already)
      initializeAIAssistant();
      
      // Ask the question after a delay to ensure UI is ready
      setTimeout(() => {
        console.log('About to call askAI');
        askAI(question);
      }, 500);
    }

    // Initialize AI Assistant view
    function initializeAIAssistant() {
      renderPredictiveAlerts();
      renderCalendarSync();
      renderCoachingEffectiveness();
    }

  </script>

</body></html>